{"version":3,"file":"extension.js","mappings":"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","sources":["webpack://punchcard-work-time-statistics/./src/webview.js","webpack://punchcard-work-time-statistics/./src/tracker.js","webpack://punchcard-work-time-statistics/./src/types.js","webpack://punchcard-work-time-statistics/external commonjs \"vscode\"","webpack://punchcard-work-time-statistics/./src/utils.js","webpack://punchcard-work-time-statistics/./src/syncLogger.js","webpack://punchcard-work-time-statistics/./src/extension.js","webpack://punchcard-work-time-statistics/./src/statusBar.js","webpack://punchcard-work-time-statistics/./src/storage.js","webpack://punchcard-work-time-statistics/external node-commonjs \"os\"","webpack://punchcard-work-time-statistics/webpack/bootstrap","webpack://punchcard-work-time-statistics/webpack/startup"],"sourcesContent":["const vscode = require('vscode');\r\nconst { formatTime, formatTimeHuman, getDailyBreakdown, getWeeklyBreakdown, getMonthlyBreakdown, getTimeInRange, getStartOfDay, getStartOfWeek, getStartOfMonth, getEndOfDay, getEndOfWeek, getEndOfMonth, aggregateDailyMetrics } = require('./utils');\r\nconst { logger } = require('./syncLogger');\r\n\r\n/**\r\n * WebView panel for displaying statistics\r\n */\r\nclass StatsWebView {\r\n    /**\r\n     * @param {vscode.ExtensionContext} context \r\n     * @param {import('./storage').Storage} storage \r\n     */\r\n    constructor(context, storage) {\r\n        this.context = context;\r\n        this.storage = storage;\r\n        this.panel = null;\r\n    }\r\n\r\n    /**\r\n     * Show the statistics panel\r\n     */\r\n    show() {\r\n        if (this.panel) {\r\n            this.panel.reveal(vscode.ViewColumn.One);\r\n            this.update();\r\n            return;\r\n        }\r\n\r\n        this.panel = vscode.window.createWebviewPanel(\r\n            'workTimerStats',\r\n            'PUNCHCARD - Work Time Statistics',\r\n            vscode.ViewColumn.One,\r\n            {\r\n                enableScripts: true,\r\n                retainContextWhenHidden: true\r\n            }\r\n        );\r\n\r\n        this.panel.webview.html = this.getWebviewContent();\r\n\r\n        this.panel.webview.onDidReceiveMessage(\r\n            async (message) => {\r\n                switch (message.command) {\r\n                    case 'resetProject':\r\n                        const confirmReset = await vscode.window.showWarningMessage(\r\n                            `Are you sure you want to reset statistics for \"${message.projectId}\"?`,\r\n                            { modal: true },\r\n                            'Yes, Reset'\r\n                        );\r\n                        if (confirmReset === 'Yes, Reset') {\r\n                            await this.storage.resetProject(message.projectId);\r\n                            this.update();\r\n                            vscode.window.showInformationMessage(`Statistics for \"${message.projectId}\" have been reset.`);\r\n                        }\r\n                        break;\r\n                    case 'resetStat':\r\n                        const confirmStatReset = await vscode.window.showWarningMessage(\r\n                            `Are you sure you want to reset ${message.statLabel} for \"${message.projectId}\"?`,\r\n                            { modal: true },\r\n                            'Yes, Reset'\r\n                        );\r\n                        if (confirmStatReset === 'Yes, Reset') {\r\n                            await this.storage.resetProjectStat(message.projectId, message.statName);\r\n                            this.update();\r\n                            vscode.window.showInformationMessage(`${message.statLabel} for \"${message.projectId}\" has been reset.`);\r\n                        }\r\n                        break;\r\n                    case 'resetGlobalStat':\r\n                        const confirmGlobalReset = await vscode.window.showWarningMessage(\r\n                            `Are you sure you want to reset ${message.statLabel} for ALL projects?`,\r\n                            { modal: true },\r\n                            'Yes, Reset All'\r\n                        );\r\n                        if (confirmGlobalReset === 'Yes, Reset All') {\r\n                            await this.storage.resetGlobalStat(message.statName);\r\n                            this.update();\r\n                            vscode.window.showInformationMessage(`${message.statLabel} has been reset for all projects.`);\r\n                        }\r\n                        break;\r\n                    case 'refresh':\r\n                        this.update();\r\n                        break;\r\n                    case 'clearLogs':\r\n                        logger.clear();\r\n                        this.update();\r\n                        break;\r\n                    case 'forceSyncCheck':\r\n                        await this.storage.checkForSyncedData();\r\n                        this.update();\r\n                        break;\r\n                }\r\n            },\r\n            undefined,\r\n            this.context.subscriptions\r\n        );\r\n\r\n        this.panel.onDidDispose(\r\n            () => {\r\n                this.panel = null;\r\n            },\r\n            null,\r\n            this.context.subscriptions\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update the webview content\r\n     */\r\n    update() {\r\n        if (this.panel) {\r\n            this.panel.webview.html = this.getWebviewContent();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the HTML content for the webview\r\n     * @returns {string}\r\n     */\r\n    getWebviewContent() {\r\n        const data = this.storage.getAllData();\r\n        const projects = data.projects;\r\n\r\n        // Collect all sessions\r\n        const allSessions = [];\r\n        for (const projectId in projects) {\r\n            allSessions.push(...(projects[projectId].sessions || []));\r\n        }\r\n\r\n        // Chart breakdown data (always shown)\r\n        const dailyData = getDailyBreakdown(allSessions, 7);\r\n        const weeklyData = getWeeklyBreakdown(allSessions, 4);\r\n        const monthlyData = getMonthlyBreakdown(allSessions, 6);\r\n\r\n        // Period boundaries\r\n        const periods = {\r\n            today: { start: getStartOfDay(), end: getEndOfDay(), label: 'Today' },\r\n            week:  { start: getStartOfWeek(), end: getEndOfWeek(), label: 'This Week' },\r\n            month: { start: getStartOfMonth(), end: getEndOfMonth(), label: 'This Month' },\r\n            all:   { start: 0, end: Date.now() + 86400000, label: 'All Time' }\r\n        };\r\n\r\n        // Pre-compute per-period data for each project and globally\r\n        const periodData = {};\r\n        for (const [periodKey, range] of Object.entries(periods)) {\r\n            let gTime = 0, gKeystrokes = 0, gLinesAdded = 0, gLinesDeleted = 0;\r\n            let gLinesAddedBulk = 0, gLinesDeletedBulk = 0, gCharsAdded = 0, gCharsDeleted = 0;\r\n            let gSessions = 0;\r\n            const projectPeriodData = {};\r\n\r\n            for (const [projectId, stats] of Object.entries(projects)) {\r\n                const sessionsInRange = (stats.sessions || []).filter(s => \r\n                    s.startTime < range.end && s.endTime > range.start\r\n                );\r\n                const timeInRange = getTimeInRange(stats.sessions || [], range.start, range.end);\r\n\r\n                let metrics;\r\n                if (periodKey === 'all') {\r\n                    // For \"all time\", use project totals (includes pre-dailyMetrics data)\r\n                    metrics = {\r\n                        time: stats.totalTime || 0,\r\n                        keystrokes: stats.keystrokes || 0,\r\n                        linesAdded: stats.linesAdded || 0,\r\n                        linesDeleted: stats.linesDeleted || 0,\r\n                        linesAddedBulk: stats.linesAddedBulk || 0,\r\n                        linesDeletedBulk: stats.linesDeletedBulk || 0,\r\n                        charactersAdded: stats.charactersAdded || 0,\r\n                        charactersDeleted: stats.charactersDeleted || 0\r\n                    };\r\n                } else {\r\n                    metrics = aggregateDailyMetrics(stats.dailyMetrics || {}, range.start, range.end);\r\n                    // For time, prefer session-based calculation (more accurate for partial days)\r\n                    metrics.time = timeInRange;\r\n                }\r\n\r\n                projectPeriodData[projectId] = {\r\n                    ...metrics,\r\n                    sessions: sessionsInRange.length,\r\n                    lastActive: stats.lastActive || 0\r\n                };\r\n\r\n                gTime += metrics.time;\r\n                gKeystrokes += metrics.keystrokes;\r\n                gLinesAdded += metrics.linesAdded;\r\n                gLinesDeleted += metrics.linesDeleted;\r\n                gLinesAddedBulk += metrics.linesAddedBulk;\r\n                gLinesDeletedBulk += metrics.linesDeletedBulk;\r\n                gCharsAdded += metrics.charactersAdded;\r\n                gCharsDeleted += metrics.charactersDeleted;\r\n                gSessions += sessionsInRange.length;\r\n            }\r\n\r\n            periodData[periodKey] = {\r\n                label: range.label,\r\n                summary: {\r\n                    totalTime: gTime,\r\n                    totalKeystrokes: gKeystrokes,\r\n                    totalSessions: gSessions,\r\n                    totalLinesAdded: gLinesAdded,\r\n                    totalLinesDeleted: gLinesDeleted,\r\n                    totalLinesAddedBulk: gLinesAddedBulk,\r\n                    totalLinesDeletedBulk: gLinesDeletedBulk,\r\n                    totalCharsAdded: gCharsAdded,\r\n                    totalCharsDeleted: gCharsDeleted,\r\n                    projectCount: Object.keys(projects).length\r\n                },\r\n                projects: projectPeriodData\r\n            };\r\n        }\r\n\r\n        // Get sync info and logs for the debug panel\r\n        const syncInfo = this.storage.getSyncInfo ? this.storage.getSyncInfo() : {};\r\n        const syncLogs = logger.getLogs();\r\n\r\n        // Project list for rendering (sorted by totalTime desc)\r\n        const projectList = Object.entries(projects)\r\n            .map(([id, stats]) => ({ id, lastActive: stats.lastActive }))\r\n            .sort((a, b) => (b.lastActive || 0) - (a.lastActive || 0));\r\n\r\n        return `<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>PUNCHCARD - Work Time Statistics</title>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\r\n    <style>\r\n        :root {\r\n            --bg-color: var(--vscode-editor-background);\r\n            --text-color: var(--vscode-editor-foreground);\r\n            --border-color: var(--vscode-panel-border);\r\n            --card-bg: var(--vscode-editorWidget-background);\r\n            --accent-color: var(--vscode-button-background);\r\n            --accent-hover: var(--vscode-button-hoverBackground);\r\n            --danger-color: var(--vscode-errorForeground);\r\n        }\r\n\r\n        * { margin: 0; padding: 0; box-sizing: border-box; }\r\n\r\n        body {\r\n            font-family: var(--vscode-font-family);\r\n            background-color: var(--bg-color);\r\n            color: var(--text-color);\r\n            padding: 20px;\r\n            line-height: 1.6;\r\n        }\r\n\r\n        h1, h2, h3 { margin-bottom: 15px; font-weight: 600; }\r\n        h1 { font-size: 24px; display: flex; align-items: center; gap: 10px; }\r\n        h1::before { content: \"⏱️\"; }\r\n\r\n        .header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            margin-bottom: 20px;\r\n            padding-bottom: 15px;\r\n            border-bottom: 1px solid var(--border-color);\r\n        }\r\n\r\n        .header-actions { display: flex; gap: 10px; align-items: center; }\r\n\r\n        .refresh-btn {\r\n            background-color: var(--card-bg);\r\n            color: var(--text-color);\r\n            border: 1px solid var(--border-color);\r\n            padding: 8px 16px;\r\n            border-radius: 4px;\r\n            cursor: pointer;\r\n            font-size: 13px;\r\n            transition: all 0.15s;\r\n        }\r\n\r\n        .refresh-btn:hover {\r\n            background-color: var(--accent-hover);\r\n            color: var(--vscode-button-foreground);\r\n            border-color: var(--accent-hover);\r\n        }\r\n\r\n        .period-btn {\r\n            background-color: transparent;\r\n            color: var(--text-color);\r\n            border: 1px solid transparent;\r\n            padding: 8px 16px;\r\n            border-radius: 4px;\r\n            cursor: pointer;\r\n            font-size: 13px;\r\n            transition: background-color 0.15s, color 0.15s;\r\n        }\r\n\r\n        .period-btn:hover {\r\n            background-color: rgba(128, 128, 128, 0.15);\r\n        }\r\n\r\n        .period-tabs {\r\n            display: flex;\r\n            gap: 4px;\r\n            margin-bottom: 25px;\r\n            padding: 4px;\r\n            background-color: var(--card-bg);\r\n            border-radius: 8px;\r\n            border: 1px solid var(--border-color);\r\n            width: fit-content;\r\n        }\r\n\r\n        .period-btn.active {\r\n            background-color: var(--accent-color);\r\n            color: var(--vscode-button-foreground);\r\n            border-color: transparent;\r\n        }\r\n\r\n        .summary-grid {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));\r\n            gap: 12px;\r\n            margin-bottom: 30px;\r\n        }\r\n\r\n        .summary-card {\r\n            background-color: var(--card-bg);\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 8px;\r\n            padding: 18px;\r\n            text-align: center;\r\n            position: relative;\r\n        }\r\n\r\n        .summary-card:hover .summary-reset-btn { opacity: 1; }\r\n\r\n        .summary-reset-btn {\r\n            position: absolute; top: 5px; right: 5px;\r\n            background: transparent; border: none;\r\n            color: var(--danger-color); cursor: pointer;\r\n            font-size: 10px; padding: 2px 6px;\r\n            opacity: 0; transition: opacity 0.2s; border-radius: 3px;\r\n        }\r\n        .summary-reset-btn:hover { background-color: var(--danger-color); color: white; }\r\n\r\n        .summary-card .value {\r\n            font-size: 26px;\r\n            font-weight: bold;\r\n            color: var(--accent-color);\r\n            margin-bottom: 4px;\r\n        }\r\n\r\n        .summary-card .label {\r\n            font-size: 11px;\r\n            opacity: 0.8;\r\n            text-transform: uppercase;\r\n        }\r\n\r\n        .charts-container {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\r\n            gap: 20px;\r\n            margin-bottom: 30px;\r\n        }\r\n\r\n        .chart-card {\r\n            background-color: var(--card-bg);\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 8px;\r\n            padding: 20px;\r\n        }\r\n        .chart-card h3 { margin-bottom: 20px; }\r\n        .chart-container { position: relative; height: 250px; }\r\n\r\n        .projects-section { margin-top: 30px; }\r\n\r\n        .project-card {\r\n            background-color: var(--card-bg);\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 8px;\r\n            padding: 20px;\r\n            margin-bottom: 15px;\r\n        }\r\n\r\n        .project-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            margin-bottom: 15px;\r\n        }\r\n\r\n        .project-name { font-size: 18px; font-weight: 600; }\r\n\r\n        .reset-btn {\r\n            background-color: transparent;\r\n            color: var(--danger-color);\r\n            border: 1px solid var(--danger-color);\r\n            padding: 5px 10px; border-radius: 4px;\r\n            cursor: pointer; font-size: 12px;\r\n        }\r\n        .reset-btn:hover { background-color: var(--danger-color); color: white; }\r\n\r\n        .project-stats {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\r\n            gap: 10px;\r\n        }\r\n\r\n        .stat { display: flex; flex-direction: column; position: relative; }\r\n        .stat:hover .stat-reset-btn { opacity: 1; }\r\n\r\n        .stat-reset-btn {\r\n            position: absolute; top: 0; right: 0;\r\n            background: transparent; border: none;\r\n            color: var(--danger-color); cursor: pointer;\r\n            font-size: 10px; padding: 2px 5px;\r\n            opacity: 0; transition: opacity 0.2s; border-radius: 3px;\r\n        }\r\n        .stat-reset-btn:hover { background-color: var(--danger-color); color: white; }\r\n\r\n        .stat .stat-value { font-size: 18px; font-weight: bold; }\r\n        .stat .stat-label { font-size: 10px; opacity: 0.7; text-transform: uppercase; }\r\n\r\n        .no-data { text-align: center; padding: 40px; opacity: 0.6; }\r\n\r\n        .period-badge {\r\n            display: inline-block;\r\n            font-size: 11px;\r\n            padding: 2px 8px;\r\n            border-radius: 10px;\r\n            background-color: var(--accent-color);\r\n            color: var(--vscode-button-foreground);\r\n            margin-left: 10px;\r\n            vertical-align: middle;\r\n        }\r\n\r\n        @media (max-width: 600px) {\r\n            .charts-container { grid-template-columns: 1fr; }\r\n        }\r\n\r\n        /* Sync & Debug Log Styles */\r\n        .sync-log-section {\r\n            margin-top: 30px;\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 8px;\r\n            overflow: hidden;\r\n        }\r\n        .sync-log-header {\r\n            display: flex; justify-content: space-between; align-items: center;\r\n            padding: 15px 20px; cursor: pointer;\r\n            background-color: var(--card-bg); user-select: none;\r\n        }\r\n        .sync-log-header:hover { opacity: 0.9; }\r\n        .sync-log-header h2 { margin-bottom: 0; font-size: 16px; }\r\n        .sync-log-toggle { font-size: 14px; transition: transform 0.2s; }\r\n        .sync-log-toggle.open { transform: rotate(90deg); }\r\n        .sync-log-content { padding: 20px; display: none; }\r\n        .sync-log-content.visible { display: block; }\r\n        .sync-info-grid {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\r\n            gap: 10px; margin-bottom: 20px;\r\n        }\r\n        .sync-info-card {\r\n            background-color: var(--card-bg);\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 6px; padding: 12px; text-align: center;\r\n        }\r\n        .sync-info-value {\r\n            font-size: 14px; font-weight: bold;\r\n            color: var(--accent-color); margin-bottom: 4px; word-break: break-all;\r\n        }\r\n        .sync-info-label { font-size: 10px; opacity: 0.7; text-transform: uppercase; }\r\n        .log-controls {\r\n            display: flex; gap: 10px; margin-bottom: 15px;\r\n            align-items: center; flex-wrap: wrap;\r\n        }\r\n        .log-controls select {\r\n            background-color: var(--card-bg); color: var(--text-color);\r\n            border: 1px solid var(--border-color); padding: 5px 10px;\r\n            border-radius: 4px; font-size: 12px;\r\n        }\r\n        .log-controls .clear-btn {\r\n            background-color: transparent; color: var(--danger-color);\r\n            border: 1px solid var(--danger-color); padding: 5px 10px;\r\n            border-radius: 4px; cursor: pointer; font-size: 12px;\r\n        }\r\n        .log-controls .clear-btn:hover { background-color: var(--danger-color); color: white; }\r\n        .log-controls .sync-check-btn {\r\n            background-color: var(--accent-color); color: var(--vscode-button-foreground);\r\n            border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;\r\n        }\r\n        .log-controls .sync-check-btn:hover { background-color: var(--accent-hover); }\r\n        .log-entries {\r\n            max-height: 400px; overflow-y: auto;\r\n            font-family: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;\r\n            font-size: 11px; line-height: 1.4;\r\n            background-color: var(--bg-color);\r\n            border: 1px solid var(--border-color); border-radius: 4px; padding: 10px;\r\n        }\r\n        .log-entry { padding: 2px 0; border-bottom: 1px solid rgba(128,128,128,0.1); }\r\n        .log-entry:last-child { border-bottom: none; }\r\n        .log-time { color: #888; margin-right: 8px; }\r\n        .log-level { font-weight: bold; margin-right: 6px; display: inline-block; min-width: 50px; }\r\n        .log-level.info { color: #4FC3F7; }\r\n        .log-level.warn { color: #FFB74D; }\r\n        .log-level.error { color: #EF5350; }\r\n        .log-level.debug { color: #888; }\r\n        .log-category { color: #BA68C8; margin-right: 6px; }\r\n        .log-message { color: var(--text-color); }\r\n        .log-data { color: #888; font-size: 10px; margin-left: 20px; white-space: pre-wrap; display: none; }\r\n        .log-entry:hover .log-data { display: block; }\r\n        .log-count { font-size: 11px; opacity: 0.6; margin-left: 10px; }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"header\">\r\n        <h1>PUNCHCARD - Work Time Statistics</h1>\r\n        <div class=\"header-actions\">\r\n            <button class=\"refresh-btn\" onclick=\"refresh()\">🔄 Refresh</button>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Period Selector Tabs -->\r\n    <div class=\"period-tabs\">\r\n        <button class=\"period-btn active\" data-period=\"all\" onclick=\"switchPeriod('all')\">All Time</button>\r\n        <button class=\"period-btn\" data-period=\"month\" onclick=\"switchPeriod('month')\">This Month</button>\r\n        <button class=\"period-btn\" data-period=\"week\" onclick=\"switchPeriod('week')\">This Week</button>\r\n        <button class=\"period-btn\" data-period=\"today\" onclick=\"switchPeriod('today')\">Today</button>\r\n    </div>\r\n\r\n    <!-- Summary (rendered by JS) -->\r\n    <div class=\"summary-grid\" id=\"summaryGrid\"></div>\r\n\r\n    <!-- Charts -->\r\n    <div class=\"charts-container\">\r\n        <div class=\"chart-card\">\r\n            <h3>📅 Daily Activity (Last 7 Days)</h3>\r\n            <div class=\"chart-container\"><canvas id=\"dailyChart\"></canvas></div>\r\n        </div>\r\n        <div class=\"chart-card\">\r\n            <h3>📊 Weekly Activity (Last 4 Weeks)</h3>\r\n            <div class=\"chart-container\"><canvas id=\"weeklyChart\"></canvas></div>\r\n        </div>\r\n        <div class=\"chart-card\">\r\n            <h3>📈 Monthly Activity (Last 6 Months)</h3>\r\n            <div class=\"chart-container\"><canvas id=\"monthlyChart\"></canvas></div>\r\n        </div>\r\n        <div class=\"chart-card\">\r\n            <h3>🥧 Time by Project</h3>\r\n            <div class=\"chart-container\"><canvas id=\"projectsChart\"></canvas></div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Projects (rendered by JS) -->\r\n    <div class=\"projects-section\">\r\n        <h2>📁 Projects <span class=\"period-badge\" id=\"periodBadge\">All Time</span></h2>\r\n        <div id=\"projectsContainer\"></div>\r\n    </div>\r\n\r\n    <!-- Sync & Debug Log Section -->\r\n    <div class=\"sync-log-section\">\r\n        <div class=\"sync-log-header\" onclick=\"toggleSyncLog()\">\r\n            <h2>🔧 Sync & Debug Log</h2>\r\n            <span class=\"sync-log-toggle\" id=\"syncLogToggle\">▶</span>\r\n        </div>\r\n        <div class=\"sync-log-content\" id=\"syncLogContent\">\r\n            <div class=\"sync-info-grid\">\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.machineId || 'N/A'}</div>\r\n                    <div class=\"sync-info-label\">Machine ID</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.lastSaveTime ? new Date(syncInfo.lastSaveTime).toLocaleString() : 'Never'}</div>\r\n                    <div class=\"sync-info-label\">Last Save</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.totalSaves || 0}</div>\r\n                    <div class=\"sync-info-label\">Total Saves</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.syncDetections || 0}</div>\r\n                    <div class=\"sync-info-label\">Sync Events Detected</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.totalMerges || 0}</div>\r\n                    <div class=\"sync-info-label\">Data Merges</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.totalSessions || 0}</div>\r\n                    <div class=\"sync-info-label\">Total Sessions</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${Object.entries(syncInfo.sessionsByMachine || {}).map(([mid, count]) => mid.substring(0, 15) + ': ' + count).join('<br>') || 'N/A'}</div>\r\n                    <div class=\"sync-info-label\">Sessions by Machine</div>\r\n                </div>\r\n            </div>\r\n            <div class=\"log-controls\">\r\n                <select id=\"logFilter\" onchange=\"filterLogs()\">\r\n                    <option value=\"all\">All Categories</option>\r\n                    <option value=\"sync\">Sync</option>\r\n                    <option value=\"storage\">Storage</option>\r\n                    <option value=\"tracker\">Tracker</option>\r\n                    <option value=\"session\">Session</option>\r\n                    <option value=\"merge\">Merge</option>\r\n                    <option value=\"init\">Init</option>\r\n                </select>\r\n                <select id=\"logLevelFilter\" onchange=\"filterLogs()\">\r\n                    <option value=\"all\">All Levels</option>\r\n                    <option value=\"error\">Errors Only</option>\r\n                    <option value=\"warn\">Warnings & Errors</option>\r\n                    <option value=\"info\">Info & Above</option>\r\n                </select>\r\n                <button class=\"sync-check-btn\" onclick=\"forceSyncCheck()\">🔄 Force Sync Check</button>\r\n                <button class=\"clear-btn\" onclick=\"clearLogs()\">🗑️ Clear Logs</button>\r\n                <span class=\"log-count\">${syncLogs.length} entries</span>\r\n            </div>\r\n            <div class=\"log-entries\" id=\"logEntries\">\r\n                ${syncLogs.length === 0 ? '<div style=\"opacity:0.5; text-align:center; padding:20px;\">No log entries yet. Logs will appear as sync events occur.</div>' : \r\n                    syncLogs.slice().reverse().map(entry => {\r\n                        const time = new Date(entry.timestamp).toLocaleTimeString();\r\n                        return `<div class=\"log-entry\" data-category=\"${entry.category}\" data-level=\"${entry.level}\">\r\n                            <span class=\"log-time\">${time}</span>\r\n                            <span class=\"log-level ${entry.level}\">[${entry.level.toUpperCase()}]</span>\r\n                            <span class=\"log-category\">[${entry.category}]</span>\r\n                            <span class=\"log-message\">${this.escapeHtml(entry.message)}</span>\r\n                            ${entry.data ? `<div class=\"log-data\">${this.escapeHtml(entry.data)}</div>` : ''}\r\n                        </div>`;\r\n                    }).join('')\r\n                }\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <script>\r\n        const vscode = acquireVsCodeApi();\r\n        const periodData = ${JSON.stringify(periodData)};\r\n        const projectList = ${JSON.stringify(projectList)};\r\n        let currentPeriod = 'all';\r\n\r\n        function fmtTime(ms) {\r\n            if (ms < 0) ms = 0;\r\n            const s = Math.floor(ms / 1000);\r\n            const h = Math.floor(s / 3600);\r\n            const m = Math.floor((s % 3600) / 60);\r\n            const sec = s % 60;\r\n            return h.toString().padStart(2,'0') + ':' + m.toString().padStart(2,'0') + ':' + sec.toString().padStart(2,'0');\r\n        }\r\n\r\n        function fmtNum(n) { return (n || 0).toLocaleString(); }\r\n\r\n        function esc(text) {\r\n            const d = {'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\": '&#039;'};\r\n            return String(text).replace(/[&<>\"']/g, m => d[m]);\r\n        }\r\n\r\n        function switchPeriod(period) {\r\n            currentPeriod = period;\r\n            document.querySelectorAll('.period-btn').forEach(btn => {\r\n                btn.classList.toggle('active', btn.getAttribute('data-period') === period);\r\n            });\r\n            renderSummary();\r\n            renderProjects();\r\n        }\r\n\r\n        function renderSummary() {\r\n            const pd = periodData[currentPeriod];\r\n            if (!pd) return;\r\n            const s = pd.summary;\r\n            const grid = document.getElementById('summaryGrid');\r\n            grid.innerHTML = \\`\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('totalTime', 'Total Time')\">✕</button>\r\n                    <div class=\"value\">\\${fmtTime(s.totalTime)}</div>\r\n                    <div class=\"label\">Time (\\${pd.label})</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <div class=\"value\">\\${s.projectCount}</div>\r\n                    <div class=\"label\">Projects</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('sessions', 'Sessions')\">✕</button>\r\n                    <div class=\"value\">\\${fmtNum(s.totalSessions)}</div>\r\n                    <div class=\"label\">Sessions</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('keystrokes', 'Keystrokes')\">✕</button>\r\n                    <div class=\"value\">\\${fmtNum(s.totalKeystrokes)}</div>\r\n                    <div class=\"label\">Keystrokes</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('linesAdded', 'Lines Added (Typed)')\">✕</button>\r\n                    <div class=\"value\">+\\${fmtNum(s.totalLinesAdded)}</div>\r\n                    <div class=\"label\">Lines Added (Typed)</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('linesDeleted', 'Lines Deleted (Typed)')\">✕</button>\r\n                    <div class=\"value\">-\\${fmtNum(s.totalLinesDeleted)}</div>\r\n                    <div class=\"label\">Lines Deleted (Typed)</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('linesAddedBulk', 'Lines Added (Bulk)')\">✕</button>\r\n                    <div class=\"value\">+\\${fmtNum(s.totalLinesAddedBulk)}</div>\r\n                    <div class=\"label\">Lines Added (Bulk/Paste)</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('charactersAdded', 'Characters Added')\">✕</button>\r\n                    <div class=\"value\">\\${fmtNum(s.totalCharsAdded)}</div>\r\n                    <div class=\"label\">Chars Added</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('charactersDeleted', 'Characters Deleted')\">✕</button>\r\n                    <div class=\"value\">\\${fmtNum(s.totalCharsDeleted)}</div>\r\n                    <div class=\"label\">Chars Deleted</div>\r\n                </div>\r\n            \\`;\r\n        }\r\n\r\n        function renderProjects() {\r\n            const pd = periodData[currentPeriod];\r\n            if (!pd) return;\r\n            const container = document.getElementById('projectsContainer');\r\n            const badge = document.getElementById('periodBadge');\r\n            badge.textContent = pd.label;\r\n\r\n            if (projectList.length === 0) {\r\n                container.innerHTML = '<div class=\"no-data\">No projects tracked yet. Start coding to see your statistics!</div>';\r\n                return;\r\n            }\r\n\r\n            container.innerHTML = projectList.map(proj => {\r\n                const s = pd.projects[proj.id] || {};\r\n                return \\`\r\n                <div class=\"project-card\">\r\n                    <div class=\"project-header\">\r\n                        <span class=\"project-name\">\\${esc(proj.id)}</span>\r\n                        <button class=\"reset-btn\" onclick=\"resetProject('\\${esc(proj.id)}')\">🗑️ Reset All</button>\r\n                    </div>\r\n                    <div class=\"project-stats\">\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtTime(s.time || 0)}</span>\r\n                            <span class=\"stat-label\">Time</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'totalTime', 'Total Time')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtNum(s.sessions)}</span>\r\n                            <span class=\"stat-label\">Sessions</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'sessions', 'Sessions')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtNum(s.keystrokes)}</span>\r\n                            <span class=\"stat-label\">Keystrokes</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'keystrokes', 'Keystrokes')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">+\\${fmtNum(s.linesAdded)}</span>\r\n                            <span class=\"stat-label\">Lines (Typed)</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'linesAdded', 'Lines Added')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">-\\${fmtNum(s.linesDeleted)}</span>\r\n                            <span class=\"stat-label\">Lines Del (Typed)</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'linesDeleted', 'Lines Deleted')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">+\\${fmtNum(s.linesAddedBulk)}</span>\r\n                            <span class=\"stat-label\">Lines (Bulk)</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'linesAddedBulk', 'Lines Added (Bulk)')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtNum(s.charactersAdded)}</span>\r\n                            <span class=\"stat-label\">Chars Added</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'charactersAdded', 'Chars Added')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtNum(s.charactersDeleted)}</span>\r\n                            <span class=\"stat-label\">Chars Deleted</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'charactersDeleted', 'Chars Deleted')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${s.lastActive ? new Date(s.lastActive).toLocaleDateString() : 'Never'}</span>\r\n                            <span class=\"stat-label\">Last Active</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \\`;\r\n            }).join('');\r\n        }\r\n\r\n        // Initial render\r\n        renderSummary();\r\n        renderProjects();\r\n\r\n        function refresh() { vscode.postMessage({ command: 'refresh' }); }\r\n        function resetProject(projectId) { vscode.postMessage({ command: 'resetProject', projectId }); }\r\n        function resetStat(projectId, statName, statLabel) { vscode.postMessage({ command: 'resetStat', projectId, statName, statLabel }); }\r\n        function resetGlobalStat(statName, statLabel) { vscode.postMessage({ command: 'resetGlobalStat', statName, statLabel }); }\r\n\r\n        // Sync log\r\n        function toggleSyncLog() {\r\n            const content = document.getElementById('syncLogContent');\r\n            const toggle = document.getElementById('syncLogToggle');\r\n            content.classList.toggle('visible');\r\n            toggle.classList.toggle('open');\r\n        }\r\n        function filterLogs() {\r\n            const catFilter = document.getElementById('logFilter').value;\r\n            const lvlFilter = document.getElementById('logLevelFilter').value;\r\n            const lvlOrder = { 'error': 0, 'warn': 1, 'info': 2, 'debug': 3 };\r\n            document.querySelectorAll('.log-entry').forEach(entry => {\r\n                const cat = entry.getAttribute('data-category');\r\n                const lvl = entry.getAttribute('data-level');\r\n                const showCat = catFilter === 'all' || cat === catFilter;\r\n                let showLvl = true;\r\n                if (lvlFilter === 'error') showLvl = lvl === 'error';\r\n                else if (lvlFilter === 'warn') showLvl = lvlOrder[lvl] <= 1;\r\n                else if (lvlFilter === 'info') showLvl = lvlOrder[lvl] <= 2;\r\n                entry.style.display = (showCat && showLvl) ? '' : 'none';\r\n            });\r\n        }\r\n        function clearLogs() { vscode.postMessage({ command: 'clearLogs' }); }\r\n        function forceSyncCheck() { vscode.postMessage({ command: 'forceSyncCheck' }); }\r\n\r\n        // Chart.js\r\n        Chart.defaults.color = getComputedStyle(document.body).getPropertyValue('--vscode-editor-foreground') || '#ffffff';\r\n        Chart.defaults.borderColor = getComputedStyle(document.body).getPropertyValue('--vscode-panel-border') || '#333333';\r\n\r\n        const chartColors = ['#4FC3F7','#81C784','#FFB74D','#F06292','#BA68C8','#4DD0E1','#AED581','#FF8A65','#9575CD','#7986CB'];\r\n\r\n        const dailyData = ${JSON.stringify(dailyData)};\r\n        new Chart(document.getElementById('dailyChart'), {\r\n            type: 'bar',\r\n            data: { labels: dailyData.map(d => d.date), datasets: [{ label: 'Hours', data: dailyData.map(d => (d.time/3600000).toFixed(2)), backgroundColor: '#4FC3F7', borderRadius: 4 }] },\r\n            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } }\r\n        });\r\n\r\n        const weeklyData = ${JSON.stringify(weeklyData)};\r\n        new Chart(document.getElementById('weeklyChart'), {\r\n            type: 'bar',\r\n            data: { labels: weeklyData.map(d => d.week), datasets: [{ label: 'Hours', data: weeklyData.map(d => (d.time/3600000).toFixed(2)), backgroundColor: '#81C784', borderRadius: 4 }] },\r\n            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } }\r\n        });\r\n\r\n        const monthlyData = ${JSON.stringify(monthlyData)};\r\n        new Chart(document.getElementById('monthlyChart'), {\r\n            type: 'line',\r\n            data: { labels: monthlyData.map(d => d.month), datasets: [{ label: 'Hours', data: monthlyData.map(d => (d.time/3600000).toFixed(2)), borderColor: '#FFB74D', backgroundColor: 'rgba(255,183,77,0.2)', fill: true, tension: 0.3 }] },\r\n            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } }\r\n        });\r\n\r\n        const projectsData = ${JSON.stringify(Object.entries(projects).map(([name, stats]) => ({ name, time: stats.totalTime })))};\r\n        if (projectsData.length > 0) {\r\n            new Chart(document.getElementById('projectsChart'), {\r\n                type: 'doughnut',\r\n                data: { labels: projectsData.map(d => d.name), datasets: [{ data: projectsData.map(d => (d.time/3600000).toFixed(2)), backgroundColor: chartColors.slice(0, projectsData.length) }] },\r\n                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 12, padding: 10 } } } }\r\n            });\r\n        }\r\n    </script>\r\n</body>\r\n</html>`;\r\n    }\r\n\r\n    /**\r\n     * Format a number with thousands separator\r\n     * @param {number} num \r\n     * @returns {string}\r\n     */\r\n    formatNumber(num) {\r\n        return num.toLocaleString();\r\n    }\r\n\r\n    /**\r\n     * Escape HTML special characters\r\n     * @param {string} text \r\n     * @returns {string}\r\n     */\r\n    escapeHtml(text) {\r\n        const div = { \r\n            '&': '&amp;', \r\n            '<': '&lt;', \r\n            '>': '&gt;', \r\n            '\"': '&quot;', \r\n            \"'\": '&#039;' \r\n        };\r\n        return text.replace(/[&<>\"']/g, (m) => div[m]);\r\n    }\r\n\r\n    /**\r\n     * Dispose the webview\r\n     */\r\n    dispose() {\r\n        if (this.panel) {\r\n            this.panel.dispose();\r\n            this.panel = null;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = { StatsWebView };\r\n","const vscode = require('vscode');\r\nconst { getProjectId } = require('./utils');\r\nconst { createEmptyProjectStats } = require('./types');\r\nconst { logger } = require('./syncLogger');\r\n\r\n/**\r\n * Time tracker for monitoring user activity\r\n */\r\nclass Tracker {\r\n    /**\r\n     * @param {import('./storage').Storage} storage \r\n     */\r\n    constructor(storage) {\r\n        this.storage = storage;\r\n        this.projectId = getProjectId();\r\n        this.isTracking = false;\r\n        this.lastActivity = Date.now();\r\n        this.sessionStartTime = 0;\r\n        this.currentSessionTime = 0;\r\n        this.isAfk = false;\r\n        this.afkThreshold = 300000; // 5 minutes default\r\n        this.checkInterval = null;\r\n        this.disposables = [];\r\n        this.onTimeUpdateCallback = null;\r\n        this.onAfkChangeCallback = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize the tracker\r\n     */\r\n    initialize() {\r\n        // Load configuration\r\n        this.loadConfig();\r\n\r\n        // Listen for config changes\r\n        this.disposables.push(\r\n            vscode.workspace.onDidChangeConfiguration((e) => {\r\n                if (e.affectsConfiguration('punchcardWorkTimer')) {\r\n                    this.loadConfig();\r\n                }\r\n            })\r\n        );\r\n\r\n        // Check if we should track on startup\r\n        const config = vscode.workspace.getConfiguration('punchcardWorkTimer');\r\n        if (config.get('trackOnStartup', true)) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load configuration\r\n     */\r\n    loadConfig() {\r\n        const config = vscode.workspace.getConfiguration('punchcardWorkTimer');\r\n        this.afkThreshold = config.get('afkThreshold', 300000);\r\n    }\r\n\r\n    /**\r\n     * Start tracking\r\n     */\r\n    start() {\r\n        if (this.isTracking) {\r\n            return;\r\n        }\r\n\r\n        this.isTracking = true;\r\n        this.lastActivity = Date.now();\r\n        this.sessionStartTime = Date.now();\r\n        this.currentSessionTime = 0;\r\n        this.isAfk = false;\r\n\r\n        // Register activity listeners\r\n        this.registerActivityListeners();\r\n\r\n        // Start the check interval (every second)\r\n        this.checkInterval = setInterval(() => this.tick(), 1000);\r\n\r\n        // Create a new session\r\n        this.storage.addSession(this.projectId, {\r\n            startTime: this.sessionStartTime,\r\n            endTime: this.sessionStartTime,\r\n            duration: 0\r\n        });\r\n\r\n        logger.info('tracker', `Tracking started for project: ${this.projectId}`, {\r\n            sessionStartTime: this.sessionStartTime\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Stop tracking\r\n     */\r\n    stop() {\r\n        if (!this.isTracking) {\r\n            return;\r\n        }\r\n\r\n        this.isTracking = false;\r\n\r\n        // Clear interval\r\n        if (this.checkInterval) {\r\n            clearInterval(this.checkInterval);\r\n            this.checkInterval = null;\r\n        }\r\n\r\n        // Dispose activity listeners\r\n        this.disposeActivityListeners();\r\n\r\n        // Finalize session\r\n        if (this.sessionStartTime > 0) {\r\n            const endTime = Date.now();\r\n            this.storage.updateLastSession(\r\n                this.projectId,\r\n                this.sessionStartTime,\r\n                endTime,\r\n                this.currentSessionTime\r\n            );\r\n            // Force immediate save on stop\r\n            this.storage._saveImmediate();\r\n            logger.info('tracker', `Tracking stopped for ${this.projectId}. Session duration: ${this.currentSessionTime}ms`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register activity event listeners\r\n     */\r\n    registerActivityListeners() {\r\n        // Text document changes (typing)\r\n        this.disposables.push(\r\n            vscode.workspace.onDidChangeTextDocument((e) => {\r\n                this.onActivity();\r\n                this.trackDocumentChanges(e);\r\n            })\r\n        );\r\n\r\n        // Cursor movement\r\n        this.disposables.push(\r\n            vscode.window.onDidChangeTextEditorSelection(() => {\r\n                this.onActivity();\r\n            })\r\n        );\r\n\r\n        // Scrolling\r\n        this.disposables.push(\r\n            vscode.window.onDidChangeTextEditorVisibleRanges(() => {\r\n                this.onActivity();\r\n            })\r\n        );\r\n\r\n        // File switching\r\n        this.disposables.push(\r\n            vscode.window.onDidChangeActiveTextEditor(() => {\r\n                this.onActivity();\r\n                // Update project ID in case workspace changed\r\n                this.projectId = getProjectId();\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Dispose activity listeners\r\n     */\r\n    disposeActivityListeners() {\r\n        for (const disposable of this.disposables) {\r\n            disposable.dispose();\r\n        }\r\n        this.disposables = [];\r\n    }\r\n\r\n    /**\r\n     * Called when any activity is detected\r\n     */\r\n    onActivity() {\r\n        const wasAfk = this.isAfk;\r\n        this.lastActivity = Date.now();\r\n        this.isAfk = false;\r\n\r\n        if (wasAfk && this.onAfkChangeCallback) {\r\n            this.onAfkChangeCallback(false);\r\n            \r\n            // Start a new session when coming back from AFK\r\n            this.sessionStartTime = Date.now();\r\n            this.currentSessionTime = 0;\r\n            this.storage.addSession(this.projectId, {\r\n                startTime: this.sessionStartTime,\r\n                endTime: this.sessionStartTime,\r\n                duration: 0\r\n            });\r\n            logger.info('tracker', `Returned from AFK, new session started for ${this.projectId}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Track document changes (keystrokes, lines, characters)\r\n     * Distinguishes between typed input and bulk operations (paste, format, git ops)\r\n     * @param {vscode.TextDocumentChangeEvent} event \r\n     */\r\n    trackDocumentChanges(event) {\r\n        if (!event.contentChanges.length) {\r\n            return;\r\n        }\r\n\r\n        let linesAdded = 0;\r\n        let linesDeleted = 0;\r\n        let charsAdded = 0;\r\n        let charsDeleted = 0;\r\n        let keystrokes = 0;\r\n        let linesAddedBulk = 0;\r\n        let linesDeletedBulk = 0;\r\n\r\n        // Threshold to distinguish typing from bulk operations\r\n        // Typing typically involves small changes (1-5 chars at a time)\r\n        // Paste/format/git operations involve larger changes\r\n        const BULK_CHAR_THRESHOLD = 10;\r\n        const BULK_LINE_THRESHOLD = 3;\r\n\r\n        for (const change of event.contentChanges) {\r\n            const textLength = change.text.length;\r\n            const deletedLength = change.rangeLength;\r\n            \r\n            // Count characters (always track these)\r\n            charsAdded += textLength;\r\n            charsDeleted += deletedLength;\r\n\r\n            // Count lines\r\n            const newLines = (change.text.match(/\\n/g) || []).length;\r\n            const deletedLines = change.range.end.line - change.range.start.line;\r\n\r\n            // Detect if this is a bulk operation (paste, format, git merge, etc.)\r\n            const isBulkOperation = \r\n                textLength > BULK_CHAR_THRESHOLD || \r\n                deletedLength > BULK_CHAR_THRESHOLD ||\r\n                newLines > BULK_LINE_THRESHOLD ||\r\n                deletedLines > BULK_LINE_THRESHOLD;\r\n\r\n            if (isBulkOperation) {\r\n                // Track bulk operations separately - these are NOT keystrokes\r\n                // Could be paste, auto-format, git operations, find-replace, etc.\r\n                linesAddedBulk += newLines;\r\n                linesDeletedBulk += deletedLines;\r\n                // No keystrokes for bulk operations\r\n            } else {\r\n                // This looks like actual typing\r\n                linesAdded += newLines;\r\n                linesDeleted += deletedLines;\r\n                \r\n                // Count keystrokes more accurately:\r\n                // - Empty text with deletion = backspace/delete key (1 keystroke)\r\n                // - Single char = 1 keystroke\r\n                // - Small multi-char (autocomplete acceptance) = 1 keystroke\r\n                if (textLength === 0 && deletedLength > 0) {\r\n                    // Backspace or delete key\r\n                    keystrokes += 1;\r\n                } else if (textLength > 0) {\r\n                    // Typing or small autocomplete\r\n                    keystrokes += 1;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Only save metrics if there's something to track\r\n        if (keystrokes > 0 || charsAdded > 0 || charsDeleted > 0 || \r\n            linesAdded > 0 || linesDeleted > 0 || linesAddedBulk > 0 || linesDeletedBulk > 0) {\r\n            this.storage.addMetrics(this.projectId, {\r\n                linesAdded,\r\n                linesDeleted,\r\n                linesAddedBulk,\r\n                linesDeletedBulk,\r\n                charactersAdded: charsAdded,\r\n                charactersDeleted: charsDeleted,\r\n                keystrokes\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Tick function called every second\r\n     */\r\n    tick() {\r\n        if (!this.isTracking) {\r\n            return;\r\n        }\r\n\r\n        const now = Date.now();\r\n        const timeSinceActivity = now - this.lastActivity;\r\n\r\n        // Check for AFK\r\n        if (timeSinceActivity >= this.afkThreshold) {\r\n            if (!this.isAfk) {\r\n                this.isAfk = true;\r\n                \r\n                // Finalize current session\r\n                this.storage.updateLastSession(\r\n                    this.projectId,\r\n                    this.sessionStartTime,\r\n                    this.lastActivity,\r\n                    this.currentSessionTime\r\n                );\r\n                // Force save on AFK\r\n                this.storage._saveImmediate();\r\n\r\n                logger.info('tracker', `AFK detected for ${this.projectId} after ${timeSinceActivity}ms inactivity. Session time: ${this.currentSessionTime}ms`);\r\n\r\n                if (this.onAfkChangeCallback) {\r\n                    this.onAfkChangeCallback(true);\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Add time if not AFK\r\n        if (!this.isAfk) {\r\n            this.currentSessionTime += 1000;\r\n            this.storage.addTime(this.projectId, 1000);\r\n            \r\n            // Update session\r\n            this.storage.updateLastSession(\r\n                this.projectId,\r\n                this.sessionStartTime,\r\n                now,\r\n                this.currentSessionTime\r\n            );\r\n\r\n            if (this.onTimeUpdateCallback) {\r\n                this.onTimeUpdateCallback(this.currentSessionTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set callback for time updates\r\n     * @param {(time: number) => void} callback \r\n     */\r\n    onTimeUpdate(callback) {\r\n        this.onTimeUpdateCallback = callback;\r\n    }\r\n\r\n    /**\r\n     * Set callback for AFK status changes\r\n     * @param {(isAfk: boolean) => void} callback \r\n     */\r\n    onAfkChange(callback) {\r\n        this.onAfkChangeCallback = callback;\r\n    }\r\n\r\n    /**\r\n     * Get current session time\r\n     * @returns {number}\r\n     */\r\n    getCurrentSessionTime() {\r\n        return this.currentSessionTime;\r\n    }\r\n\r\n    /**\r\n     * Get today's total time for current project\r\n     * @returns {number}\r\n     */\r\n    getTodayTime() {\r\n        const stats = this.storage.getProjectStats(this.projectId);\r\n        const startOfDay = new Date();\r\n        startOfDay.setHours(0, 0, 0, 0);\r\n        const startTimestamp = startOfDay.getTime();\r\n        const now = Date.now();\r\n\r\n        let todayTime = 0;\r\n        for (const session of stats.sessions) {\r\n            if (session.startTime >= startTimestamp) {\r\n                // Session started today\r\n                todayTime += session.duration;\r\n            } else if (session.endTime > startTimestamp) {\r\n                // Session spans midnight\r\n                todayTime += session.endTime - startTimestamp;\r\n            }\r\n        }\r\n\r\n        return todayTime;\r\n    }\r\n\r\n    /**\r\n     * Check if currently tracking\r\n     * @returns {boolean}\r\n     */\r\n    isCurrentlyTracking() {\r\n        return this.isTracking && !this.isAfk;\r\n    }\r\n\r\n    /**\r\n     * Get current project ID\r\n     * @returns {string}\r\n     */\r\n    getProjectId() {\r\n        return this.projectId;\r\n    }\r\n\r\n    /**\r\n     * Dispose the tracker\r\n     */\r\n    dispose() {\r\n        this.stop();\r\n        this.disposeActivityListeners();\r\n    }\r\n}\r\n\r\nmodule.exports = { Tracker };\r\n","/**\r\n * @typedef {Object} ProjectStats\r\n * @property {number} totalTime - Total active time in milliseconds\r\n * @property {number} linesAdded - Total lines added (typed)\r\n * @property {number} linesDeleted - Total lines deleted (typed)\r\n * @property {number} linesAddedBulk - Total lines added via bulk operations (paste, format, git)\r\n * @property {number} linesDeletedBulk - Total lines deleted via bulk operations\r\n * @property {number} charactersAdded - Total characters added\r\n * @property {number} charactersDeleted - Total characters deleted\r\n * @property {number} keystrokes - Total keystrokes (actual key presses, not pasted chars)\r\n * @property {Session[]} sessions - Array of work sessions\r\n * @property {number} lastActive - Last active timestamp\r\n * @property {Object.<string, DailyMetrics>} dailyMetrics - Metrics aggregated by day (key: \"YYYY-MM-DD\")\r\n */\r\n\r\n/**\r\n * @typedef {Object} DailyMetrics\r\n * @property {number} time - Active time in milliseconds for that day\r\n * @property {number} keystrokes - Keystrokes for that day\r\n * @property {number} linesAdded - Lines added (typed) for that day\r\n * @property {number} linesDeleted - Lines deleted (typed) for that day\r\n * @property {number} linesAddedBulk - Lines added (bulk) for that day\r\n * @property {number} linesDeletedBulk - Lines deleted (bulk) for that day\r\n * @property {number} charactersAdded - Characters added for that day\r\n * @property {number} charactersDeleted - Characters deleted for that day\r\n */\r\n\r\n/**\r\n * @typedef {Object} Session\r\n * @property {number} startTime - Session start timestamp\r\n * @property {number} endTime - Session end timestamp\r\n * @property {number} duration - Session duration in milliseconds\r\n */\r\n\r\n/**\r\n * @typedef {Object} StorageData\r\n * @property {Object.<string, ProjectStats>} projects - Map of project paths to stats\r\n * @property {number} totalTimeAllProjects - Total time across all projects\r\n * @property {number} totalKeystrokes - Total keystrokes across all projects\r\n */\r\n\r\n/**\r\n * Creates empty daily metrics entry\r\n * @returns {DailyMetrics}\r\n */\r\nfunction createEmptyDailyMetrics() {\r\n    return {\r\n        time: 0,\r\n        keystrokes: 0,\r\n        linesAdded: 0,\r\n        linesDeleted: 0,\r\n        linesAddedBulk: 0,\r\n        linesDeletedBulk: 0,\r\n        charactersAdded: 0,\r\n        charactersDeleted: 0\r\n    };\r\n}\r\n\r\n/**\r\n * Creates a new empty ProjectStats object\r\n * @returns {ProjectStats}\r\n */\r\nfunction createEmptyProjectStats() {\r\n    return {\r\n        totalTime: 0,\r\n        linesAdded: 0,\r\n        linesDeleted: 0,\r\n        linesAddedBulk: 0,\r\n        linesDeletedBulk: 0,\r\n        charactersAdded: 0,\r\n        charactersDeleted: 0,\r\n        keystrokes: 0,\r\n        sessions: [],\r\n        lastActive: 0,\r\n        dailyMetrics: {}\r\n    };\r\n}\r\n\r\n/**\r\n * Creates a new empty StorageData object\r\n * @returns {StorageData}\r\n */\r\nfunction createEmptyStorageData() {\r\n    return {\r\n        projects: {},\r\n        totalTimeAllProjects: 0,\r\n        totalKeystrokes: 0\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    createEmptyProjectStats,\r\n    createEmptyStorageData,\r\n    createEmptyDailyMetrics\r\n};\r\n","module.exports = require(\"vscode\");","const vscode = require('vscode');\n\n/**\n * Format milliseconds to HH:MM:SS string\n * @param {number} ms - Milliseconds to format\n * @returns {string} Formatted time string\n */\nfunction formatTime(ms) {\n    if (ms < 0) ms = 0;\n    \n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    \n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n}\n\n/**\n * Format milliseconds to human readable string\n * @param {number} ms - Milliseconds to format\n * @returns {string} Human readable time string\n */\nfunction formatTimeHuman(ms) {\n    if (ms < 0) ms = 0;\n    \n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    \n    const parts = [];\n    if (hours > 0) parts.push(`${hours}h`);\n    if (minutes > 0) parts.push(`${minutes}m`);\n    if (seconds > 0 || parts.length === 0) parts.push(`${seconds}s`);\n    \n    return parts.join(' ');\n}\n\n/**\n * Get project identifier from workspace\n * @returns {string} Project identifier\n */\nfunction getProjectId() {\n    const workspaceFolders = vscode.workspace.workspaceFolders;\n    \n    if (!workspaceFolders || workspaceFolders.length === 0) {\n        return 'unknown-project';\n    }\n    \n    // Use workspace name if available, otherwise use first folder path\n    const workspaceName = vscode.workspace.name;\n    if (workspaceName) {\n        return workspaceName;\n    }\n    \n    return workspaceFolders[0].uri.fsPath;\n}\n\n/**\n * Get start of today in milliseconds\n * @returns {number} Timestamp of start of today\n */\nfunction getStartOfDay() {\n    const now = new Date();\n    return new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();\n}\n\n/**\n * Get start of week in milliseconds (Monday)\n * @returns {number} Timestamp of start of week\n */\nfunction getStartOfWeek() {\n    const now = new Date();\n    const day = now.getDay();\n    const diff = now.getDate() - day + (day === 0 ? -6 : 1);\n    return new Date(now.getFullYear(), now.getMonth(), diff).getTime();\n}\n\n/**\n * Get start of month in milliseconds\n * @returns {number} Timestamp of start of month\n */\nfunction getStartOfMonth() {\n    const now = new Date();\n    return new Date(now.getFullYear(), now.getMonth(), 1).getTime();\n}\n\n/**\n * Check if a session is within a time range\n * @param {{ startTime: number, endTime: number }} session - Session object\n * @param {number} startRange - Start of range timestamp\n * @param {number} endRange - End of range timestamp\n * @returns {boolean} True if session overlaps with range\n */\nfunction isSessionInRange(session, startRange, endRange) {\n    return session.startTime < endRange && session.endTime > startRange;\n}\n\n/**\n * Calculate time spent in a range from sessions\n * @param {Array<{ startTime: number, endTime: number, duration: number }>} sessions - Array of sessions\n * @param {number} startRange - Start of range timestamp\n * @param {number} endRange - End of range timestamp\n * @returns {number} Time spent in range in milliseconds\n */\nfunction getTimeInRange(sessions, startRange, endRange) {\n    let total = 0;\n    \n    for (const session of sessions) {\n        if (isSessionInRange(session, startRange, endRange)) {\n            const overlapStart = Math.max(session.startTime, startRange);\n            const overlapEnd = Math.min(session.endTime, endRange);\n            total += overlapEnd - overlapStart;\n        }\n    }\n    \n    return total;\n}\n\n/**\n * Get daily breakdown for the last N days\n * @param {Array<{ startTime: number, endTime: number, duration: number }>} sessions - Array of sessions\n * @param {number} days - Number of days to include\n * @returns {Array<{ date: string, time: number }>} Daily breakdown\n */\nfunction getDailyBreakdown(sessions, days = 7) {\n    const result = [];\n    const now = new Date();\n    \n    for (let i = days - 1; i >= 0; i--) {\n        const date = new Date(now.getFullYear(), now.getMonth(), now.getDate() - i);\n        const startOfDay = date.getTime();\n        const endOfDay = startOfDay + 24 * 60 * 60 * 1000;\n        \n        result.push({\n            date: date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),\n            time: getTimeInRange(sessions, startOfDay, endOfDay)\n        });\n    }\n    \n    return result;\n}\n\n/**\n * Get weekly breakdown for the last N weeks\n * @param {Array<{ startTime: number, endTime: number, duration: number }>} sessions - Array of sessions\n * @param {number} weeks - Number of weeks to include\n * @returns {Array<{ week: string, time: number }>} Weekly breakdown\n */\nfunction getWeeklyBreakdown(sessions, weeks = 4) {\n    const result = [];\n    const now = new Date();\n    const currentDay = now.getDay();\n    const diff = now.getDate() - currentDay + (currentDay === 0 ? -6 : 1);\n    \n    for (let i = weeks - 1; i >= 0; i--) {\n        const weekStart = new Date(now.getFullYear(), now.getMonth(), diff - (i * 7));\n        const weekEnd = new Date(weekStart.getTime() + 7 * 24 * 60 * 60 * 1000);\n        \n        result.push({\n            week: `Week of ${weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`,\n            time: getTimeInRange(sessions, weekStart.getTime(), weekEnd.getTime())\n        });\n    }\n    \n    return result;\n}\n\n/**\n * Get monthly breakdown for the last N months\n * @param {Array<{ startTime: number, endTime: number, duration: number }>} sessions - Array of sessions\n * @param {number} months - Number of months to include\n * @returns {Array<{ month: string, time: number }>} Monthly breakdown\n */\nfunction getMonthlyBreakdown(sessions, months = 6) {\n    const result = [];\n    const now = new Date();\n    \n    for (let i = months - 1; i >= 0; i--) {\n        const monthStart = new Date(now.getFullYear(), now.getMonth() - i, 1);\n        const monthEnd = new Date(now.getFullYear(), now.getMonth() - i + 1, 1);\n        \n        result.push({\n            month: monthStart.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }),\n            time: getTimeInRange(sessions, monthStart.getTime(), monthEnd.getTime())\n        });\n    }\n    \n    return result;\n}\n\n/**\n * Get a YYYY-MM-DD date key from a timestamp\n * @param {number} [timestamp] - Timestamp (default: now)\n * @returns {string} Date key in YYYY-MM-DD format\n */\nfunction getDateKey(timestamp) {\n    const d = new Date(timestamp || Date.now());\n    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n}\n\n/**\n * Parse a YYYY-MM-DD date key to start-of-day timestamp\n * @param {string} dateKey - Date key in YYYY-MM-DD format\n * @returns {number} Timestamp of start of that day\n */\nfunction dateKeyToTimestamp(dateKey) {\n    const [year, month, day] = dateKey.split('-').map(Number);\n    return new Date(year, month - 1, day).getTime();\n}\n\n/**\n * Aggregate dailyMetrics entries within a time range.\n * @param {Object.<string, import('./types').DailyMetrics>} dailyMetrics - Map of date keys to metrics\n * @param {number} startTimestamp - Start of range (inclusive)\n * @param {number} endTimestamp - End of range (exclusive)\n * @returns {{ time: number, keystrokes: number, linesAdded: number, linesDeleted: number, linesAddedBulk: number, linesDeletedBulk: number, charactersAdded: number, charactersDeleted: number }}\n */\nfunction aggregateDailyMetrics(dailyMetrics, startTimestamp, endTimestamp) {\n    const result = {\n        time: 0, keystrokes: 0, linesAdded: 0, linesDeleted: 0,\n        linesAddedBulk: 0, linesDeletedBulk: 0, charactersAdded: 0, charactersDeleted: 0\n    };\n    \n    if (!dailyMetrics) return result;\n    \n    for (const [dayKey, metrics] of Object.entries(dailyMetrics)) {\n        const dayTs = dateKeyToTimestamp(dayKey);\n        if (dayTs >= startTimestamp && dayTs < endTimestamp) {\n            result.time += metrics.time || 0;\n            result.keystrokes += metrics.keystrokes || 0;\n            result.linesAdded += metrics.linesAdded || 0;\n            result.linesDeleted += metrics.linesDeleted || 0;\n            result.linesAddedBulk += metrics.linesAddedBulk || 0;\n            result.linesDeletedBulk += metrics.linesDeletedBulk || 0;\n            result.charactersAdded += metrics.charactersAdded || 0;\n            result.charactersDeleted += metrics.charactersDeleted || 0;\n        }\n    }\n    \n    return result;\n}\n\n/**\n * Get end-of-day timestamp (start of next day)\n * @returns {number}\n */\nfunction getEndOfDay() {\n    return getStartOfDay() + 24 * 60 * 60 * 1000;\n}\n\n/**\n * Get end-of-week timestamp (start of next week)\n * @returns {number}\n */\nfunction getEndOfWeek() {\n    return getStartOfWeek() + 7 * 24 * 60 * 60 * 1000;\n}\n\n/**\n * Get end-of-month timestamp (start of next month)\n * @returns {number}\n */\nfunction getEndOfMonth() {\n    const now = new Date();\n    return new Date(now.getFullYear(), now.getMonth() + 1, 1).getTime();\n}\n\nmodule.exports = {\n    formatTime,\n    formatTimeHuman,\n    getProjectId,\n    getStartOfDay,\n    getStartOfWeek,\n    getStartOfMonth,\n    getEndOfDay,\n    getEndOfWeek,\n    getEndOfMonth,\n    getDateKey,\n    dateKeyToTimestamp,\n    isSessionInRange,\n    getTimeInRange,\n    getDailyBreakdown,\n    getWeeklyBreakdown,\n    getMonthlyBreakdown,\n    aggregateDailyMetrics\n};\n","/**\n * Sync Logger for PUNCHCARD extension\n * Logs sync-related events for debugging cross-machine synchronization.\n * \n * Usage: Import the singleton `logger` instance from this module.\n * Logs are stored in memory and can be retrieved for display in the webview.\n */\nclass SyncLogger {\n    constructor() {\n        /** @type {Array<LogEntry>} */\n        this.logs = [];\n        this.maxLogs = 500;\n        this._syncDetectionCount = 0;\n        this._saveCount = 0;\n        this._mergeCount = 0;\n    }\n\n    /**\n     * @typedef {Object} LogEntry\n     * @property {number} timestamp\n     * @property {'info'|'warn'|'error'|'debug'} level\n     * @property {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category\n     * @property {string} message\n     * @property {string|null} data\n     */\n\n    /**\n     * Add a log entry\n     * @param {'info'|'warn'|'error'|'debug'} level \n     * @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category \n     * @param {string} message \n     * @param {any} [data] \n     */\n    log(level, category, message, data = null) {\n        const entry = {\n            timestamp: Date.now(),\n            level,\n            category,\n            message,\n            data: data ? this._safeStringify(data) : null\n        };\n\n        this.logs.push(entry);\n\n        // Trim old logs\n        if (this.logs.length > this.maxLogs) {\n            this.logs = this.logs.slice(-this.maxLogs);\n        }\n\n        // Also output to VS Code developer console for debugging\n        const prefix = `PUNCHCARD [${level.toUpperCase()}] [${category}]`;\n        if (level === 'error') {\n            console.error(prefix, message, data || '');\n        } else if (level === 'warn') {\n            console.warn(prefix, message, data || '');\n        } else {\n            console.log(prefix, message, data || '');\n        }\n    }\n\n    /** @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category */\n    info(category, message, data) { this.log('info', category, message, data); }\n    /** @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category */\n    warn(category, message, data) { this.log('warn', category, message, data); }\n    /** @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category */\n    error(category, message, data) { this.log('error', category, message, data); }\n    /** @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category */\n    debug(category, message, data) { this.log('debug', category, message, data); }\n\n    /**\n     * Increment sync detection counter\n     */\n    recordSyncDetection() {\n        this._syncDetectionCount++;\n    }\n\n    /**\n     * Increment save counter\n     */\n    recordSave() {\n        this._saveCount++;\n    }\n\n    /**\n     * Increment merge counter\n     */\n    recordMerge() {\n        this._mergeCount++;\n    }\n\n    /**\n     * Get counters for display\n     */\n    getCounters() {\n        return {\n            syncDetections: this._syncDetectionCount,\n            saves: this._saveCount,\n            merges: this._mergeCount\n        };\n    }\n\n    /**\n     * Get all logs\n     * @returns {Array<LogEntry>}\n     */\n    getLogs() {\n        return [...this.logs];\n    }\n\n    /**\n     * Get logs filtered by category\n     * @param {string} category \n     * @returns {Array<LogEntry>}\n     */\n    getLogsByCategory(category) {\n        return this.logs.filter(l => l.category === category);\n    }\n\n    /**\n     * Get logs filtered by level\n     * @param {string} level \n     * @returns {Array<LogEntry>}\n     */\n    getLogsByLevel(level) {\n        return this.logs.filter(l => l.level === level);\n    }\n\n    /**\n     * Clear all logs\n     */\n    clear() {\n        this.logs = [];\n        this.info('init', 'Logs cleared');\n    }\n\n    /**\n     * Safely stringify data for logging, handling circular refs and large objects\n     * @param {any} data \n     * @returns {string}\n     */\n    _safeStringify(data) {\n        try {\n            if (typeof data === 'string') return data;\n            return JSON.stringify(data, (key, value) => {\n                // Truncate very long arrays\n                if (Array.isArray(value) && value.length > 10) {\n                    return [...value.slice(0, 10), `... (${value.length} total)`];\n                }\n                // Truncate very long strings\n                if (typeof value === 'string' && value.length > 200) {\n                    return value.substring(0, 200) + '...';\n                }\n                return value;\n            }, 2);\n        } catch (e) {\n            return String(data);\n        }\n    }\n}\n\n// Singleton instance - shared across all modules\nconst logger = new SyncLogger();\n\nmodule.exports = { SyncLogger, logger };\n","const vscode = require('vscode');\r\nconst { Storage } = require('./storage');\r\nconst { Tracker } = require('./tracker');\r\nconst { StatusBar } = require('./statusBar');\r\nconst { StatsWebView } = require('./webview');\r\nconst { logger } = require('./syncLogger');\r\n\r\n/** @type {Storage} */\r\nlet storage;\r\n/** @type {Tracker} */\r\nlet tracker;\r\n/** @type {StatusBar} */\r\nlet statusBar;\r\n/** @type {StatsWebView} */\r\nlet webview;\r\n\r\n/**\r\n * Activate the extension\r\n * @param {vscode.ExtensionContext} context \r\n */\r\nasync function activate(context) {\r\n    console.log('PUNCHCARD - Work Time Statistics is now active!');\r\n    logger.info('init', 'Extension activating...');\r\n\r\n    // Initialize storage\r\n    storage = new Storage(context);\r\n    await storage.initialize();\r\n\r\n    // Initialize tracker\r\n    tracker = new Tracker(storage);\r\n    tracker.initialize();\r\n\r\n    // Initialize status bar\r\n    statusBar = new StatusBar(tracker);\r\n    statusBar.initialize();\r\n\r\n    // Initialize webview\r\n    webview = new StatsWebView(context, storage);\r\n\r\n    // Register commands\r\n    const showStatsCommand = vscode.commands.registerCommand('workTimer.showStats', () => {\r\n        webview.show();\r\n    });\r\n\r\n    const resetProjectCommand = vscode.commands.registerCommand('workTimer.resetProject', async () => {\r\n        const projectId = tracker.getProjectId();\r\n        const confirm = await vscode.window.showWarningMessage(\r\n            `Are you sure you want to reset statistics for \"${projectId}\"?`,\r\n            { modal: true },\r\n            'Yes, Reset'\r\n        );\r\n        if (confirm === 'Yes, Reset') {\r\n            await storage.resetProject(projectId);\r\n            vscode.window.showInformationMessage(`Statistics for \"${projectId}\" have been reset.`);\r\n        }\r\n    });\r\n\r\n    const resetAllCommand = vscode.commands.registerCommand('workTimer.resetAll', async () => {\r\n        const confirm = await vscode.window.showWarningMessage(\r\n            'Are you sure you want to reset ALL statistics? This cannot be undone.',\r\n            { modal: true },\r\n            'Yes, Reset All'\r\n        );\r\n        if (confirm === 'Yes, Reset All') {\r\n            await storage.resetAll();\r\n            vscode.window.showInformationMessage('All statistics have been reset.');\r\n        }\r\n    });\r\n\r\n    const exportDataCommand = vscode.commands.registerCommand('workTimer.exportData', async () => {\r\n        const data = storage.getAllData();\r\n        const jsonContent = JSON.stringify(data, null, 2);\r\n        \r\n        const uri = await vscode.window.showSaveDialog({\r\n            defaultUri: vscode.Uri.file('punchcard-stats.json'),\r\n            filters: {\r\n                'JSON Files': ['json']\r\n            }\r\n        });\r\n\r\n        if (uri) {\r\n            await vscode.workspace.fs.writeFile(uri, Buffer.from(jsonContent, 'utf8'));\r\n            vscode.window.showInformationMessage(`Statistics exported to ${uri.fsPath}`);\r\n        }\r\n    });\r\n\r\n    const importDataCommand = vscode.commands.registerCommand('workTimer.importData', async () => {\r\n        const uri = await vscode.window.showOpenDialog({\r\n            canSelectFiles: true,\r\n            canSelectFolders: false,\r\n            canSelectMany: false,\r\n            filters: {\r\n                'JSON Files': ['json']\r\n            }\r\n        });\r\n\r\n        if (uri && uri[0]) {\r\n            try {\r\n                const fileContent = await vscode.workspace.fs.readFile(uri[0]);\r\n                const importedData = JSON.parse(Buffer.from(fileContent).toString('utf8'));\r\n                \r\n                if (importedData && importedData.projects) {\r\n                    const confirm = await vscode.window.showWarningMessage(\r\n                        'This will merge imported data with existing data. Continue?',\r\n                        { modal: true },\r\n                        'Yes, Import'\r\n                    );\r\n                    \r\n                    if (confirm === 'Yes, Import') {\r\n                        await storage.importData(importedData);\r\n                        vscode.window.showInformationMessage('Data imported successfully!');\r\n                    }\r\n                } else {\r\n                    vscode.window.showErrorMessage('Invalid data format. Expected a valid PUNCHCARD export file.');\r\n                }\r\n            } catch (error) {\r\n                vscode.window.showErrorMessage(`Failed to import data: ${error.message}`);\r\n            }\r\n        }\r\n    });\r\n\r\n    const checkSyncCommand = vscode.commands.registerCommand('workTimer.checkSync', async () => {\r\n        const data = storage.getAllData();\r\n        const projectCount = Object.keys(data.projects).length;\r\n        const totalTime = data.totalTimeAllProjects;\r\n        \r\n        const hours = Math.floor(totalTime / 3600000);\r\n        const minutes = Math.floor((totalTime % 3600000) / 60000);\r\n        \r\n        const message = [\r\n            '📊 PUNCHCARD Sync Status',\r\n            '',\r\n            `Projects tracked: ${projectCount}`,\r\n            `Total time: ${hours}h ${minutes}m`,\r\n            `Total keystrokes: ${data.totalKeystrokes}`,\r\n            '',\r\n            '⚙️ For sync to work:',\r\n            '1. Settings Sync must be ON (Ctrl+Shift+P → \"Settings Sync: Turn On\")',\r\n            '2. \"UI State\" must be checked in sync settings',\r\n            '3. Same Microsoft/GitHub account on both machines',\r\n            '4. Run \"Settings Sync: Sync Now\" to force sync',\r\n            '',\r\n            'Note: Sync may take a few minutes. Reload VS Code after syncing.'\r\n        ].join('\\n');\r\n        \r\n        vscode.window.showInformationMessage(message, { modal: true });\r\n    });\r\n\r\n    const clearSyncLogCommand = vscode.commands.registerCommand('workTimer.clearSyncLog', () => {\r\n        logger.clear();\r\n        if (webview && webview.panel) {\r\n            webview.update();\r\n        }\r\n        vscode.window.showInformationMessage('PUNCHCARD: Sync log cleared.');\r\n    });\r\n\r\n    const forceSyncCheckCommand = vscode.commands.registerCommand('workTimer.forceSyncCheck', async () => {\r\n        logger.info('sync', 'Manual sync check triggered by user');\r\n        await storage.checkForSyncedData();\r\n        if (webview && webview.panel) {\r\n            webview.update();\r\n        }\r\n        vscode.window.showInformationMessage('PUNCHCARD: Sync check completed. Open statistics to see results.');\r\n    });\r\n\r\n    // Add commands to subscriptions\r\n    context.subscriptions.push(\r\n        showStatsCommand,\r\n        resetProjectCommand,\r\n        resetAllCommand,\r\n        exportDataCommand,\r\n        importDataCommand,\r\n        checkSyncCommand,\r\n        clearSyncLogCommand,\r\n        forceSyncCheckCommand\r\n    );\r\n\r\n    // Add disposables\r\n    context.subscriptions.push({\r\n        dispose: () => {\r\n            tracker.dispose();\r\n            statusBar.dispose();\r\n            storage.dispose();\r\n            webview.dispose();\r\n        }\r\n    });\r\n\r\n    logger.info('init', 'Extension activated successfully');\r\n}\r\n\r\n/**\r\n * Deactivate the extension\r\n */\r\nfunction deactivate() {\r\n    logger.info('init', 'Extension deactivating...');\r\n    if (storage) {\r\n        // Flush pending saves before deactivation\r\n        storage.flush();\r\n        storage.dispose();\r\n    }\r\n    if (tracker) {\r\n        tracker.dispose();\r\n    }\r\n    if (statusBar) {\r\n        statusBar.dispose();\r\n    }\r\n    if (webview) {\r\n        webview.dispose();\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    activate,\r\n    deactivate\r\n};\r\n","const vscode = require('vscode');\nconst { formatTime } = require('./utils');\n\n/**\n * Status bar item manager\n */\nclass StatusBar {\n    /**\n     * @param {import('./tracker').Tracker} tracker \n     */\n    constructor(tracker) {\n        this.tracker = tracker;\n        this.statusBarItem = vscode.window.createStatusBarItem(\n            vscode.StatusBarAlignment.Left,\n            100\n        );\n        this.statusBarItem.command = 'workTimer.showStats';\n        this.statusBarItem.tooltip = 'Click to view work time statistics';\n        this.updateInterval = null;\n    }\n\n    /**\n     * Initialize the status bar\n     */\n    initialize() {\n        this.statusBarItem.show();\n        this.update();\n\n        // Update every second\n        this.updateInterval = setInterval(() => this.update(), 1000);\n\n        // Listen for time updates from tracker\n        this.tracker.onTimeUpdate(() => this.update());\n        this.tracker.onAfkChange((isAfk) => this.updateAfkStatus(isAfk));\n    }\n\n    /**\n     * Update the status bar display\n     */\n    update() {\n        const sessionTime = this.tracker.getCurrentSessionTime();\n        const todayTime = this.tracker.getTodayTime();\n        const isTracking = this.tracker.isCurrentlyTracking();\n\n        const sessionStr = formatTime(sessionTime);\n        const todayStr = formatTime(todayTime);\n\n        const icon = isTracking ? '$(clock)' : '$(debug-pause)';\n        this.statusBarItem.text = `${icon} ${sessionStr} | Today: ${todayStr}`;\n        \n        if (!isTracking) {\n            this.statusBarItem.backgroundColor = new vscode.ThemeColor('statusBarItem.warningBackground');\n        } else {\n            this.statusBarItem.backgroundColor = undefined;\n        }\n    }\n\n    /**\n     * Update AFK status display\n     * @param {boolean} isAfk \n     */\n    updateAfkStatus(isAfk) {\n        if (isAfk) {\n            this.statusBarItem.text = `$(debug-pause) AFK - ${this.statusBarItem.text.split(' | ')[1] || ''}`;\n            this.statusBarItem.backgroundColor = new vscode.ThemeColor('statusBarItem.warningBackground');\n        } else {\n            this.statusBarItem.backgroundColor = undefined;\n            this.update();\n        }\n    }\n\n    /**\n     * Dispose the status bar\n     */\n    dispose() {\n        if (this.updateInterval) {\n            clearInterval(this.updateInterval);\n            this.updateInterval = null;\n        }\n        this.statusBarItem.dispose();\n    }\n}\n\nmodule.exports = { StatusBar };\n","const os = require('os');\r\nconst { createEmptyProjectStats, createEmptyStorageData, createEmptyDailyMetrics } = require('./types');\r\nconst { logger } = require('./syncLogger');\r\n\r\nconst STORAGE_KEY = 'punchcard-work-stats';\r\nconst MACHINE_ID_KEY = 'punchcard-machine-id';\r\nconst SYNC_KEYS = [STORAGE_KEY];\r\n// Machine ID key is deliberately NOT in SYNC_KEYS - must be unique per machine\r\n\r\n/**\r\n * Storage manager for work time statistics\r\n * Uses VS Code's globalState with sync enabled for cross-device synchronization\r\n */\r\nclass Storage {\r\n    /**\r\n     * @param {import('vscode').ExtensionContext} context \r\n     */\r\n    constructor(context) {\r\n        this.context = context;\r\n        this.data = createEmptyStorageData();\r\n        this.initialized = false;\r\n        this.syncCheckTimeout = null;\r\n        this.machineId = null;\r\n        this._lastSaveId = null;\r\n        this._saveTimer = null;\r\n        this._periodicSyncInterval = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize storage and set up sync\r\n     */\r\n    async initialize() {\r\n        // Initialize machine ID first (before anything else)\r\n        this._initMachineId();\r\n        \r\n        logger.info('init', `Storage initializing on machine: ${this.machineId}`);\r\n        \r\n        // Enable sync for our storage key - this tells VS Code to sync this key\r\n        // when Settings Sync is enabled and \"UI State\" sync is turned on\r\n        this.context.globalState.setKeysForSync(SYNC_KEYS);\r\n        logger.info('init', 'Sync keys registered', SYNC_KEYS);\r\n        \r\n        // Load existing data\r\n        await this.load();\r\n        this.initialized = true;\r\n        \r\n        logger.info('init', `Storage initialized. Projects: ${Object.keys(this.data.projects).length}, Machine: ${this.machineId}`);\r\n        \r\n        // Log data summary\r\n        const totalSessions = Object.values(this.data.projects).reduce((sum, p) => sum + (p.sessions || []).length, 0);\r\n        logger.info('init', `Data summary: ${Object.keys(this.data.projects).length} projects, ${totalSessions} total sessions, totalTime: ${this.data.totalTimeAllProjects}ms`);\r\n        \r\n        // Check loaded data origin\r\n        if (this.data._machineId && this.data._machineId !== this.machineId) {\r\n            logger.warn('sync', `Loaded data originated from different machine: ${this.data._machineId} (we are ${this.machineId})`);\r\n        }\r\n        \r\n        // Schedule delayed sync checks + periodic checks\r\n        this.scheduleSyncCheck();\r\n        this._startPeriodicSyncCheck();\r\n    }\r\n\r\n    /**\r\n     * Schedule a check for synced data after a delay\r\n     * This helps catch data that syncs after the initial load\r\n     */\r\n    scheduleSyncCheck() {\r\n        // Check after 5 seconds, 15 seconds, and 30 seconds\r\n        const delays = [5000, 15000, 30000];\r\n        \r\n        delays.forEach(delay => {\r\n            setTimeout(async () => {\r\n                logger.debug('sync', `Running scheduled sync check (${delay}ms delay)`);\r\n                await this.checkForSyncedData();\r\n            }, delay);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Start periodic sync checks every 60 seconds\r\n     * This catches sync data that arrives during normal operation\r\n     */\r\n    _startPeriodicSyncCheck() {\r\n        this._periodicSyncInterval = setInterval(async () => {\r\n            logger.debug('sync', 'Running periodic sync check');\r\n            await this.checkForSyncedData();\r\n        }, 60000); // every 60 seconds\r\n    }\r\n\r\n    /**\r\n     * Initialize machine-specific ID (not synced between machines)\r\n     * Uses hostname + random suffix to uniquely identify this VS Code installation\r\n     */\r\n    _initMachineId() {\r\n        let stored = this.context.globalState.get(MACHINE_ID_KEY);\r\n        if (!stored) {\r\n            const hostname = os.hostname();\r\n            stored = `${hostname}-${Date.now().toString(36)}-${Math.random().toString(36).substring(2, 6)}`;\r\n            this.context.globalState.update(MACHINE_ID_KEY, stored);\r\n            logger.info('init', `Generated new machine ID: ${stored}`);\r\n        } else {\r\n            logger.info('init', `Using existing machine ID: ${stored}`);\r\n        }\r\n        this.machineId = stored;\r\n    }\r\n\r\n    /**\r\n     * Get today's date key in YYYY-MM-DD format\r\n     * @returns {string}\r\n     */\r\n    _getDateKey(timestamp) {\r\n        const d = new Date(timestamp || Date.now());\r\n        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\r\n    }\r\n\r\n    /**\r\n     * Check if synced data has arrived and merge it with current data\r\n     */\r\n    async checkForSyncedData() {\r\n        const stored = this.context.globalState.get(STORAGE_KEY);\r\n        \r\n        if (!stored || !stored.projects) {\r\n            logger.debug('sync', 'No stored data found in globalState');\r\n            return;\r\n        }\r\n        \r\n        // CRITICAL FIX: Detect if globalState was overwritten by Settings Sync\r\n        // by checking if the _saveId differs from what we last wrote\r\n        if (stored._saveId && stored._saveId !== this._lastSaveId) {\r\n            logger.info('sync', 'Detected data change via _saveId mismatch', {\r\n                ourLastSaveId: this._lastSaveId,\r\n                storedSaveId: stored._saveId,\r\n                storedMachineId: stored._machineId,\r\n                ourMachineId: this.machineId\r\n            });\r\n            logger.recordSyncDetection();\r\n            this.mergeWithSyncedData(stored);\r\n            await this._saveImmediate();\r\n            return;\r\n        }\r\n        \r\n        // Also check for new projects/sessions we don't have\r\n        let needsMerge = false;\r\n        let mergeReason = '';\r\n        \r\n        for (const projectId in stored.projects) {\r\n            if (!this.data.projects[projectId]) {\r\n                needsMerge = true;\r\n                mergeReason = `New project from sync: ${projectId}`;\r\n                break;\r\n            }\r\n            \r\n            const storedSessions = stored.projects[projectId].sessions || [];\r\n            const currentSessions = this.data.projects[projectId].sessions || [];\r\n            const currentStartTimes = new Set(currentSessions.map(s => s.startTime));\r\n            \r\n            for (const session of storedSessions) {\r\n                if (!currentStartTimes.has(session.startTime)) {\r\n                    needsMerge = true;\r\n                    mergeReason = `New session in ${projectId} (startTime: ${session.startTime})`;\r\n                    break;\r\n                }\r\n                const currentSession = currentSessions.find(s => s.startTime === session.startTime);\r\n                if (currentSession && (session.duration || 0) > (currentSession.duration || 0)) {\r\n                    needsMerge = true;\r\n                    mergeReason = `Updated session in ${projectId} (longer duration)`;\r\n                    break;\r\n                }\r\n            }\r\n            if (needsMerge) break;\r\n        }\r\n        \r\n        if (needsMerge) {\r\n            logger.info('sync', `Sync merge needed: ${mergeReason}`);\r\n            logger.recordSyncDetection();\r\n            this.mergeWithSyncedData(stored);\r\n            await this._saveImmediate();\r\n        } else {\r\n            logger.debug('sync', 'Sync check complete - no new data detected');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Merge synced data with current data.\r\n     * Sessions are merged by startTime (source of truth for time).\r\n     * totalTime is derived from merged sessions to avoid data loss.\r\n     * Other metrics use Math.max as a safe heuristic.\r\n     * @param {import('./types').StorageData} syncedData\r\n     */\r\n    mergeWithSyncedData(syncedData) {\r\n        logger.info('merge', 'Starting merge with synced data', {\r\n            syncedProjects: Object.keys(syncedData.projects || {}),\r\n            currentProjects: Object.keys(this.data.projects || {}),\r\n            syncedMachineId: syncedData._machineId,\r\n            ourMachineId: this.machineId\r\n        });\r\n        \r\n        let newProjectCount = 0;\r\n        let mergedProjectCount = 0;\r\n        let newSessionCount = 0;\r\n        \r\n        for (const projectId in syncedData.projects) {\r\n            const syncedStats = syncedData.projects[projectId];\r\n            \r\n            if (!this.data.projects[projectId]) {\r\n                // New project from sync\r\n                this.data.projects[projectId] = syncedStats;\r\n                newProjectCount++;\r\n                logger.info('merge', `New project from sync: ${projectId}`, {\r\n                    sessions: (syncedStats.sessions || []).length,\r\n                    totalTime: syncedStats.totalTime\r\n                });\r\n            } else {\r\n                // Merge sessions first (source of truth for time)\r\n                const currentStats = this.data.projects[projectId];\r\n                const currentSessionCount = (currentStats.sessions || []).length;\r\n                const syncedSessionCount = (syncedStats.sessions || []).length;\r\n                const mergedSessions = this.mergeSessions(currentStats.sessions || [], syncedStats.sessions || []);\r\n                const addedSessions = mergedSessions.length - currentSessionCount;\r\n                newSessionCount += Math.max(0, addedSessions);\r\n                \r\n                // Derive totalTime from merged sessions\r\n                const totalTimeFromSessions = mergedSessions.reduce((sum, s) => sum + (s.duration || 0), 0);\r\n                \r\n                this.data.projects[projectId] = {\r\n                    totalTime: totalTimeFromSessions,\r\n                    linesAdded: Math.max(currentStats.linesAdded || 0, syncedStats.linesAdded || 0),\r\n                    linesDeleted: Math.max(currentStats.linesDeleted || 0, syncedStats.linesDeleted || 0),\r\n                    linesAddedBulk: Math.max(currentStats.linesAddedBulk || 0, syncedStats.linesAddedBulk || 0),\r\n                    linesDeletedBulk: Math.max(currentStats.linesDeletedBulk || 0, syncedStats.linesDeletedBulk || 0),\r\n                    charactersAdded: Math.max(currentStats.charactersAdded || 0, syncedStats.charactersAdded || 0),\r\n                    charactersDeleted: Math.max(currentStats.charactersDeleted || 0, syncedStats.charactersDeleted || 0),\r\n                    keystrokes: Math.max(currentStats.keystrokes || 0, syncedStats.keystrokes || 0),\r\n                    sessions: mergedSessions,\r\n                    lastActive: Math.max(currentStats.lastActive || 0, syncedStats.lastActive || 0),\r\n                    dailyMetrics: this._mergeDailyMetrics(currentStats.dailyMetrics || {}, syncedStats.dailyMetrics || {})\r\n                };\r\n                \r\n                mergedProjectCount++;\r\n                if (addedSessions > 0) {\r\n                    logger.info('merge', `Merged project ${projectId}: +${addedSessions} sessions (${currentSessionCount} + ${syncedSessionCount} synced → ${mergedSessions.length} merged)`);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Recalculate totals from merged data\r\n        this.recalculateTotals();\r\n        logger.recordMerge();\r\n        \r\n        logger.info('merge', `Merge complete: ${newProjectCount} new projects, ${mergedProjectCount} merged projects, ${newSessionCount} new sessions`);\r\n    }\r\n\r\n    /**\r\n     * Merge session arrays, avoiding duplicates based on startTime.\r\n     * When both have a session with the same startTime, keeps the one\r\n     * with the longer duration (more complete/up-to-date).\r\n     */\r\n    mergeSessions(currentSessions, syncedSessions) {\r\n        const sessionMap = new Map();\r\n        \r\n        // Add current sessions\r\n        for (const session of currentSessions) {\r\n            sessionMap.set(session.startTime, session);\r\n        }\r\n        \r\n        // Merge synced sessions — keep the one with longer duration\r\n        let replaced = 0;\r\n        let added = 0;\r\n        for (const session of syncedSessions) {\r\n            const existing = sessionMap.get(session.startTime);\r\n            if (!existing) {\r\n                sessionMap.set(session.startTime, session);\r\n                added++;\r\n            } else if ((session.duration || 0) > (existing.duration || 0)) {\r\n                // Synced version is more complete, use it\r\n                sessionMap.set(session.startTime, session);\r\n                replaced++;\r\n            }\r\n        }\r\n        \r\n        if (added > 0 || replaced > 0) {\r\n            logger.debug('merge', `Session merge: ${added} new, ${replaced} replaced (longer duration)`);\r\n        }\r\n        \r\n        // Return sorted by startTime\r\n        return Array.from(sessionMap.values()).sort((a, b) => a.startTime - b.startTime);\r\n    }\r\n\r\n    /**\r\n     * Merge dailyMetrics from two sources. For each day, takes Math.max per field,\r\n     * since each machine accumulates independently and we want the higher value.\r\n     */\r\n    _mergeDailyMetrics(current, synced) {\r\n        const merged = { ...current };\r\n        for (const dayKey in synced) {\r\n            if (!merged[dayKey]) {\r\n                merged[dayKey] = { ...synced[dayKey] };\r\n            } else {\r\n                const c = merged[dayKey];\r\n                const s = synced[dayKey];\r\n                merged[dayKey] = {\r\n                    time: Math.max(c.time || 0, s.time || 0),\r\n                    keystrokes: Math.max(c.keystrokes || 0, s.keystrokes || 0),\r\n                    linesAdded: Math.max(c.linesAdded || 0, s.linesAdded || 0),\r\n                    linesDeleted: Math.max(c.linesDeleted || 0, s.linesDeleted || 0),\r\n                    linesAddedBulk: Math.max(c.linesAddedBulk || 0, s.linesAddedBulk || 0),\r\n                    linesDeletedBulk: Math.max(c.linesDeletedBulk || 0, s.linesDeletedBulk || 0),\r\n                    charactersAdded: Math.max(c.charactersAdded || 0, s.charactersAdded || 0),\r\n                    charactersDeleted: Math.max(c.charactersDeleted || 0, s.charactersDeleted || 0)\r\n                };\r\n            }\r\n        }\r\n        return merged;\r\n    }\r\n\r\n    /**\r\n     * Recalculate total values from all projects.\r\n     * Derives totalTime from sessions (source of truth) to ensure\r\n     * accurate totals after cross-machine merges.\r\n     */\r\n    recalculateTotals() {\r\n        const oldTotal = this.data.totalTimeAllProjects;\r\n        this.data.totalTimeAllProjects = 0;\r\n        this.data.totalKeystrokes = 0;\r\n        \r\n        for (const projectId in this.data.projects) {\r\n            const stats = this.data.projects[projectId];\r\n            // Derive totalTime from sessions (source of truth)\r\n            const sessionTime = (stats.sessions || []).reduce((sum, s) => sum + (s.duration || 0), 0);\r\n            stats.totalTime = sessionTime;\r\n            this.data.totalTimeAllProjects += sessionTime;\r\n            this.data.totalKeystrokes += stats.keystrokes || 0;\r\n        }\r\n        \r\n        if (oldTotal !== this.data.totalTimeAllProjects) {\r\n            logger.debug('storage', `Totals recalculated: ${oldTotal}ms → ${this.data.totalTimeAllProjects}ms (delta: ${this.data.totalTimeAllProjects - oldTotal}ms)`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load data from global state\r\n     */\r\n    async load() {\r\n        const stored = this.context.globalState.get(STORAGE_KEY);\r\n        \r\n        if (stored) {\r\n            this.data = {\r\n                projects: stored.projects || {},\r\n                totalTimeAllProjects: stored.totalTimeAllProjects || 0,\r\n                totalKeystrokes: stored.totalKeystrokes || 0,\r\n                _saveId: stored._saveId || null,\r\n                _machineId: stored._machineId || null,\r\n                _lastSaveTime: stored._lastSaveTime || null\r\n            };\r\n            // Track the save ID so we can detect when sync overwrites it\r\n            this._lastSaveId = stored._saveId || null;\r\n            \r\n            logger.info('storage', 'Loaded existing data from globalState', {\r\n                projects: Object.keys(this.data.projects).length,\r\n                totalTime: this.data.totalTimeAllProjects,\r\n                loadedSaveId: this._lastSaveId,\r\n                loadedMachineId: this.data._machineId\r\n            });\r\n        } else {\r\n            this.data = createEmptyStorageData();\r\n            this._lastSaveId = null;\r\n            logger.info('storage', 'No existing data found, starting fresh');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save data to global state\r\n     */\r\n    /**\r\n     * Internal save with sync detection.\r\n     * Before writing, checks if globalState was overwritten by Settings Sync\r\n     * (detected via _saveId mismatch) and merges if needed.\r\n     */\r\n    async save() {\r\n        // CRITICAL SYNC FIX: Before saving, check if Settings Sync has\r\n        // overwritten our data with data from another machine.\r\n        // We detect this by comparing the _saveId in globalState with\r\n        // the _saveId we last wrote.\r\n        try {\r\n            const currentStored = this.context.globalState.get(STORAGE_KEY);\r\n            if (currentStored && currentStored._saveId && currentStored._saveId !== this._lastSaveId) {\r\n                logger.warn('sync', 'SYNC DETECTED: globalState was modified by another source (Settings Sync)', {\r\n                    ourLastSaveId: this._lastSaveId,\r\n                    storedSaveId: currentStored._saveId,\r\n                    storedMachineId: currentStored._machineId,\r\n                    ourMachineId: this.machineId\r\n                });\r\n                logger.recordSyncDetection();\r\n                this.mergeWithSyncedData(currentStored);\r\n            }\r\n        } catch (e) {\r\n            logger.error('storage', `Error during pre-save sync check: ${e.message}`);\r\n        }\r\n        \r\n        // Stamp our data with our save ID and machine ID\r\n        this._lastSaveId = `${this.machineId}-${Date.now()}`;\r\n        this.data._saveId = this._lastSaveId;\r\n        this.data._machineId = this.machineId;\r\n        this.data._lastSaveTime = Date.now();\r\n        \r\n        await this.context.globalState.update(STORAGE_KEY, this.data);\r\n        logger.recordSave();\r\n    }\r\n\r\n    /**\r\n     * Schedule a debounced save. Used by high-frequency operations (addTime, updateLastSession)\r\n     * to reduce save frequency and give sync data a chance to survive.\r\n     * Data is saved at most every 10 seconds.\r\n     */\r\n    _scheduleSave() {\r\n        if (this._saveTimer) return; // already scheduled\r\n        this._saveTimer = setTimeout(async () => {\r\n            this._saveTimer = null;\r\n            await this.save();\r\n        }, 10000); // 10 second debounce\r\n    }\r\n\r\n    /**\r\n     * Force an immediate save, cancelling any pending debounced save.\r\n     * Used for important operations and cleanup.\r\n     */\r\n    async _saveImmediate() {\r\n        if (this._saveTimer) {\r\n            clearTimeout(this._saveTimer);\r\n            this._saveTimer = null;\r\n        }\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Flush any pending saves. Call this before extension deactivates.\r\n     */\r\n    async flush() {\r\n        if (this._saveTimer) {\r\n            clearTimeout(this._saveTimer);\r\n            this._saveTimer = null;\r\n            await this.save();\r\n            logger.info('storage', 'Flushed pending save on deactivation');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get stats for a specific project\r\n     * @param {string} projectId \r\n     * @returns {import('./types').ProjectStats}\r\n     */\r\n    getProjectStats(projectId) {\r\n        if (!this.data.projects[projectId]) {\r\n            this.data.projects[projectId] = createEmptyProjectStats();\r\n        }\r\n        const stats = this.data.projects[projectId];\r\n        // Ensure dailyMetrics exists (backward compat)\r\n        if (!stats.dailyMetrics) {\r\n            stats.dailyMetrics = {};\r\n        }\r\n        return stats;\r\n    }\r\n\r\n    /**\r\n     * Update stats for a project\r\n     * @param {string} projectId \r\n     * @param {Partial<import('./types').ProjectStats>} updates \r\n     */\r\n    async updateProjectStats(projectId, updates) {\r\n        const stats = this.getProjectStats(projectId);\r\n        Object.assign(stats, updates);\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Add time to a project\r\n     * @param {string} projectId \r\n     * @param {number} timeMs \r\n     */\r\n    async addTime(projectId, timeMs) {\r\n        const stats = this.getProjectStats(projectId);\r\n        stats.totalTime += timeMs;\r\n        stats.lastActive = Date.now();\r\n        this.data.totalTimeAllProjects += timeMs;\r\n        // Track daily time\r\n        const dayKey = this._getDateKey();\r\n        if (!stats.dailyMetrics[dayKey]) stats.dailyMetrics[dayKey] = createEmptyDailyMetrics();\r\n        stats.dailyMetrics[dayKey].time += timeMs;\r\n        // Use debounced save - this is called every second\r\n        this._scheduleSave();\r\n    }\r\n\r\n    /**\r\n     * Add a completed session\r\n     * @param {string} projectId \r\n     * @param {import('./types').Session} session \r\n     */\r\n    async addSession(projectId, session) {\r\n        const stats = this.getProjectStats(projectId);\r\n        // Tag session with machine ID for sync identification\r\n        session.machineId = this.machineId;\r\n        stats.sessions.push(session);\r\n        logger.info('session', `New session started for ${projectId}`, {\r\n            startTime: session.startTime,\r\n            machineId: this.machineId\r\n        });\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Update the last session end time\r\n     * @param {string} projectId \r\n     * @param {number} endTime \r\n     * @param {number} duration \r\n     */\r\n    /**\r\n     * Update a session's end time and duration.\r\n     * CRITICAL FIX: Finds session by startTime instead of using last index,\r\n     * because after a sync merge the last session may belong to another machine.\r\n     * @param {string} projectId \r\n     * @param {number} sessionStartTime - The startTime of the session to update\r\n     * @param {number} endTime \r\n     * @param {number} duration \r\n     */\r\n    async updateLastSession(projectId, sessionStartTime, endTime, duration) {\r\n        const stats = this.getProjectStats(projectId);\r\n        if (stats.sessions.length > 0) {\r\n            // CRITICAL FIX: Find session by startTime, not by index.\r\n            // After merge, the last session in the array may be from another machine.\r\n            const session = stats.sessions.find(s => s.startTime === sessionStartTime);\r\n            if (session) {\r\n                session.endTime = endTime;\r\n                session.duration = duration;\r\n                // Use debounced save - this is called every second\r\n                this._scheduleSave();\r\n            } else {\r\n                // Fallback: try last session from this machine\r\n                const machineSession = stats.sessions\r\n                    .filter(s => !s.machineId || s.machineId === this.machineId)\r\n                    .pop();\r\n                if (machineSession) {\r\n                    machineSession.endTime = endTime;\r\n                    machineSession.duration = duration;\r\n                    this._scheduleSave();\r\n                    logger.warn('session', `Session not found by startTime ${sessionStartTime}, used fallback (last session from this machine)`);\r\n                } else {\r\n                    logger.error('session', `Could not find session to update for ${projectId} (startTime: ${sessionStartTime})`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add metrics to a project\r\n     * @param {string} projectId \r\n     * @param {{ linesAdded?: number, linesDeleted?: number, linesAddedBulk?: number, linesDeletedBulk?: number, charactersAdded?: number, charactersDeleted?: number, keystrokes?: number }} metrics \r\n     */\r\n    async addMetrics(projectId, metrics) {\r\n        const stats = this.getProjectStats(projectId);\r\n        const dayKey = this._getDateKey();\r\n        if (!stats.dailyMetrics[dayKey]) stats.dailyMetrics[dayKey] = createEmptyDailyMetrics();\r\n        const day = stats.dailyMetrics[dayKey];\r\n        \r\n        if (metrics.linesAdded) {\r\n            stats.linesAdded += metrics.linesAdded;\r\n            day.linesAdded += metrics.linesAdded;\r\n        }\r\n        if (metrics.linesDeleted) {\r\n            stats.linesDeleted += metrics.linesDeleted;\r\n            day.linesDeleted += metrics.linesDeleted;\r\n        }\r\n        if (metrics.linesAddedBulk) {\r\n            if (typeof stats.linesAddedBulk !== 'number') stats.linesAddedBulk = 0;\r\n            stats.linesAddedBulk += metrics.linesAddedBulk;\r\n            day.linesAddedBulk += metrics.linesAddedBulk;\r\n        }\r\n        if (metrics.linesDeletedBulk) {\r\n            if (typeof stats.linesDeletedBulk !== 'number') stats.linesDeletedBulk = 0;\r\n            stats.linesDeletedBulk += metrics.linesDeletedBulk;\r\n            day.linesDeletedBulk += metrics.linesDeletedBulk;\r\n        }\r\n        if (metrics.charactersAdded) {\r\n            stats.charactersAdded += metrics.charactersAdded;\r\n            day.charactersAdded += metrics.charactersAdded;\r\n        }\r\n        if (metrics.charactersDeleted) {\r\n            stats.charactersDeleted += metrics.charactersDeleted;\r\n            day.charactersDeleted += metrics.charactersDeleted;\r\n        }\r\n        if (metrics.keystrokes) {\r\n            stats.keystrokes += metrics.keystrokes;\r\n            this.data.totalKeystrokes += metrics.keystrokes;\r\n            day.keystrokes += metrics.keystrokes;\r\n        }\r\n        \r\n        stats.lastActive = Date.now();\r\n        // Use debounced save - addMetrics can be called very frequently\r\n        this._scheduleSave();\r\n    }\r\n\r\n    /**\r\n     * Reset a specific stat for a project\r\n     * @param {string} projectId \r\n     * @param {string} statName - The stat to reset (keystrokes, linesAdded, linesDeleted, linesAddedBulk, linesDeletedBulk, charactersAdded, charactersDeleted, totalTime, sessions)\r\n     */\r\n    async resetProjectStat(projectId, statName) {\r\n        if (!this.data.projects[projectId]) {\r\n            return;\r\n        }\r\n        \r\n        const stats = this.data.projects[projectId];\r\n        \r\n        switch (statName) {\r\n            case 'keystrokes':\r\n                this.data.totalKeystrokes -= stats.keystrokes || 0;\r\n                stats.keystrokes = 0;\r\n                break;\r\n            case 'linesAdded':\r\n                stats.linesAdded = 0;\r\n                break;\r\n            case 'linesDeleted':\r\n                stats.linesDeleted = 0;\r\n                break;\r\n            case 'linesAddedBulk':\r\n                stats.linesAddedBulk = 0;\r\n                break;\r\n            case 'linesDeletedBulk':\r\n                stats.linesDeletedBulk = 0;\r\n                break;\r\n            case 'charactersAdded':\r\n                stats.charactersAdded = 0;\r\n                break;\r\n            case 'charactersDeleted':\r\n                stats.charactersDeleted = 0;\r\n                break;\r\n            case 'totalTime':\r\n                this.data.totalTimeAllProjects -= stats.totalTime || 0;\r\n                stats.totalTime = 0;\r\n                break;\r\n            case 'sessions':\r\n                stats.sessions = [];\r\n                break;\r\n            case 'allLines':\r\n                stats.linesAdded = 0;\r\n                stats.linesDeleted = 0;\r\n                stats.linesAddedBulk = 0;\r\n                stats.linesDeletedBulk = 0;\r\n                break;\r\n            case 'allChars':\r\n                stats.charactersAdded = 0;\r\n                stats.charactersDeleted = 0;\r\n                break;\r\n            case 'dailyMetrics':\r\n                stats.dailyMetrics = {};\r\n                break;\r\n        }\r\n        \r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Reset a specific stat across ALL projects (global reset)\r\n     * @param {string} statName - The stat to reset globally\r\n     */\r\n    async resetGlobalStat(statName) {\r\n        for (const projectId in this.data.projects) {\r\n            const stats = this.data.projects[projectId];\r\n            \r\n            switch (statName) {\r\n                case 'keystrokes':\r\n                    stats.keystrokes = 0;\r\n                    break;\r\n                case 'linesAdded':\r\n                    stats.linesAdded = 0;\r\n                    break;\r\n                case 'linesDeleted':\r\n                    stats.linesDeleted = 0;\r\n                    break;\r\n                case 'linesAddedBulk':\r\n                    stats.linesAddedBulk = 0;\r\n                    break;\r\n                case 'linesDeletedBulk':\r\n                    stats.linesDeletedBulk = 0;\r\n                    break;\r\n                case 'charactersAdded':\r\n                    stats.charactersAdded = 0;\r\n                    break;\r\n                case 'charactersDeleted':\r\n                    stats.charactersDeleted = 0;\r\n                    break;\r\n                case 'totalTime':\r\n                    stats.totalTime = 0;\r\n                    break;\r\n                case 'sessions':\r\n                    stats.sessions = [];\r\n                    break;\r\n            }\r\n        }\r\n        \r\n        // Update totals\r\n        if (statName === 'keystrokes') {\r\n            this.data.totalKeystrokes = 0;\r\n        }\r\n        if (statName === 'totalTime') {\r\n            this.data.totalTimeAllProjects = 0;\r\n        }\r\n        \r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Reset stats for a specific project\r\n     * @param {string} projectId \r\n     */\r\n    async resetProject(projectId) {\r\n        if (this.data.projects[projectId]) {\r\n            const oldStats = this.data.projects[projectId];\r\n            this.data.totalTimeAllProjects -= oldStats.totalTime;\r\n            this.data.totalKeystrokes -= oldStats.keystrokes;\r\n            delete this.data.projects[projectId];\r\n            await this.save();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset all statistics\r\n     */\r\n    async resetAll() {\r\n        this.data = createEmptyStorageData();\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Import data from an exported JSON file (merges with existing data)\r\n     * @param {import('./types').StorageData} importedData \r\n     */\r\n    async importData(importedData) {\r\n        if (!importedData || !importedData.projects) {\r\n            throw new Error('Invalid data format');\r\n        }\r\n\r\n        logger.info('storage', 'Importing data', {\r\n            projectCount: Object.keys(importedData.projects).length\r\n        });\r\n\r\n        // Merge imported data with existing data\r\n        for (const projectId in importedData.projects) {\r\n            const importedStats = importedData.projects[projectId];\r\n            \r\n            if (!this.data.projects[projectId]) {\r\n                // New project, add it directly\r\n                this.data.projects[projectId] = importedStats;\r\n            } else {\r\n                // Existing project, merge sessions and derive totalTime\r\n                const existingStats = this.data.projects[projectId];\r\n                const mergedSessions = this.mergeSessions(existingStats.sessions || [], importedStats.sessions || []);\r\n                const totalTimeFromSessions = mergedSessions.reduce((sum, s) => sum + (s.duration || 0), 0);\r\n                \r\n                this.data.projects[projectId] = {\r\n                    totalTime: totalTimeFromSessions,\r\n                    linesAdded: Math.max(existingStats.linesAdded || 0, importedStats.linesAdded || 0),\r\n                    linesDeleted: Math.max(existingStats.linesDeleted || 0, importedStats.linesDeleted || 0),\r\n                    linesAddedBulk: Math.max(existingStats.linesAddedBulk || 0, importedStats.linesAddedBulk || 0),\r\n                    linesDeletedBulk: Math.max(existingStats.linesDeletedBulk || 0, importedStats.linesDeletedBulk || 0),\r\n                    charactersAdded: Math.max(existingStats.charactersAdded || 0, importedStats.charactersAdded || 0),\r\n                    charactersDeleted: Math.max(existingStats.charactersDeleted || 0, importedStats.charactersDeleted || 0),\r\n                    keystrokes: Math.max(existingStats.keystrokes || 0, importedStats.keystrokes || 0),\r\n                    sessions: mergedSessions,\r\n                    lastActive: Math.max(existingStats.lastActive || 0, importedStats.lastActive || 0),\r\n                    dailyMetrics: this._mergeDailyMetrics(existingStats.dailyMetrics || {}, importedStats.dailyMetrics || {})\r\n                };\r\n            }\r\n        }\r\n\r\n        // Recalculate totals\r\n        this.data.totalTimeAllProjects = 0;\r\n        this.data.totalKeystrokes = 0;\r\n        for (const projectId in this.data.projects) {\r\n            this.data.totalTimeAllProjects += this.data.projects[projectId].totalTime || 0;\r\n            this.data.totalKeystrokes += this.data.projects[projectId].keystrokes || 0;\r\n        }\r\n\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Get all data for export (strips internal sync metadata)\r\n     * @returns {import('./types').StorageData}\r\n     */\r\n    getAllData() {\r\n        const { _saveId, _machineId, _lastSaveTime, ...cleanData } = this.data;\r\n        return { ...cleanData };\r\n    }\r\n\r\n    /**\r\n     * Get sync diagnostic information for the webview log panel\r\n     * @returns {Object}\r\n     */\r\n    getSyncInfo() {\r\n        const counters = logger.getCounters();\r\n        const totalSessions = Object.values(this.data.projects).reduce(\r\n            (sum, p) => sum + (p.sessions || []).length, 0\r\n        );\r\n        \r\n        // Count sessions per machine\r\n        const sessionsByMachine = {};\r\n        for (const projectId in this.data.projects) {\r\n            for (const session of (this.data.projects[projectId].sessions || [])) {\r\n                const mid = session.machineId || 'unknown';\r\n                sessionsByMachine[mid] = (sessionsByMachine[mid] || 0) + 1;\r\n            }\r\n        }\r\n        \r\n        return {\r\n            machineId: this.machineId,\r\n            lastSaveId: this._lastSaveId,\r\n            lastSaveTime: this.data._lastSaveTime,\r\n            savedMachineId: this.data._machineId,\r\n            syncDetections: counters.syncDetections,\r\n            totalSaves: counters.saves,\r\n            totalMerges: counters.merges,\r\n            projectCount: Object.keys(this.data.projects).length,\r\n            totalSessions,\r\n            sessionsByMachine\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Dispose storage resources\r\n     */\r\n    dispose() {\r\n        if (this._saveTimer) {\r\n            clearTimeout(this._saveTimer);\r\n            this._saveTimer = null;\r\n        }\r\n        if (this._periodicSyncInterval) {\r\n            clearInterval(this._periodicSyncInterval);\r\n            this._periodicSyncInterval = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get summary statistics\r\n     */\r\n    getSummary() {\r\n        const projectCount = Object.keys(this.data.projects).length;\r\n        let totalSessions = 0;\r\n        let totalLinesAdded = 0;\r\n        let totalLinesDeleted = 0;\r\n        let totalLinesAddedBulk = 0;\r\n        let totalLinesDeletedBulk = 0;\r\n        let totalCharsAdded = 0;\r\n        let totalCharsDeleted = 0;\r\n\r\n        for (const projectId in this.data.projects) {\r\n            const stats = this.data.projects[projectId];\r\n            totalSessions += stats.sessions.length;\r\n            totalLinesAdded += stats.linesAdded || 0;\r\n            totalLinesDeleted += stats.linesDeleted || 0;\r\n            totalLinesAddedBulk += stats.linesAddedBulk || 0;\r\n            totalLinesDeletedBulk += stats.linesDeletedBulk || 0;\r\n            totalCharsAdded += stats.charactersAdded || 0;\r\n            totalCharsDeleted += stats.charactersDeleted || 0;\r\n        }\r\n\r\n        return {\r\n            projectCount,\r\n            totalTime: this.data.totalTimeAllProjects,\r\n            totalKeystrokes: this.data.totalKeystrokes,\r\n            totalSessions,\r\n            totalLinesAdded,\r\n            totalLinesDeleted,\r\n            totalLinesAddedBulk,\r\n            totalLinesDeletedBulk,\r\n            totalCharsAdded,\r\n            totalCharsDeleted\r\n        };\r\n    }\r\n}\r\n\r\nmodule.exports = { Storage, STORAGE_KEY };\r\n","module.exports = require(\"os\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(497);\n"],"names":["vscode","formatTime","formatTimeHuman","getDailyBreakdown","getWeeklyBreakdown","getMonthlyBreakdown","getTimeInRange","getStartOfDay","getStartOfWeek","getStartOfMonth","getEndOfDay","getEndOfWeek","getEndOfMonth","aggregateDailyMetrics","logger","module","exports","StatsWebView","constructor","context","storage","this","panel","show","reveal","ViewColumn","One","update","window","createWebviewPanel","enableScripts","retainContextWhenHidden","webview","html","getWebviewContent","onDidReceiveMessage","async","message","command","showWarningMessage","projectId","modal","resetProject","showInformationMessage","statLabel","resetProjectStat","statName","resetGlobalStat","clear","checkForSyncedData","undefined","subscriptions","onDidDispose","projects","getAllData","allSessions","push","sessions","dailyData","weeklyData","monthlyData","periods","today","start","end","label","week","month","all","Date","now","periodData","periodKey","range","Object","entries","gTime","gKeystrokes","gLinesAdded","gLinesDeleted","gLinesAddedBulk","gLinesDeletedBulk","gCharsAdded","gCharsDeleted","gSessions","projectPeriodData","stats","sessionsInRange","filter","s","startTime","endTime","timeInRange","metrics","time","totalTime","keystrokes","linesAdded","linesDeleted","linesAddedBulk","linesDeletedBulk","charactersAdded","charactersDeleted","dailyMetrics","length","lastActive","summary","totalKeystrokes","totalSessions","totalLinesAdded","totalLinesDeleted","totalLinesAddedBulk","totalLinesDeletedBulk","totalCharsAdded","totalCharsDeleted","projectCount","keys","syncInfo","getSyncInfo","syncLogs","getLogs","projectList","map","id","sort","a","b","machineId","lastSaveTime","toLocaleString","totalSaves","syncDetections","totalMerges","sessionsByMachine","mid","count","substring","join","slice","reverse","entry","timestamp","toLocaleTimeString","category","level","toUpperCase","escapeHtml","data","JSON","stringify","name","formatNumber","num","text","div","replace","m","dispose","getProjectId","createEmptyProjectStats","Tracker","isTracking","lastActivity","sessionStartTime","currentSessionTime","isAfk","afkThreshold","checkInterval","disposables","onTimeUpdateCallback","onAfkChangeCallback","initialize","loadConfig","workspace","onDidChangeConfiguration","e","affectsConfiguration","getConfiguration","get","config","registerActivityListeners","setInterval","tick","addSession","duration","info","stop","clearInterval","disposeActivityListeners","updateLastSession","_saveImmediate","onDidChangeTextDocument","onActivity","trackDocumentChanges","onDidChangeTextEditorSelection","onDidChangeTextEditorVisibleRanges","onDidChangeActiveTextEditor","disposable","wasAfk","event","contentChanges","charsAdded","charsDeleted","change","textLength","deletedLength","rangeLength","newLines","match","deletedLines","line","addMetrics","timeSinceActivity","addTime","onTimeUpdate","callback","onAfkChange","getCurrentSessionTime","getTodayTime","getProjectStats","startOfDay","setHours","startTimestamp","getTime","todayTime","session","isCurrentlyTracking","createEmptyStorageData","totalTimeAllProjects","createEmptyDailyMetrics","require","getFullYear","getMonth","getDate","day","getDay","diff","isSessionInRange","startRange","endRange","total","overlapStart","Math","max","min","dateKeyToTimestamp","dateKey","year","split","Number","ms","totalSeconds","floor","hours","minutes","seconds","toString","padStart","parts","workspaceFolders","uri","fsPath","getDateKey","d","String","days","result","i","date","endOfDay","toLocaleDateString","weekday","weeks","currentDay","weekStart","weekEnd","months","monthStart","monthEnd","endTimestamp","dayKey","dayTs","SyncLogger","logs","maxLogs","_syncDetectionCount","_saveCount","_mergeCount","log","_safeStringify","prefix","console","error","warn","debug","recordSyncDetection","recordSave","recordMerge","getCounters","saves","merges","getLogsByCategory","l","getLogsByLevel","key","value","Array","isArray","Storage","StatusBar","tracker","statusBar","activate","showStatsCommand","commands","registerCommand","resetProjectCommand","resetAllCommand","resetAll","exportDataCommand","jsonContent","showSaveDialog","defaultUri","Uri","file","filters","fs","writeFile","Buffer","from","importDataCommand","showOpenDialog","canSelectFiles","canSelectFolders","canSelectMany","fileContent","readFile","importedData","parse","importData","showErrorMessage","checkSyncCommand","clearSyncLogCommand","forceSyncCheckCommand","deactivate","flush","statusBarItem","createStatusBarItem","StatusBarAlignment","Left","tooltip","updateInterval","updateAfkStatus","sessionTime","sessionStr","todayStr","icon","backgroundColor","ThemeColor","os","STORAGE_KEY","MACHINE_ID_KEY","SYNC_KEYS","initialized","syncCheckTimeout","_lastSaveId","_saveTimer","_periodicSyncInterval","_initMachineId","globalState","setKeysForSync","load","values","reduce","sum","p","_machineId","scheduleSyncCheck","_startPeriodicSyncCheck","forEach","delay","setTimeout","stored","hostname","random","_getDateKey","_saveId","ourLastSaveId","storedSaveId","storedMachineId","ourMachineId","mergeWithSyncedData","needsMerge","mergeReason","storedSessions","currentSessions","currentStartTimes","Set","has","currentSession","find","syncedData","syncedProjects","currentProjects","syncedMachineId","newProjectCount","mergedProjectCount","newSessionCount","syncedStats","currentStats","currentSessionCount","syncedSessionCount","mergedSessions","mergeSessions","addedSessions","totalTimeFromSessions","_mergeDailyMetrics","recalculateTotals","syncedSessions","sessionMap","Map","set","replaced","added","existing","current","synced","merged","c","oldTotal","_lastSaveTime","loadedSaveId","loadedMachineId","save","currentStored","_scheduleSave","clearTimeout","updateProjectStats","updates","assign","timeMs","machineSession","pop","oldStats","Error","importedStats","existingStats","cleanData","counters","lastSaveId","savedMachineId","getSummary","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"ignoreList":[],"sourceRoot":""}