{"version":3,"file":"extension.js","mappings":"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","sources":["webpack://punchcard-work-time-statistics/./src/webview.js","webpack://punchcard-work-time-statistics/./src/tracker.js","webpack://punchcard-work-time-statistics/./src/types.js","webpack://punchcard-work-time-statistics/external commonjs \"vscode\"","webpack://punchcard-work-time-statistics/./src/utils.js","webpack://punchcard-work-time-statistics/./src/syncLogger.js","webpack://punchcard-work-time-statistics/./src/extension.js","webpack://punchcard-work-time-statistics/./src/statusBar.js","webpack://punchcard-work-time-statistics/./src/storage.js","webpack://punchcard-work-time-statistics/external node-commonjs \"os\"","webpack://punchcard-work-time-statistics/webpack/bootstrap","webpack://punchcard-work-time-statistics/webpack/startup"],"sourcesContent":["const vscode = require('vscode');\r\nconst { formatTime, formatTimeHuman, getDailyBreakdown, getWeeklyBreakdown, getMonthlyBreakdown, getTimeInRange, getStartOfDay, getStartOfWeek, getStartOfMonth, getEndOfDay, getEndOfWeek, getEndOfMonth, aggregateDailyMetrics } = require('./utils');\r\nconst { logger } = require('./syncLogger');\r\n\r\n/**\r\n * WebView panel for displaying statistics\r\n */\r\nclass StatsWebView {\r\n    /**\r\n     * @param {vscode.ExtensionContext} context \r\n     * @param {import('./storage').Storage} storage \r\n     */\r\n    constructor(context, storage) {\r\n        this.context = context;\r\n        this.storage = storage;\r\n        this.panel = null;\r\n    }\r\n\r\n    /**\r\n     * Show the statistics panel\r\n     */\r\n    show() {\r\n        if (this.panel) {\r\n            this.panel.reveal(vscode.ViewColumn.One);\r\n            this.update();\r\n            return;\r\n        }\r\n\r\n        this.panel = vscode.window.createWebviewPanel(\r\n            'workTimerStats',\r\n            'PUNCHCARD - Work Time Statistics',\r\n            vscode.ViewColumn.One,\r\n            {\r\n                enableScripts: true,\r\n                retainContextWhenHidden: true\r\n            }\r\n        );\r\n\r\n        this.panel.webview.html = this.getWebviewContent();\r\n\r\n        this.panel.webview.onDidReceiveMessage(\r\n            async (message) => {\r\n                switch (message.command) {\r\n                    case 'resetProject':\r\n                        const confirmReset = await vscode.window.showWarningMessage(\r\n                            `Are you sure you want to reset statistics for \"${message.projectId}\"?`,\r\n                            { modal: true },\r\n                            'Yes, Reset'\r\n                        );\r\n                        if (confirmReset === 'Yes, Reset') {\r\n                            await this.storage.resetProject(message.projectId);\r\n                            this.update();\r\n                            vscode.window.showInformationMessage(`Statistics for \"${message.projectId}\" have been reset.`);\r\n                        }\r\n                        break;\r\n                    case 'resetStat':\r\n                        const confirmStatReset = await vscode.window.showWarningMessage(\r\n                            `Are you sure you want to reset ${message.statLabel} for \"${message.projectId}\"?`,\r\n                            { modal: true },\r\n                            'Yes, Reset'\r\n                        );\r\n                        if (confirmStatReset === 'Yes, Reset') {\r\n                            await this.storage.resetProjectStat(message.projectId, message.statName);\r\n                            this.update();\r\n                            vscode.window.showInformationMessage(`${message.statLabel} for \"${message.projectId}\" has been reset.`);\r\n                        }\r\n                        break;\r\n                    case 'resetGlobalStat':\r\n                        const confirmGlobalReset = await vscode.window.showWarningMessage(\r\n                            `Are you sure you want to reset ${message.statLabel} for ALL projects?`,\r\n                            { modal: true },\r\n                            'Yes, Reset All'\r\n                        );\r\n                        if (confirmGlobalReset === 'Yes, Reset All') {\r\n                            await this.storage.resetGlobalStat(message.statName);\r\n                            this.update();\r\n                            vscode.window.showInformationMessage(`${message.statLabel} has been reset for all projects.`);\r\n                        }\r\n                        break;\r\n                    case 'refresh':\r\n                        this.update();\r\n                        break;\r\n                    case 'clearLogs':\r\n                        logger.clear();\r\n                        this.update();\r\n                        break;\r\n                    case 'forceSyncCheck':\r\n                        await this.storage.checkForSyncedData();\r\n                        this.update();\r\n                        break;\r\n                    case 'exportLogs':\r\n                        {\r\n                            const logText = logger.exportLogs();\r\n                            const syncInfo = this.storage.getSyncInfo ? this.storage.getSyncInfo() : {};\r\n                            const fullExport = logText + '\\n\\n=== SYNC INFO ===\\n' + JSON.stringify(syncInfo, null, 2);\r\n                            await vscode.env.clipboard.writeText(fullExport);\r\n                            vscode.window.showInformationMessage('PUNCHCARD: Sync log copied to clipboard! You can paste it for debugging.');\r\n                        }\r\n                        break;\r\n                }\r\n            },\r\n            undefined,\r\n            this.context.subscriptions\r\n        );\r\n\r\n        this.panel.onDidDispose(\r\n            () => {\r\n                this.panel = null;\r\n            },\r\n            null,\r\n            this.context.subscriptions\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Update the webview content\r\n     */\r\n    update() {\r\n        if (this.panel) {\r\n            this.panel.webview.html = this.getWebviewContent();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get the HTML content for the webview\r\n     * @returns {string}\r\n     */\r\n    getWebviewContent() {\r\n        const data = this.storage.getAllData();\r\n        const projects = data.projects;\r\n\r\n        // Collect all sessions\r\n        const allSessions = [];\r\n        for (const projectId in projects) {\r\n            allSessions.push(...(projects[projectId].sessions || []));\r\n        }\r\n\r\n        // Chart breakdown data (always shown)\r\n        const dailyData = getDailyBreakdown(allSessions, 7);\r\n        const weeklyData = getWeeklyBreakdown(allSessions, 4);\r\n        const monthlyData = getMonthlyBreakdown(allSessions, 6);\r\n\r\n        // Period boundaries\r\n        const periods = {\r\n            today: { start: getStartOfDay(), end: getEndOfDay(), label: 'Today' },\r\n            week:  { start: getStartOfWeek(), end: getEndOfWeek(), label: 'This Week' },\r\n            month: { start: getStartOfMonth(), end: getEndOfMonth(), label: 'This Month' },\r\n            all:   { start: 0, end: Date.now() + 86400000, label: 'All Time' }\r\n        };\r\n\r\n        // Pre-compute per-period data for each project and globally\r\n        const periodData = {};\r\n        for (const [periodKey, range] of Object.entries(periods)) {\r\n            let gTime = 0, gKeystrokes = 0, gLinesAdded = 0, gLinesDeleted = 0;\r\n            let gLinesAddedBulk = 0, gLinesDeletedBulk = 0, gCharsAdded = 0, gCharsDeleted = 0;\r\n            let gSessions = 0;\r\n            const projectPeriodData = {};\r\n\r\n            for (const [projectId, stats] of Object.entries(projects)) {\r\n                const sessionsInRange = (stats.sessions || []).filter(s => \r\n                    s.startTime < range.end && s.endTime > range.start\r\n                );\r\n                const timeInRange = getTimeInRange(stats.sessions || [], range.start, range.end);\r\n\r\n                let metrics;\r\n                if (periodKey === 'all') {\r\n                    // For \"all time\", use project totals (includes pre-dailyMetrics data)\r\n                    metrics = {\r\n                        time: stats.totalTime || 0,\r\n                        keystrokes: stats.keystrokes || 0,\r\n                        linesAdded: stats.linesAdded || 0,\r\n                        linesDeleted: stats.linesDeleted || 0,\r\n                        linesAddedBulk: stats.linesAddedBulk || 0,\r\n                        linesDeletedBulk: stats.linesDeletedBulk || 0,\r\n                        charactersAdded: stats.charactersAdded || 0,\r\n                        charactersDeleted: stats.charactersDeleted || 0\r\n                    };\r\n                } else {\r\n                    metrics = aggregateDailyMetrics(stats.dailyMetrics || {}, range.start, range.end);\r\n                    // For time, prefer session-based calculation (more accurate for partial days)\r\n                    metrics.time = timeInRange;\r\n                }\r\n\r\n                projectPeriodData[projectId] = {\r\n                    ...metrics,\r\n                    sessions: sessionsInRange.length,\r\n                    lastActive: stats.lastActive || 0\r\n                };\r\n\r\n                gTime += metrics.time;\r\n                gKeystrokes += metrics.keystrokes;\r\n                gLinesAdded += metrics.linesAdded;\r\n                gLinesDeleted += metrics.linesDeleted;\r\n                gLinesAddedBulk += metrics.linesAddedBulk;\r\n                gLinesDeletedBulk += metrics.linesDeletedBulk;\r\n                gCharsAdded += metrics.charactersAdded;\r\n                gCharsDeleted += metrics.charactersDeleted;\r\n                gSessions += sessionsInRange.length;\r\n            }\r\n\r\n            periodData[periodKey] = {\r\n                label: range.label,\r\n                summary: {\r\n                    totalTime: gTime,\r\n                    totalKeystrokes: gKeystrokes,\r\n                    totalSessions: gSessions,\r\n                    totalLinesAdded: gLinesAdded,\r\n                    totalLinesDeleted: gLinesDeleted,\r\n                    totalLinesAddedBulk: gLinesAddedBulk,\r\n                    totalLinesDeletedBulk: gLinesDeletedBulk,\r\n                    totalCharsAdded: gCharsAdded,\r\n                    totalCharsDeleted: gCharsDeleted,\r\n                    projectCount: Object.keys(projects).length\r\n                },\r\n                projects: projectPeriodData\r\n            };\r\n        }\r\n\r\n        // Get sync info and logs for the debug panel\r\n        const syncInfo = this.storage.getSyncInfo ? this.storage.getSyncInfo() : {};\r\n        const syncLogs = logger.getLogs();\r\n\r\n        // Project list for rendering (sorted by totalTime desc)\r\n        const projectList = Object.entries(projects)\r\n            .map(([id, stats]) => ({ id, lastActive: stats.lastActive }))\r\n            .sort((a, b) => (b.lastActive || 0) - (a.lastActive || 0));\r\n\r\n        return `<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>PUNCHCARD - Work Time Statistics</title>\r\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\r\n    <style>\r\n        :root {\r\n            --bg-color: var(--vscode-editor-background);\r\n            --text-color: var(--vscode-editor-foreground);\r\n            --border-color: var(--vscode-panel-border);\r\n            --card-bg: var(--vscode-editorWidget-background);\r\n            --accent-color: var(--vscode-button-background);\r\n            --accent-hover: var(--vscode-button-hoverBackground);\r\n            --danger-color: var(--vscode-errorForeground);\r\n        }\r\n\r\n        * { margin: 0; padding: 0; box-sizing: border-box; }\r\n\r\n        body {\r\n            font-family: var(--vscode-font-family);\r\n            background-color: var(--bg-color);\r\n            color: var(--text-color);\r\n            padding: 20px;\r\n            line-height: 1.6;\r\n        }\r\n\r\n        h1, h2, h3 { margin-bottom: 15px; font-weight: 600; }\r\n        h1 { font-size: 24px; display: flex; align-items: center; gap: 10px; }\r\n        h1::before { content: \"⏱️\"; }\r\n\r\n        .header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            margin-bottom: 20px;\r\n            padding-bottom: 15px;\r\n            border-bottom: 1px solid var(--border-color);\r\n        }\r\n\r\n        .header-actions { display: flex; gap: 10px; align-items: center; }\r\n\r\n        .refresh-btn {\r\n            background-color: var(--card-bg);\r\n            color: var(--text-color);\r\n            border: 1px solid var(--border-color);\r\n            padding: 8px 16px;\r\n            border-radius: 4px;\r\n            cursor: pointer;\r\n            font-size: 13px;\r\n            transition: all 0.15s;\r\n        }\r\n\r\n        .refresh-btn:hover {\r\n            background-color: var(--accent-hover);\r\n            color: var(--vscode-button-foreground);\r\n            border-color: var(--accent-hover);\r\n        }\r\n\r\n        .period-btn {\r\n            background-color: transparent;\r\n            color: var(--text-color);\r\n            border: 1px solid transparent;\r\n            padding: 8px 16px;\r\n            border-radius: 4px;\r\n            cursor: pointer;\r\n            font-size: 13px;\r\n            transition: background-color 0.15s, color 0.15s;\r\n        }\r\n\r\n        .period-btn:hover {\r\n            background-color: rgba(128, 128, 128, 0.15);\r\n        }\r\n\r\n        .period-tabs {\r\n            display: flex;\r\n            gap: 4px;\r\n            margin-bottom: 25px;\r\n            padding: 4px;\r\n            background-color: var(--card-bg);\r\n            border-radius: 8px;\r\n            border: 1px solid var(--border-color);\r\n            width: fit-content;\r\n        }\r\n\r\n        .period-btn.active {\r\n            background-color: var(--accent-color);\r\n            color: var(--vscode-button-foreground);\r\n            border-color: transparent;\r\n        }\r\n\r\n        .summary-grid {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));\r\n            gap: 12px;\r\n            margin-bottom: 30px;\r\n        }\r\n\r\n        .summary-card {\r\n            background-color: var(--card-bg);\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 8px;\r\n            padding: 18px;\r\n            text-align: center;\r\n            position: relative;\r\n        }\r\n\r\n        .summary-card:hover .summary-reset-btn { opacity: 1; }\r\n\r\n        .summary-reset-btn {\r\n            position: absolute; top: 5px; right: 5px;\r\n            background: transparent; border: none;\r\n            color: var(--danger-color); cursor: pointer;\r\n            font-size: 10px; padding: 2px 6px;\r\n            opacity: 0; transition: opacity 0.2s; border-radius: 3px;\r\n        }\r\n        .summary-reset-btn:hover { background-color: var(--danger-color); color: white; }\r\n\r\n        .summary-card .value {\r\n            font-size: 26px;\r\n            font-weight: bold;\r\n            color: var(--accent-color);\r\n            margin-bottom: 4px;\r\n        }\r\n\r\n        .summary-card .label {\r\n            font-size: 11px;\r\n            opacity: 0.8;\r\n            text-transform: uppercase;\r\n        }\r\n\r\n        .charts-container {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\r\n            gap: 20px;\r\n            margin-bottom: 30px;\r\n        }\r\n\r\n        .chart-card {\r\n            background-color: var(--card-bg);\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 8px;\r\n            padding: 20px;\r\n        }\r\n        .chart-card h3 { margin-bottom: 20px; }\r\n        .chart-container { position: relative; height: 250px; }\r\n\r\n        .projects-section { margin-top: 30px; }\r\n\r\n        .project-card {\r\n            background-color: var(--card-bg);\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 8px;\r\n            padding: 20px;\r\n            margin-bottom: 15px;\r\n        }\r\n\r\n        .project-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            margin-bottom: 15px;\r\n        }\r\n\r\n        .project-name { font-size: 18px; font-weight: 600; }\r\n\r\n        .reset-btn {\r\n            background-color: transparent;\r\n            color: var(--danger-color);\r\n            border: 1px solid var(--danger-color);\r\n            padding: 5px 10px; border-radius: 4px;\r\n            cursor: pointer; font-size: 12px;\r\n        }\r\n        .reset-btn:hover { background-color: var(--danger-color); color: white; }\r\n\r\n        .project-stats {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));\r\n            gap: 10px;\r\n        }\r\n\r\n        .stat { display: flex; flex-direction: column; position: relative; }\r\n        .stat:hover .stat-reset-btn { opacity: 1; }\r\n\r\n        .stat-reset-btn {\r\n            position: absolute; top: 0; right: 0;\r\n            background: transparent; border: none;\r\n            color: var(--danger-color); cursor: pointer;\r\n            font-size: 10px; padding: 2px 5px;\r\n            opacity: 0; transition: opacity 0.2s; border-radius: 3px;\r\n        }\r\n        .stat-reset-btn:hover { background-color: var(--danger-color); color: white; }\r\n\r\n        .stat .stat-value { font-size: 18px; font-weight: bold; }\r\n        .stat .stat-label { font-size: 10px; opacity: 0.7; text-transform: uppercase; }\r\n\r\n        .no-data { text-align: center; padding: 40px; opacity: 0.6; }\r\n\r\n        .period-badge {\r\n            display: inline-block;\r\n            font-size: 11px;\r\n            padding: 2px 8px;\r\n            border-radius: 10px;\r\n            background-color: var(--accent-color);\r\n            color: var(--vscode-button-foreground);\r\n            margin-left: 10px;\r\n            vertical-align: middle;\r\n        }\r\n\r\n        @media (max-width: 600px) {\r\n            .charts-container { grid-template-columns: 1fr; }\r\n        }\r\n\r\n        /* Sync & Debug Log Styles */\r\n        .sync-log-section {\r\n            margin-top: 30px;\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 8px;\r\n            overflow: hidden;\r\n        }\r\n        .sync-log-header {\r\n            display: flex; justify-content: space-between; align-items: center;\r\n            padding: 15px 20px; cursor: pointer;\r\n            background-color: var(--card-bg); user-select: none;\r\n        }\r\n        .sync-log-header:hover { opacity: 0.9; }\r\n        .sync-log-header h2 { margin-bottom: 0; font-size: 16px; }\r\n        .sync-log-toggle { font-size: 14px; transition: transform 0.2s; }\r\n        .sync-log-toggle.open { transform: rotate(90deg); }\r\n        .sync-log-content { padding: 20px; display: none; }\r\n        .sync-log-content.visible { display: block; }\r\n        .sync-info-grid {\r\n            display: grid;\r\n            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));\r\n            gap: 10px; margin-bottom: 20px;\r\n        }\r\n        .sync-info-card {\r\n            background-color: var(--card-bg);\r\n            border: 1px solid var(--border-color);\r\n            border-radius: 6px; padding: 12px; text-align: center;\r\n        }\r\n        .sync-info-value {\r\n            font-size: 14px; font-weight: bold;\r\n            color: var(--accent-color); margin-bottom: 4px; word-break: break-all;\r\n        }\r\n        .sync-info-label { font-size: 10px; opacity: 0.7; text-transform: uppercase; }\r\n        .log-controls {\r\n            display: flex; gap: 10px; margin-bottom: 15px;\r\n            align-items: center; flex-wrap: wrap;\r\n        }\r\n        .log-controls select {\r\n            background-color: var(--card-bg); color: var(--text-color);\r\n            border: 1px solid var(--border-color); padding: 5px 10px;\r\n            border-radius: 4px; font-size: 12px;\r\n        }\r\n        .log-controls .clear-btn {\r\n            background-color: transparent; color: var(--danger-color);\r\n            border: 1px solid var(--danger-color); padding: 5px 10px;\r\n            border-radius: 4px; cursor: pointer; font-size: 12px;\r\n        }\r\n        .log-controls .clear-btn:hover { background-color: var(--danger-color); color: white; }\r\n        .log-controls .sync-check-btn {\r\n            background-color: var(--accent-color); color: var(--vscode-button-foreground);\r\n            border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;\r\n        }\r\n        .log-controls .sync-check-btn:hover { background-color: var(--accent-hover); }\r\n        .log-entries {\r\n            max-height: 400px; overflow-y: auto;\r\n            font-family: 'Cascadia Code', 'Fira Code', 'Consolas', monospace;\r\n            font-size: 11px; line-height: 1.4;\r\n            background-color: var(--bg-color);\r\n            border: 1px solid var(--border-color); border-radius: 4px; padding: 10px;\r\n        }\r\n        .log-entry { padding: 2px 0; border-bottom: 1px solid rgba(128,128,128,0.1); }\r\n        .log-entry:last-child { border-bottom: none; }\r\n        .log-time { color: #888; margin-right: 8px; }\r\n        .log-level { font-weight: bold; margin-right: 6px; display: inline-block; min-width: 50px; }\r\n        .log-level.info { color: #4FC3F7; }\r\n        .log-level.warn { color: #FFB74D; }\r\n        .log-level.error { color: #EF5350; }\r\n        .log-level.debug { color: #888; }\r\n        .log-category { color: #BA68C8; margin-right: 6px; }\r\n        .log-message { color: var(--text-color); }\r\n        .log-data { color: #888; font-size: 10px; margin-left: 20px; white-space: pre-wrap; display: none; }\r\n        .log-entry.expanded .log-data { display: block; }\r\n        .log-expand-btn {\r\n            background: none; border: 1px solid rgba(128,128,128,0.3); color: #888;\r\n            cursor: pointer; font-family: monospace; font-size: 10px; padding: 0 4px;\r\n            margin-right: 6px; border-radius: 3px; line-height: 16px; vertical-align: middle;\r\n            min-width: 20px; text-align: center;\r\n        }\r\n        .log-expand-btn:hover { background-color: rgba(128,128,128,0.2); color: var(--text-color); }\r\n        .log-count { font-size: 11px; opacity: 0.6; margin-left: 10px; }\r\n        .export-btn {\r\n            background-color: var(--card-bg); color: var(--text-color);\r\n            border: 1px solid var(--border-color); padding: 5px 10px;\r\n            border-radius: 4px; cursor: pointer; font-size: 12px;\r\n        }\r\n        .export-btn:hover { background-color: var(--accent-color); color: var(--vscode-button-foreground); border-color: var(--accent-color); }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"header\">\r\n        <h1>PUNCHCARD - Work Time Statistics</h1>\r\n        <div class=\"header-actions\">\r\n            <button class=\"refresh-btn\" onclick=\"refresh()\">🔄 Refresh</button>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Period Selector Tabs -->\r\n    <div class=\"period-tabs\">\r\n        <button class=\"period-btn active\" data-period=\"all\" onclick=\"switchPeriod('all')\">All Time</button>\r\n        <button class=\"period-btn\" data-period=\"month\" onclick=\"switchPeriod('month')\">This Month</button>\r\n        <button class=\"period-btn\" data-period=\"week\" onclick=\"switchPeriod('week')\">This Week</button>\r\n        <button class=\"period-btn\" data-period=\"today\" onclick=\"switchPeriod('today')\">Today</button>\r\n    </div>\r\n\r\n    <!-- Summary (rendered by JS) -->\r\n    <div class=\"summary-grid\" id=\"summaryGrid\"></div>\r\n\r\n    <!-- Charts -->\r\n    <div class=\"charts-container\">\r\n        <div class=\"chart-card\">\r\n            <h3>📅 Daily Activity (Last 7 Days)</h3>\r\n            <div class=\"chart-container\"><canvas id=\"dailyChart\"></canvas></div>\r\n        </div>\r\n        <div class=\"chart-card\">\r\n            <h3>📊 Weekly Activity (Last 4 Weeks)</h3>\r\n            <div class=\"chart-container\"><canvas id=\"weeklyChart\"></canvas></div>\r\n        </div>\r\n        <div class=\"chart-card\">\r\n            <h3>📈 Monthly Activity (Last 6 Months)</h3>\r\n            <div class=\"chart-container\"><canvas id=\"monthlyChart\"></canvas></div>\r\n        </div>\r\n        <div class=\"chart-card\">\r\n            <h3>🥧 Time by Project</h3>\r\n            <div class=\"chart-container\"><canvas id=\"projectsChart\"></canvas></div>\r\n        </div>\r\n    </div>\r\n\r\n    <!-- Projects (rendered by JS) -->\r\n    <div class=\"projects-section\">\r\n        <h2>📁 Projects <span class=\"period-badge\" id=\"periodBadge\">All Time</span></h2>\r\n        <div id=\"projectsContainer\"></div>\r\n    </div>\r\n\r\n    <!-- Sync & Debug Log Section -->\r\n    <div class=\"sync-log-section\">\r\n        <div class=\"sync-log-header\" onclick=\"toggleSyncLog()\">\r\n            <h2>🔧 Sync & Debug Log</h2>\r\n            <span class=\"sync-log-toggle\" id=\"syncLogToggle\">▶</span>\r\n        </div>\r\n        <div class=\"sync-log-content\" id=\"syncLogContent\">\r\n            <div class=\"sync-info-grid\">\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.machineId || 'N/A'}</div>\r\n                    <div class=\"sync-info-label\">Machine ID</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.lastSaveTime ? new Date(syncInfo.lastSaveTime).toLocaleString() : 'Never'}</div>\r\n                    <div class=\"sync-info-label\">Last Save</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.totalSaves || 0}</div>\r\n                    <div class=\"sync-info-label\">Total Saves</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.syncDetections || 0}</div>\r\n                    <div class=\"sync-info-label\">Sync Events Detected</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.totalMerges || 0}</div>\r\n                    <div class=\"sync-info-label\">Data Merges</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${syncInfo.totalSessions || 0}</div>\r\n                    <div class=\"sync-info-label\">Total Sessions</div>\r\n                </div>\r\n                <div class=\"sync-info-card\">\r\n                    <div class=\"sync-info-value\">${Object.entries(syncInfo.sessionsByMachine || {}).map(([mid, count]) => mid.substring(0, 15) + ': ' + count).join('<br>') || 'N/A'}</div>\r\n                    <div class=\"sync-info-label\">Sessions by Machine</div>\r\n                </div>\r\n            </div>\r\n            <div class=\"log-controls\">\r\n                <select id=\"logFilter\" onchange=\"filterLogs()\">\r\n                    <option value=\"all\">All Categories</option>\r\n                    <option value=\"sync\">Sync</option>\r\n                    <option value=\"storage\">Storage</option>\r\n                    <option value=\"tracker\">Tracker</option>\r\n                    <option value=\"session\">Session</option>\r\n                    <option value=\"merge\">Merge</option>\r\n                    <option value=\"init\">Init</option>\r\n                </select>\r\n                <select id=\"logLevelFilter\" onchange=\"filterLogs()\">\r\n                    <option value=\"all\">All Levels</option>\r\n                    <option value=\"error\">Errors Only</option>\r\n                    <option value=\"warn\">Warnings & Errors</option>\r\n                    <option value=\"info\">Info & Above</option>\r\n                </select>\r\n                <button class=\"sync-check-btn\" onclick=\"forceSyncCheck()\">🔄 Force Sync Check</button>\r\n                <button class=\"export-btn\" onclick=\"exportLogs()\">📋 Export Logs</button>\r\n                <button class=\"clear-btn\" onclick=\"clearLogs()\">🗑️ Clear Logs</button>\r\n                <span class=\"log-count\">${syncLogs.length} entries</span>\r\n            </div>\r\n            <div class=\"log-entries\" id=\"logEntries\">\r\n                ${syncLogs.length === 0 ? '<div style=\"opacity:0.5; text-align:center; padding:20px;\">No log entries yet. Logs will appear as sync events occur.</div>' : \r\n                    syncLogs.slice().reverse().map(entry => {\r\n                        const time = new Date(entry.timestamp).toLocaleTimeString();\r\n                        const hasData = !!entry.data;\r\n                        return `<div class=\"log-entry\" data-category=\"${entry.category}\" data-level=\"${entry.level}\">\r\n                            ${hasData ? `<button class=\"log-expand-btn\" onclick=\"toggleLogData(this)\" title=\"Show/hide details\">[+]</button>` : '<span style=\"display:inline-block;min-width:26px;\"></span>'}\r\n                            <span class=\"log-time\">${time}</span>\r\n                            <span class=\"log-level ${entry.level}\">[${entry.level.toUpperCase()}]</span>\r\n                            <span class=\"log-category\">[${entry.category}]</span>\r\n                            <span class=\"log-message\">${this.escapeHtml(entry.message)}</span>\r\n                            ${entry.data ? `<div class=\"log-data\">${this.escapeHtml(entry.data)}</div>` : ''}\r\n                        </div>`;\r\n                    }).join('')\r\n                }\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <script>\r\n        const vscode = acquireVsCodeApi();\r\n        const periodData = ${JSON.stringify(periodData)};\r\n        const projectList = ${JSON.stringify(projectList)};\r\n        let currentPeriod = 'all';\r\n\r\n        function fmtTime(ms) {\r\n            if (ms < 0) ms = 0;\r\n            const s = Math.floor(ms / 1000);\r\n            const h = Math.floor(s / 3600);\r\n            const m = Math.floor((s % 3600) / 60);\r\n            const sec = s % 60;\r\n            return h.toString().padStart(2,'0') + ':' + m.toString().padStart(2,'0') + ':' + sec.toString().padStart(2,'0');\r\n        }\r\n\r\n        function fmtNum(n) { return (n || 0).toLocaleString(); }\r\n\r\n        function esc(text) {\r\n            const d = {'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;',\"'\": '&#039;'};\r\n            return String(text).replace(/[&<>\"']/g, m => d[m]);\r\n        }\r\n\r\n        function switchPeriod(period) {\r\n            currentPeriod = period;\r\n            document.querySelectorAll('.period-btn').forEach(btn => {\r\n                btn.classList.toggle('active', btn.getAttribute('data-period') === period);\r\n            });\r\n            renderSummary();\r\n            renderProjects();\r\n        }\r\n\r\n        function renderSummary() {\r\n            const pd = periodData[currentPeriod];\r\n            if (!pd) return;\r\n            const s = pd.summary;\r\n            const grid = document.getElementById('summaryGrid');\r\n            grid.innerHTML = \\`\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('totalTime', 'Total Time')\">✕</button>\r\n                    <div class=\"value\">\\${fmtTime(s.totalTime)}</div>\r\n                    <div class=\"label\">Time (\\${pd.label})</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <div class=\"value\">\\${s.projectCount}</div>\r\n                    <div class=\"label\">Projects</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('sessions', 'Sessions')\">✕</button>\r\n                    <div class=\"value\">\\${fmtNum(s.totalSessions)}</div>\r\n                    <div class=\"label\">Sessions</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('keystrokes', 'Keystrokes')\">✕</button>\r\n                    <div class=\"value\">\\${fmtNum(s.totalKeystrokes)}</div>\r\n                    <div class=\"label\">Keystrokes</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('linesAdded', 'Lines Added (Typed)')\">✕</button>\r\n                    <div class=\"value\">+\\${fmtNum(s.totalLinesAdded)}</div>\r\n                    <div class=\"label\">Lines Added (Typed)</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('linesDeleted', 'Lines Deleted (Typed)')\">✕</button>\r\n                    <div class=\"value\">-\\${fmtNum(s.totalLinesDeleted)}</div>\r\n                    <div class=\"label\">Lines Deleted (Typed)</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('linesAddedBulk', 'Lines Added (Bulk)')\">✕</button>\r\n                    <div class=\"value\">+\\${fmtNum(s.totalLinesAddedBulk)}</div>\r\n                    <div class=\"label\">Lines Added (Bulk/Paste)</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('charactersAdded', 'Characters Added')\">✕</button>\r\n                    <div class=\"value\">\\${fmtNum(s.totalCharsAdded)}</div>\r\n                    <div class=\"label\">Chars Added</div>\r\n                </div>\r\n                <div class=\"summary-card\">\r\n                    <button class=\"summary-reset-btn\" onclick=\"resetGlobalStat('charactersDeleted', 'Characters Deleted')\">✕</button>\r\n                    <div class=\"value\">\\${fmtNum(s.totalCharsDeleted)}</div>\r\n                    <div class=\"label\">Chars Deleted</div>\r\n                </div>\r\n            \\`;\r\n        }\r\n\r\n        function renderProjects() {\r\n            const pd = periodData[currentPeriod];\r\n            if (!pd) return;\r\n            const container = document.getElementById('projectsContainer');\r\n            const badge = document.getElementById('periodBadge');\r\n            badge.textContent = pd.label;\r\n\r\n            if (projectList.length === 0) {\r\n                container.innerHTML = '<div class=\"no-data\">No projects tracked yet. Start coding to see your statistics!</div>';\r\n                return;\r\n            }\r\n\r\n            container.innerHTML = projectList.map(proj => {\r\n                const s = pd.projects[proj.id] || {};\r\n                return \\`\r\n                <div class=\"project-card\">\r\n                    <div class=\"project-header\">\r\n                        <span class=\"project-name\">\\${esc(proj.id)}</span>\r\n                        <button class=\"reset-btn\" onclick=\"resetProject('\\${esc(proj.id)}')\">🗑️ Reset All</button>\r\n                    </div>\r\n                    <div class=\"project-stats\">\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtTime(s.time || 0)}</span>\r\n                            <span class=\"stat-label\">Time</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'totalTime', 'Total Time')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtNum(s.sessions)}</span>\r\n                            <span class=\"stat-label\">Sessions</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'sessions', 'Sessions')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtNum(s.keystrokes)}</span>\r\n                            <span class=\"stat-label\">Keystrokes</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'keystrokes', 'Keystrokes')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">+\\${fmtNum(s.linesAdded)}</span>\r\n                            <span class=\"stat-label\">Lines (Typed)</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'linesAdded', 'Lines Added')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">-\\${fmtNum(s.linesDeleted)}</span>\r\n                            <span class=\"stat-label\">Lines Del (Typed)</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'linesDeleted', 'Lines Deleted')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">+\\${fmtNum(s.linesAddedBulk)}</span>\r\n                            <span class=\"stat-label\">Lines (Bulk)</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'linesAddedBulk', 'Lines Added (Bulk)')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtNum(s.charactersAdded)}</span>\r\n                            <span class=\"stat-label\">Chars Added</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'charactersAdded', 'Chars Added')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${fmtNum(s.charactersDeleted)}</span>\r\n                            <span class=\"stat-label\">Chars Deleted</span>\r\n                            <button class=\"stat-reset-btn\" onclick=\"resetStat('\\${esc(proj.id)}', 'charactersDeleted', 'Chars Deleted')\">✕</button>\r\n                        </div>\r\n                        <div class=\"stat\">\r\n                            <span class=\"stat-value\">\\${s.lastActive ? new Date(s.lastActive).toLocaleDateString() : 'Never'}</span>\r\n                            <span class=\"stat-label\">Last Active</span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \\`;\r\n            }).join('');\r\n        }\r\n\r\n        // Initial render\r\n        renderSummary();\r\n        renderProjects();\r\n\r\n        function refresh() { vscode.postMessage({ command: 'refresh' }); }\r\n        function resetProject(projectId) { vscode.postMessage({ command: 'resetProject', projectId }); }\r\n        function resetStat(projectId, statName, statLabel) { vscode.postMessage({ command: 'resetStat', projectId, statName, statLabel }); }\r\n        function resetGlobalStat(statName, statLabel) { vscode.postMessage({ command: 'resetGlobalStat', statName, statLabel }); }\r\n\r\n        // Sync log\r\n        function toggleSyncLog() {\r\n            const content = document.getElementById('syncLogContent');\r\n            const toggle = document.getElementById('syncLogToggle');\r\n            content.classList.toggle('visible');\r\n            toggle.classList.toggle('open');\r\n        }\r\n        function filterLogs() {\r\n            const catFilter = document.getElementById('logFilter').value;\r\n            const lvlFilter = document.getElementById('logLevelFilter').value;\r\n            const lvlOrder = { 'error': 0, 'warn': 1, 'info': 2, 'debug': 3 };\r\n            document.querySelectorAll('.log-entry').forEach(entry => {\r\n                const cat = entry.getAttribute('data-category');\r\n                const lvl = entry.getAttribute('data-level');\r\n                const showCat = catFilter === 'all' || cat === catFilter;\r\n                let showLvl = true;\r\n                if (lvlFilter === 'error') showLvl = lvl === 'error';\r\n                else if (lvlFilter === 'warn') showLvl = lvlOrder[lvl] <= 1;\r\n                else if (lvlFilter === 'info') showLvl = lvlOrder[lvl] <= 2;\r\n                entry.style.display = (showCat && showLvl) ? '' : 'none';\r\n            });\r\n        }\r\n        function clearLogs() { vscode.postMessage({ command: 'clearLogs' }); }\r\n        function forceSyncCheck() { vscode.postMessage({ command: 'forceSyncCheck' }); }\r\n        function exportLogs() { vscode.postMessage({ command: 'exportLogs' }); }\r\n        function toggleLogData(btn) {\r\n            const entry = btn.closest('.log-entry');\r\n            const isExpanded = entry.classList.toggle('expanded');\r\n            btn.textContent = isExpanded ? '[-]' : '[+]';\r\n        }\r\n\r\n        // Chart.js\r\n        Chart.defaults.color = getComputedStyle(document.body).getPropertyValue('--vscode-editor-foreground') || '#ffffff';\r\n        Chart.defaults.borderColor = getComputedStyle(document.body).getPropertyValue('--vscode-panel-border') || '#333333';\r\n\r\n        const chartColors = ['#4FC3F7','#81C784','#FFB74D','#F06292','#BA68C8','#4DD0E1','#AED581','#FF8A65','#9575CD','#7986CB'];\r\n\r\n        const dailyData = ${JSON.stringify(dailyData)};\r\n        new Chart(document.getElementById('dailyChart'), {\r\n            type: 'bar',\r\n            data: { labels: dailyData.map(d => d.date), datasets: [{ label: 'Hours', data: dailyData.map(d => (d.time/3600000).toFixed(2)), backgroundColor: '#4FC3F7', borderRadius: 4 }] },\r\n            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } }\r\n        });\r\n\r\n        const weeklyData = ${JSON.stringify(weeklyData)};\r\n        new Chart(document.getElementById('weeklyChart'), {\r\n            type: 'bar',\r\n            data: { labels: weeklyData.map(d => d.week), datasets: [{ label: 'Hours', data: weeklyData.map(d => (d.time/3600000).toFixed(2)), backgroundColor: '#81C784', borderRadius: 4 }] },\r\n            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } }\r\n        });\r\n\r\n        const monthlyData = ${JSON.stringify(monthlyData)};\r\n        new Chart(document.getElementById('monthlyChart'), {\r\n            type: 'line',\r\n            data: { labels: monthlyData.map(d => d.month), datasets: [{ label: 'Hours', data: monthlyData.map(d => (d.time/3600000).toFixed(2)), borderColor: '#FFB74D', backgroundColor: 'rgba(255,183,77,0.2)', fill: true, tension: 0.3 }] },\r\n            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } }\r\n        });\r\n\r\n        const projectsData = ${JSON.stringify(Object.entries(projects).map(([name, stats]) => ({ name, time: stats.totalTime })))};\r\n        if (projectsData.length > 0) {\r\n            new Chart(document.getElementById('projectsChart'), {\r\n                type: 'doughnut',\r\n                data: { labels: projectsData.map(d => d.name), datasets: [{ data: projectsData.map(d => (d.time/3600000).toFixed(2)), backgroundColor: chartColors.slice(0, projectsData.length) }] },\r\n                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right', labels: { boxWidth: 12, padding: 10 } } } }\r\n            });\r\n        }\r\n    </script>\r\n</body>\r\n</html>`;\r\n    }\r\n\r\n    /**\r\n     * Format a number with thousands separator\r\n     * @param {number} num \r\n     * @returns {string}\r\n     */\r\n    formatNumber(num) {\r\n        return num.toLocaleString();\r\n    }\r\n\r\n    /**\r\n     * Escape HTML special characters\r\n     * @param {string} text \r\n     * @returns {string}\r\n     */\r\n    escapeHtml(text) {\r\n        const div = { \r\n            '&': '&amp;', \r\n            '<': '&lt;', \r\n            '>': '&gt;', \r\n            '\"': '&quot;', \r\n            \"'\": '&#039;' \r\n        };\r\n        return text.replace(/[&<>\"']/g, (m) => div[m]);\r\n    }\r\n\r\n    /**\r\n     * Dispose the webview\r\n     */\r\n    dispose() {\r\n        if (this.panel) {\r\n            this.panel.dispose();\r\n            this.panel = null;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = { StatsWebView };\r\n","const vscode = require('vscode');\r\nconst { getProjectId } = require('./utils');\r\nconst { createEmptyProjectStats } = require('./types');\r\nconst { logger } = require('./syncLogger');\r\n\r\n/**\r\n * Time tracker for monitoring user activity\r\n */\r\nclass Tracker {\r\n    /**\r\n     * @param {import('./storage').Storage} storage \r\n     */\r\n    constructor(storage) {\r\n        this.storage = storage;\r\n        this.projectId = getProjectId();\r\n        this.isTracking = false;\r\n        this.lastActivity = Date.now();\r\n        this.sessionStartTime = 0;\r\n        this.currentSessionTime = 0;\r\n        this.isAfk = false;\r\n        this.afkThreshold = 300000; // 5 minutes default\r\n        this.checkInterval = null;\r\n        this.disposables = [];\r\n        this.onTimeUpdateCallback = null;\r\n        this.onAfkChangeCallback = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize the tracker\r\n     */\r\n    initialize() {\r\n        // Load configuration\r\n        this.loadConfig();\r\n\r\n        // Listen for config changes\r\n        this.disposables.push(\r\n            vscode.workspace.onDidChangeConfiguration((e) => {\r\n                if (e.affectsConfiguration('punchcardWorkTimer')) {\r\n                    this.loadConfig();\r\n                }\r\n            })\r\n        );\r\n\r\n        // Check if we should track on startup\r\n        const config = vscode.workspace.getConfiguration('punchcardWorkTimer');\r\n        if (config.get('trackOnStartup', true)) {\r\n            this.start();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load configuration\r\n     */\r\n    loadConfig() {\r\n        const config = vscode.workspace.getConfiguration('punchcardWorkTimer');\r\n        this.afkThreshold = config.get('afkThreshold', 300000);\r\n    }\r\n\r\n    /**\r\n     * Start tracking\r\n     */\r\n    start() {\r\n        if (this.isTracking) {\r\n            return;\r\n        }\r\n\r\n        this.isTracking = true;\r\n        this.lastActivity = Date.now();\r\n        this.sessionStartTime = Date.now();\r\n        this.currentSessionTime = 0;\r\n        this.isAfk = false;\r\n\r\n        // Register activity listeners\r\n        this.registerActivityListeners();\r\n\r\n        // Start the check interval (every second)\r\n        this.checkInterval = setInterval(() => this.tick(), 1000);\r\n\r\n        // Create a new session\r\n        this.storage.addSession(this.projectId, {\r\n            startTime: this.sessionStartTime,\r\n            endTime: this.sessionStartTime,\r\n            duration: 0\r\n        });\r\n\r\n        logger.info('tracker', `Tracking started for project: ${this.projectId}`, {\r\n            sessionStartTime: this.sessionStartTime\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Stop tracking\r\n     */\r\n    stop() {\r\n        if (!this.isTracking) {\r\n            return;\r\n        }\r\n\r\n        this.isTracking = false;\r\n\r\n        // Clear interval\r\n        if (this.checkInterval) {\r\n            clearInterval(this.checkInterval);\r\n            this.checkInterval = null;\r\n        }\r\n\r\n        // Dispose activity listeners\r\n        this.disposeActivityListeners();\r\n\r\n        // Finalize session\r\n        if (this.sessionStartTime > 0) {\r\n            const endTime = Date.now();\r\n            this.storage.updateLastSession(\r\n                this.projectId,\r\n                this.sessionStartTime,\r\n                endTime,\r\n                this.currentSessionTime\r\n            );\r\n            // Force immediate save on stop\r\n            this.storage._saveImmediate();\r\n            logger.info('tracker', `Tracking stopped for ${this.projectId}. Session duration: ${this.currentSessionTime}ms`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register activity event listeners\r\n     */\r\n    registerActivityListeners() {\r\n        // Text document changes (typing)\r\n        this.disposables.push(\r\n            vscode.workspace.onDidChangeTextDocument((e) => {\r\n                this.onActivity();\r\n                this.trackDocumentChanges(e);\r\n            })\r\n        );\r\n\r\n        // Cursor movement\r\n        this.disposables.push(\r\n            vscode.window.onDidChangeTextEditorSelection(() => {\r\n                this.onActivity();\r\n            })\r\n        );\r\n\r\n        // Scrolling\r\n        this.disposables.push(\r\n            vscode.window.onDidChangeTextEditorVisibleRanges(() => {\r\n                this.onActivity();\r\n            })\r\n        );\r\n\r\n        // File switching\r\n        this.disposables.push(\r\n            vscode.window.onDidChangeActiveTextEditor(() => {\r\n                this.onActivity();\r\n                // Update project ID in case workspace changed\r\n                this.projectId = getProjectId();\r\n            })\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Dispose activity listeners\r\n     */\r\n    disposeActivityListeners() {\r\n        for (const disposable of this.disposables) {\r\n            disposable.dispose();\r\n        }\r\n        this.disposables = [];\r\n    }\r\n\r\n    /**\r\n     * Called when any activity is detected\r\n     */\r\n    onActivity() {\r\n        const wasAfk = this.isAfk;\r\n        this.lastActivity = Date.now();\r\n        this.isAfk = false;\r\n\r\n        if (wasAfk && this.onAfkChangeCallback) {\r\n            this.onAfkChangeCallback(false);\r\n            \r\n            // Start a new session when coming back from AFK\r\n            this.sessionStartTime = Date.now();\r\n            this.currentSessionTime = 0;\r\n            this.storage.addSession(this.projectId, {\r\n                startTime: this.sessionStartTime,\r\n                endTime: this.sessionStartTime,\r\n                duration: 0\r\n            });\r\n            logger.info('tracker', `Returned from AFK, new session started for ${this.projectId}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Track document changes (keystrokes, lines, characters)\r\n     * Distinguishes between typed input and bulk operations (paste, format, git ops)\r\n     * @param {vscode.TextDocumentChangeEvent} event \r\n     */\r\n    trackDocumentChanges(event) {\r\n        if (!event.contentChanges.length) {\r\n            return;\r\n        }\r\n\r\n        let linesAdded = 0;\r\n        let linesDeleted = 0;\r\n        let charsAdded = 0;\r\n        let charsDeleted = 0;\r\n        let keystrokes = 0;\r\n        let linesAddedBulk = 0;\r\n        let linesDeletedBulk = 0;\r\n\r\n        // Threshold to distinguish typing from bulk operations\r\n        // Typing typically involves small changes (1-5 chars at a time)\r\n        // Paste/format/git operations involve larger changes\r\n        const BULK_CHAR_THRESHOLD = 10;\r\n        const BULK_LINE_THRESHOLD = 3;\r\n\r\n        for (const change of event.contentChanges) {\r\n            const textLength = change.text.length;\r\n            const deletedLength = change.rangeLength;\r\n            \r\n            // Count characters (always track these)\r\n            charsAdded += textLength;\r\n            charsDeleted += deletedLength;\r\n\r\n            // Count lines\r\n            const newLines = (change.text.match(/\\n/g) || []).length;\r\n            const deletedLines = change.range.end.line - change.range.start.line;\r\n\r\n            // Detect if this is a bulk operation (paste, format, git merge, etc.)\r\n            const isBulkOperation = \r\n                textLength > BULK_CHAR_THRESHOLD || \r\n                deletedLength > BULK_CHAR_THRESHOLD ||\r\n                newLines > BULK_LINE_THRESHOLD ||\r\n                deletedLines > BULK_LINE_THRESHOLD;\r\n\r\n            if (isBulkOperation) {\r\n                // Track bulk operations separately - these are NOT keystrokes\r\n                // Could be paste, auto-format, git operations, find-replace, etc.\r\n                linesAddedBulk += newLines;\r\n                linesDeletedBulk += deletedLines;\r\n                // No keystrokes for bulk operations\r\n            } else {\r\n                // This looks like actual typing\r\n                linesAdded += newLines;\r\n                linesDeleted += deletedLines;\r\n                \r\n                // Count keystrokes more accurately:\r\n                // - Empty text with deletion = backspace/delete key (1 keystroke)\r\n                // - Single char = 1 keystroke\r\n                // - Small multi-char (autocomplete acceptance) = 1 keystroke\r\n                if (textLength === 0 && deletedLength > 0) {\r\n                    // Backspace or delete key\r\n                    keystrokes += 1;\r\n                } else if (textLength > 0) {\r\n                    // Typing or small autocomplete\r\n                    keystrokes += 1;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Only save metrics if there's something to track\r\n        if (keystrokes > 0 || charsAdded > 0 || charsDeleted > 0 || \r\n            linesAdded > 0 || linesDeleted > 0 || linesAddedBulk > 0 || linesDeletedBulk > 0) {\r\n            this.storage.addMetrics(this.projectId, {\r\n                linesAdded,\r\n                linesDeleted,\r\n                linesAddedBulk,\r\n                linesDeletedBulk,\r\n                charactersAdded: charsAdded,\r\n                charactersDeleted: charsDeleted,\r\n                keystrokes\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Tick function called every second\r\n     */\r\n    tick() {\r\n        if (!this.isTracking) {\r\n            return;\r\n        }\r\n\r\n        const now = Date.now();\r\n        const timeSinceActivity = now - this.lastActivity;\r\n\r\n        // Check for AFK\r\n        if (timeSinceActivity >= this.afkThreshold) {\r\n            if (!this.isAfk) {\r\n                this.isAfk = true;\r\n                \r\n                // Finalize current session\r\n                this.storage.updateLastSession(\r\n                    this.projectId,\r\n                    this.sessionStartTime,\r\n                    this.lastActivity,\r\n                    this.currentSessionTime\r\n                );\r\n                // Force save on AFK\r\n                this.storage._saveImmediate();\r\n\r\n                logger.info('tracker', `AFK detected for ${this.projectId} after ${timeSinceActivity}ms inactivity. Session time: ${this.currentSessionTime}ms`);\r\n\r\n                if (this.onAfkChangeCallback) {\r\n                    this.onAfkChangeCallback(true);\r\n                }\r\n            }\r\n            return;\r\n        }\r\n\r\n        // Add time if not AFK\r\n        if (!this.isAfk) {\r\n            this.currentSessionTime += 1000;\r\n            this.storage.addTime(this.projectId, 1000);\r\n            \r\n            // Update session\r\n            this.storage.updateLastSession(\r\n                this.projectId,\r\n                this.sessionStartTime,\r\n                now,\r\n                this.currentSessionTime\r\n            );\r\n\r\n            if (this.onTimeUpdateCallback) {\r\n                this.onTimeUpdateCallback(this.currentSessionTime);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Set callback for time updates\r\n     * @param {(time: number) => void} callback \r\n     */\r\n    onTimeUpdate(callback) {\r\n        this.onTimeUpdateCallback = callback;\r\n    }\r\n\r\n    /**\r\n     * Set callback for AFK status changes\r\n     * @param {(isAfk: boolean) => void} callback \r\n     */\r\n    onAfkChange(callback) {\r\n        this.onAfkChangeCallback = callback;\r\n    }\r\n\r\n    /**\r\n     * Get current session time\r\n     * @returns {number}\r\n     */\r\n    getCurrentSessionTime() {\r\n        return this.currentSessionTime;\r\n    }\r\n\r\n    /**\r\n     * Get today's total time for current project\r\n     * @returns {number}\r\n     */\r\n    getTodayTime() {\r\n        const stats = this.storage.getProjectStats(this.projectId);\r\n        const startOfDay = new Date();\r\n        startOfDay.setHours(0, 0, 0, 0);\r\n        const startTimestamp = startOfDay.getTime();\r\n        const now = Date.now();\r\n\r\n        let todayTime = 0;\r\n        for (const session of stats.sessions) {\r\n            if (session.startTime >= startTimestamp) {\r\n                // Session started today\r\n                todayTime += session.duration;\r\n            } else if (session.endTime > startTimestamp) {\r\n                // Session spans midnight\r\n                todayTime += session.endTime - startTimestamp;\r\n            }\r\n        }\r\n\r\n        return todayTime;\r\n    }\r\n\r\n    /**\r\n     * Check if currently tracking\r\n     * @returns {boolean}\r\n     */\r\n    isCurrentlyTracking() {\r\n        return this.isTracking && !this.isAfk;\r\n    }\r\n\r\n    /**\r\n     * Get current project ID\r\n     * @returns {string}\r\n     */\r\n    getProjectId() {\r\n        return this.projectId;\r\n    }\r\n\r\n    /**\r\n     * Dispose the tracker\r\n     */\r\n    dispose() {\r\n        this.stop();\r\n        this.disposeActivityListeners();\r\n    }\r\n}\r\n\r\nmodule.exports = { Tracker };\r\n","/**\r\n * @typedef {Object} ProjectStats\r\n * @property {number} totalTime - Total active time in milliseconds\r\n * @property {number} linesAdded - Total lines added (typed)\r\n * @property {number} linesDeleted - Total lines deleted (typed)\r\n * @property {number} linesAddedBulk - Total lines added via bulk operations (paste, format, git)\r\n * @property {number} linesDeletedBulk - Total lines deleted via bulk operations\r\n * @property {number} charactersAdded - Total characters added\r\n * @property {number} charactersDeleted - Total characters deleted\r\n * @property {number} keystrokes - Total keystrokes (actual key presses, not pasted chars)\r\n * @property {Session[]} sessions - Array of work sessions\r\n * @property {number} lastActive - Last active timestamp\r\n * @property {Object.<string, DailyMetrics>} dailyMetrics - Metrics aggregated by day (key: \"YYYY-MM-DD\")\r\n */\r\n\r\n/**\r\n * @typedef {Object} DailyMetrics\r\n * @property {number} time - Active time in milliseconds for that day\r\n * @property {number} keystrokes - Keystrokes for that day\r\n * @property {number} linesAdded - Lines added (typed) for that day\r\n * @property {number} linesDeleted - Lines deleted (typed) for that day\r\n * @property {number} linesAddedBulk - Lines added (bulk) for that day\r\n * @property {number} linesDeletedBulk - Lines deleted (bulk) for that day\r\n * @property {number} charactersAdded - Characters added for that day\r\n * @property {number} charactersDeleted - Characters deleted for that day\r\n */\r\n\r\n/**\r\n * @typedef {Object} Session\r\n * @property {number} startTime - Session start timestamp\r\n * @property {number} endTime - Session end timestamp\r\n * @property {number} duration - Session duration in milliseconds\r\n */\r\n\r\n/**\r\n * @typedef {Object} StorageData\r\n * @property {Object.<string, ProjectStats>} projects - Map of project paths to stats\r\n * @property {number} totalTimeAllProjects - Total time across all projects\r\n * @property {number} totalKeystrokes - Total keystrokes across all projects\r\n */\r\n\r\n/**\r\n * Creates empty daily metrics entry\r\n * @returns {DailyMetrics}\r\n */\r\nfunction createEmptyDailyMetrics() {\r\n    return {\r\n        time: 0,\r\n        keystrokes: 0,\r\n        linesAdded: 0,\r\n        linesDeleted: 0,\r\n        linesAddedBulk: 0,\r\n        linesDeletedBulk: 0,\r\n        charactersAdded: 0,\r\n        charactersDeleted: 0\r\n    };\r\n}\r\n\r\n/**\r\n * Creates a new empty ProjectStats object\r\n * @returns {ProjectStats}\r\n */\r\nfunction createEmptyProjectStats() {\r\n    return {\r\n        totalTime: 0,\r\n        linesAdded: 0,\r\n        linesDeleted: 0,\r\n        linesAddedBulk: 0,\r\n        linesDeletedBulk: 0,\r\n        charactersAdded: 0,\r\n        charactersDeleted: 0,\r\n        keystrokes: 0,\r\n        sessions: [],\r\n        lastActive: 0,\r\n        dailyMetrics: {}\r\n    };\r\n}\r\n\r\n/**\r\n * Creates a new empty StorageData object\r\n * @returns {StorageData}\r\n */\r\nfunction createEmptyStorageData() {\r\n    return {\r\n        projects: {},\r\n        totalTimeAllProjects: 0,\r\n        totalKeystrokes: 0\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    createEmptyProjectStats,\r\n    createEmptyStorageData,\r\n    createEmptyDailyMetrics\r\n};\r\n","module.exports = require(\"vscode\");","const vscode = require('vscode');\n\n/**\n * Format milliseconds to HH:MM:SS string\n * @param {number} ms - Milliseconds to format\n * @returns {string} Formatted time string\n */\nfunction formatTime(ms) {\n    if (ms < 0) ms = 0;\n    \n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    \n    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n}\n\n/**\n * Format milliseconds to human readable string\n * @param {number} ms - Milliseconds to format\n * @returns {string} Human readable time string\n */\nfunction formatTimeHuman(ms) {\n    if (ms < 0) ms = 0;\n    \n    const totalSeconds = Math.floor(ms / 1000);\n    const hours = Math.floor(totalSeconds / 3600);\n    const minutes = Math.floor((totalSeconds % 3600) / 60);\n    const seconds = totalSeconds % 60;\n    \n    const parts = [];\n    if (hours > 0) parts.push(`${hours}h`);\n    if (minutes > 0) parts.push(`${minutes}m`);\n    if (seconds > 0 || parts.length === 0) parts.push(`${seconds}s`);\n    \n    return parts.join(' ');\n}\n\n/**\n * Get project identifier from workspace\n * @returns {string} Project identifier\n */\nfunction getProjectId() {\n    const workspaceFolders = vscode.workspace.workspaceFolders;\n    \n    if (!workspaceFolders || workspaceFolders.length === 0) {\n        return 'unknown-project';\n    }\n    \n    // Use workspace name if available, otherwise use first folder path\n    const workspaceName = vscode.workspace.name;\n    if (workspaceName) {\n        return workspaceName;\n    }\n    \n    return workspaceFolders[0].uri.fsPath;\n}\n\n/**\n * Get start of today in milliseconds\n * @returns {number} Timestamp of start of today\n */\nfunction getStartOfDay() {\n    const now = new Date();\n    return new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();\n}\n\n/**\n * Get start of week in milliseconds (Monday)\n * @returns {number} Timestamp of start of week\n */\nfunction getStartOfWeek() {\n    const now = new Date();\n    const day = now.getDay();\n    const diff = now.getDate() - day + (day === 0 ? -6 : 1);\n    return new Date(now.getFullYear(), now.getMonth(), diff).getTime();\n}\n\n/**\n * Get start of month in milliseconds\n * @returns {number} Timestamp of start of month\n */\nfunction getStartOfMonth() {\n    const now = new Date();\n    return new Date(now.getFullYear(), now.getMonth(), 1).getTime();\n}\n\n/**\n * Check if a session is within a time range\n * @param {{ startTime: number, endTime: number }} session - Session object\n * @param {number} startRange - Start of range timestamp\n * @param {number} endRange - End of range timestamp\n * @returns {boolean} True if session overlaps with range\n */\nfunction isSessionInRange(session, startRange, endRange) {\n    return session.startTime < endRange && session.endTime > startRange;\n}\n\n/**\n * Calculate time spent in a range from sessions\n * @param {Array<{ startTime: number, endTime: number, duration: number }>} sessions - Array of sessions\n * @param {number} startRange - Start of range timestamp\n * @param {number} endRange - End of range timestamp\n * @returns {number} Time spent in range in milliseconds\n */\nfunction getTimeInRange(sessions, startRange, endRange) {\n    let total = 0;\n    \n    for (const session of sessions) {\n        if (isSessionInRange(session, startRange, endRange)) {\n            const overlapStart = Math.max(session.startTime, startRange);\n            const overlapEnd = Math.min(session.endTime, endRange);\n            total += overlapEnd - overlapStart;\n        }\n    }\n    \n    return total;\n}\n\n/**\n * Get daily breakdown for the last N days\n * @param {Array<{ startTime: number, endTime: number, duration: number }>} sessions - Array of sessions\n * @param {number} days - Number of days to include\n * @returns {Array<{ date: string, time: number }>} Daily breakdown\n */\nfunction getDailyBreakdown(sessions, days = 7) {\n    const result = [];\n    const now = new Date();\n    \n    for (let i = days - 1; i >= 0; i--) {\n        const date = new Date(now.getFullYear(), now.getMonth(), now.getDate() - i);\n        const startOfDay = date.getTime();\n        const endOfDay = startOfDay + 24 * 60 * 60 * 1000;\n        \n        result.push({\n            date: date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }),\n            time: getTimeInRange(sessions, startOfDay, endOfDay)\n        });\n    }\n    \n    return result;\n}\n\n/**\n * Get weekly breakdown for the last N weeks\n * @param {Array<{ startTime: number, endTime: number, duration: number }>} sessions - Array of sessions\n * @param {number} weeks - Number of weeks to include\n * @returns {Array<{ week: string, time: number }>} Weekly breakdown\n */\nfunction getWeeklyBreakdown(sessions, weeks = 4) {\n    const result = [];\n    const now = new Date();\n    const currentDay = now.getDay();\n    const diff = now.getDate() - currentDay + (currentDay === 0 ? -6 : 1);\n    \n    for (let i = weeks - 1; i >= 0; i--) {\n        const weekStart = new Date(now.getFullYear(), now.getMonth(), diff - (i * 7));\n        const weekEnd = new Date(weekStart.getTime() + 7 * 24 * 60 * 60 * 1000);\n        \n        result.push({\n            week: `Week of ${weekStart.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`,\n            time: getTimeInRange(sessions, weekStart.getTime(), weekEnd.getTime())\n        });\n    }\n    \n    return result;\n}\n\n/**\n * Get monthly breakdown for the last N months\n * @param {Array<{ startTime: number, endTime: number, duration: number }>} sessions - Array of sessions\n * @param {number} months - Number of months to include\n * @returns {Array<{ month: string, time: number }>} Monthly breakdown\n */\nfunction getMonthlyBreakdown(sessions, months = 6) {\n    const result = [];\n    const now = new Date();\n    \n    for (let i = months - 1; i >= 0; i--) {\n        const monthStart = new Date(now.getFullYear(), now.getMonth() - i, 1);\n        const monthEnd = new Date(now.getFullYear(), now.getMonth() - i + 1, 1);\n        \n        result.push({\n            month: monthStart.toLocaleDateString('en-US', { month: 'long', year: 'numeric' }),\n            time: getTimeInRange(sessions, monthStart.getTime(), monthEnd.getTime())\n        });\n    }\n    \n    return result;\n}\n\n/**\n * Get a YYYY-MM-DD date key from a timestamp\n * @param {number} [timestamp] - Timestamp (default: now)\n * @returns {string} Date key in YYYY-MM-DD format\n */\nfunction getDateKey(timestamp) {\n    const d = new Date(timestamp || Date.now());\n    return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\n}\n\n/**\n * Parse a YYYY-MM-DD date key to start-of-day timestamp\n * @param {string} dateKey - Date key in YYYY-MM-DD format\n * @returns {number} Timestamp of start of that day\n */\nfunction dateKeyToTimestamp(dateKey) {\n    const [year, month, day] = dateKey.split('-').map(Number);\n    return new Date(year, month - 1, day).getTime();\n}\n\n/**\n * Aggregate dailyMetrics entries within a time range.\n * @param {Object.<string, import('./types').DailyMetrics>} dailyMetrics - Map of date keys to metrics\n * @param {number} startTimestamp - Start of range (inclusive)\n * @param {number} endTimestamp - End of range (exclusive)\n * @returns {{ time: number, keystrokes: number, linesAdded: number, linesDeleted: number, linesAddedBulk: number, linesDeletedBulk: number, charactersAdded: number, charactersDeleted: number }}\n */\nfunction aggregateDailyMetrics(dailyMetrics, startTimestamp, endTimestamp) {\n    const result = {\n        time: 0, keystrokes: 0, linesAdded: 0, linesDeleted: 0,\n        linesAddedBulk: 0, linesDeletedBulk: 0, charactersAdded: 0, charactersDeleted: 0\n    };\n    \n    if (!dailyMetrics) return result;\n    \n    for (const [dayKey, metrics] of Object.entries(dailyMetrics)) {\n        const dayTs = dateKeyToTimestamp(dayKey);\n        if (dayTs >= startTimestamp && dayTs < endTimestamp) {\n            result.time += metrics.time || 0;\n            result.keystrokes += metrics.keystrokes || 0;\n            result.linesAdded += metrics.linesAdded || 0;\n            result.linesDeleted += metrics.linesDeleted || 0;\n            result.linesAddedBulk += metrics.linesAddedBulk || 0;\n            result.linesDeletedBulk += metrics.linesDeletedBulk || 0;\n            result.charactersAdded += metrics.charactersAdded || 0;\n            result.charactersDeleted += metrics.charactersDeleted || 0;\n        }\n    }\n    \n    return result;\n}\n\n/**\n * Get end-of-day timestamp (start of next day)\n * @returns {number}\n */\nfunction getEndOfDay() {\n    return getStartOfDay() + 24 * 60 * 60 * 1000;\n}\n\n/**\n * Get end-of-week timestamp (start of next week)\n * @returns {number}\n */\nfunction getEndOfWeek() {\n    return getStartOfWeek() + 7 * 24 * 60 * 60 * 1000;\n}\n\n/**\n * Get end-of-month timestamp (start of next month)\n * @returns {number}\n */\nfunction getEndOfMonth() {\n    const now = new Date();\n    return new Date(now.getFullYear(), now.getMonth() + 1, 1).getTime();\n}\n\nmodule.exports = {\n    formatTime,\n    formatTimeHuman,\n    getProjectId,\n    getStartOfDay,\n    getStartOfWeek,\n    getStartOfMonth,\n    getEndOfDay,\n    getEndOfWeek,\n    getEndOfMonth,\n    getDateKey,\n    dateKeyToTimestamp,\n    isSessionInRange,\n    getTimeInRange,\n    getDailyBreakdown,\n    getWeeklyBreakdown,\n    getMonthlyBreakdown,\n    aggregateDailyMetrics\n};\n","/**\n * Sync Logger for PUNCHCARD extension\n * Logs sync-related events for debugging cross-machine synchronization.\n * \n * Usage: Import the singleton `logger` instance from this module.\n * Logs are stored in memory and can be retrieved for display in the webview.\n */\nclass SyncLogger {\n    constructor() {\n        /** @type {Array<LogEntry>} */\n        this.logs = [];\n        this.maxLogs = 1000;\n        this._syncDetectionCount = 0;\n        this._saveCount = 0;\n        this._mergeCount = 0;\n        this._activationTime = Date.now();\n        this._lastSaveIds = [];   // track last 20 save IDs for debugging\n        this._lastSyncCheckResults = []; // track last 10 sync check results\n    }\n\n    /**\n     * @typedef {Object} LogEntry\n     * @property {number} timestamp\n     * @property {'info'|'warn'|'error'|'debug'} level\n     * @property {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category\n     * @property {string} message\n     * @property {string|null} data\n     */\n\n    /**\n     * Add a log entry\n     * @param {'info'|'warn'|'error'|'debug'} level \n     * @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category \n     * @param {string} message \n     * @param {any} [data] \n     */\n    log(level, category, message, data = null) {\n        const entry = {\n            timestamp: Date.now(),\n            level,\n            category,\n            message,\n            data: data ? this._safeStringify(data) : null\n        };\n\n        this.logs.push(entry);\n\n        // Trim old logs\n        if (this.logs.length > this.maxLogs) {\n            this.logs = this.logs.slice(-this.maxLogs);\n        }\n\n        // Also output to VS Code developer console for debugging\n        const prefix = `PUNCHCARD [${level.toUpperCase()}] [${category}]`;\n        if (level === 'error') {\n            console.error(prefix, message, data || '');\n        } else if (level === 'warn') {\n            console.warn(prefix, message, data || '');\n        } else {\n            console.log(prefix, message, data || '');\n        }\n    }\n\n    /** @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category */\n    info(category, message, data) { this.log('info', category, message, data); }\n    /** @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category */\n    warn(category, message, data) { this.log('warn', category, message, data); }\n    /** @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category */\n    error(category, message, data) { this.log('error', category, message, data); }\n    /** @param {'sync'|'storage'|'tracker'|'session'|'merge'|'init'} category */\n    debug(category, message, data) { this.log('debug', category, message, data); }\n\n    /**\n     * Increment sync detection counter\n     */\n    recordSyncDetection() {\n        this._syncDetectionCount++;\n    }\n\n    /**\n     * Increment save counter\n     */\n    recordSave() {\n        this._saveCount++;\n    }\n\n    /**\n     * Increment merge counter\n     */\n    recordMerge() {\n        this._mergeCount++;\n    }\n\n    /**\n     * Get counters for display\n     */\n    getCounters() {\n        return {\n            syncDetections: this._syncDetectionCount,\n            saves: this._saveCount,\n            merges: this._mergeCount\n        };\n    }\n\n    /**\n     * Get all logs\n     * @returns {Array<LogEntry>}\n     */\n    getLogs() {\n        return [...this.logs];\n    }\n\n    /**\n     * Get logs filtered by category\n     * @param {string} category \n     * @returns {Array<LogEntry>}\n     */\n    getLogsByCategory(category) {\n        return this.logs.filter(l => l.category === category);\n    }\n\n    /**\n     * Get logs filtered by level\n     * @param {string} level \n     * @returns {Array<LogEntry>}\n     */\n    getLogsByLevel(level) {\n        return this.logs.filter(l => l.level === level);\n    }\n\n    /**\n     * Track a save ID for diagnostic history\n     * @param {string} saveId\n     */\n    recordSaveId(saveId) {\n        this._lastSaveIds.push({ saveId, time: Date.now() });\n        if (this._lastSaveIds.length > 20) {\n            this._lastSaveIds = this._lastSaveIds.slice(-20);\n        }\n    }\n\n    /**\n     * Track a sync check result\n     * @param {Object} result\n     */\n    recordSyncCheckResult(result) {\n        this._lastSyncCheckResults.push({ ...result, time: Date.now() });\n        if (this._lastSyncCheckResults.length > 10) {\n            this._lastSyncCheckResults = this._lastSyncCheckResults.slice(-10);\n        }\n    }\n\n    /**\n     * Clear all logs\n     */\n    clear() {\n        this.logs = [];\n        this.info('init', 'Logs cleared');\n    }\n\n    /**\n     * Export all logs as a formatted text string for sharing/debugging.\n     * Includes diagnostic metadata at the top.\n     * @returns {string}\n     */\n    exportLogs() {\n        const lines = [];\n        lines.push('=== PUNCHCARD Sync Debug Log Export ===');\n        lines.push(`Export time: ${new Date().toISOString()}`);\n        lines.push(`Extension uptime: ${Math.round((Date.now() - this._activationTime) / 1000)}s`);\n        lines.push(`Total log entries: ${this.logs.length}`);\n        lines.push('');\n        lines.push('--- Counters ---');\n        const counters = this.getCounters();\n        lines.push(`Sync detections: ${counters.syncDetections}`);\n        lines.push(`Saves: ${counters.saves}`);\n        lines.push(`Merges: ${counters.merges}`);\n        lines.push('');\n        lines.push('--- Last 20 Save IDs ---');\n        for (const s of this._lastSaveIds) {\n            lines.push(`  ${new Date(s.time).toISOString()} → ${s.saveId}`);\n        }\n        lines.push('');\n        lines.push('--- Last 10 Sync Check Results ---');\n        for (const r of this._lastSyncCheckResults) {\n            lines.push(`  ${new Date(r.time).toISOString()} → ${JSON.stringify(r)}`);\n        }\n        lines.push('');\n        lines.push('--- Full Log ---');\n        for (const entry of this.logs) {\n            const time = new Date(entry.timestamp).toISOString();\n            let line = `${time} [${entry.level.toUpperCase()}] [${entry.category}] ${entry.message}`;\n            if (entry.data) {\n                line += `\\n    DATA: ${entry.data}`;\n            }\n            lines.push(line);\n        }\n        lines.push('');\n        lines.push('=== END OF LOG ===');\n        return lines.join('\\n');\n    }\n\n    /**\n     * Safely stringify data for logging, handling circular refs and large objects\n     * @param {any} data \n     * @returns {string}\n     */\n    _safeStringify(data) {\n        try {\n            if (typeof data === 'string') return data;\n            return JSON.stringify(data, (key, value) => {\n                // Truncate very long arrays\n                if (Array.isArray(value) && value.length > 10) {\n                    return [...value.slice(0, 10), `... (${value.length} total)`];\n                }\n                // Truncate very long strings\n                if (typeof value === 'string' && value.length > 500) {\n                    return value.substring(0, 500) + '...';\n                }\n                return value;\n            }, 2);\n        } catch (e) {\n            return String(data);\n        }\n    }\n}\n\n// Singleton instance - shared across all modules\nconst logger = new SyncLogger();\n\nmodule.exports = { SyncLogger, logger };\n","const vscode = require('vscode');\r\nconst { Storage } = require('./storage');\r\nconst { Tracker } = require('./tracker');\r\nconst { StatusBar } = require('./statusBar');\r\nconst { StatsWebView } = require('./webview');\r\nconst { logger } = require('./syncLogger');\r\n\r\n/** @type {Storage} */\r\nlet storage;\r\n/** @type {Tracker} */\r\nlet tracker;\r\n/** @type {StatusBar} */\r\nlet statusBar;\r\n/** @type {StatsWebView} */\r\nlet webview;\r\n\r\n/**\r\n * Activate the extension\r\n * @param {vscode.ExtensionContext} context \r\n */\r\nasync function activate(context) {\r\n    console.log('PUNCHCARD - Work Time Statistics is now active!');\r\n    logger.info('init', 'Extension activating...');\r\n\r\n    // Initialize storage\r\n    storage = new Storage(context);\r\n    await storage.initialize();\r\n\r\n    // Initialize tracker\r\n    tracker = new Tracker(storage);\r\n    tracker.initialize();\r\n\r\n    // Initialize status bar\r\n    statusBar = new StatusBar(tracker);\r\n    statusBar.initialize();\r\n\r\n    // Initialize webview\r\n    webview = new StatsWebView(context, storage);\r\n\r\n    // Register commands\r\n    const showStatsCommand = vscode.commands.registerCommand('workTimer.showStats', () => {\r\n        webview.show();\r\n    });\r\n\r\n    const resetProjectCommand = vscode.commands.registerCommand('workTimer.resetProject', async () => {\r\n        const projectId = tracker.getProjectId();\r\n        const confirm = await vscode.window.showWarningMessage(\r\n            `Are you sure you want to reset statistics for \"${projectId}\"?`,\r\n            { modal: true },\r\n            'Yes, Reset'\r\n        );\r\n        if (confirm === 'Yes, Reset') {\r\n            await storage.resetProject(projectId);\r\n            vscode.window.showInformationMessage(`Statistics for \"${projectId}\" have been reset.`);\r\n        }\r\n    });\r\n\r\n    const resetAllCommand = vscode.commands.registerCommand('workTimer.resetAll', async () => {\r\n        const confirm = await vscode.window.showWarningMessage(\r\n            'Are you sure you want to reset ALL statistics? This cannot be undone.',\r\n            { modal: true },\r\n            'Yes, Reset All'\r\n        );\r\n        if (confirm === 'Yes, Reset All') {\r\n            await storage.resetAll();\r\n            vscode.window.showInformationMessage('All statistics have been reset.');\r\n        }\r\n    });\r\n\r\n    const exportDataCommand = vscode.commands.registerCommand('workTimer.exportData', async () => {\r\n        const data = storage.getAllData();\r\n        const jsonContent = JSON.stringify(data, null, 2);\r\n        \r\n        const uri = await vscode.window.showSaveDialog({\r\n            defaultUri: vscode.Uri.file('punchcard-stats.json'),\r\n            filters: {\r\n                'JSON Files': ['json']\r\n            }\r\n        });\r\n\r\n        if (uri) {\r\n            await vscode.workspace.fs.writeFile(uri, Buffer.from(jsonContent, 'utf8'));\r\n            vscode.window.showInformationMessage(`Statistics exported to ${uri.fsPath}`);\r\n        }\r\n    });\r\n\r\n    const importDataCommand = vscode.commands.registerCommand('workTimer.importData', async () => {\r\n        const uri = await vscode.window.showOpenDialog({\r\n            canSelectFiles: true,\r\n            canSelectFolders: false,\r\n            canSelectMany: false,\r\n            filters: {\r\n                'JSON Files': ['json']\r\n            }\r\n        });\r\n\r\n        if (uri && uri[0]) {\r\n            try {\r\n                const fileContent = await vscode.workspace.fs.readFile(uri[0]);\r\n                const importedData = JSON.parse(Buffer.from(fileContent).toString('utf8'));\r\n                \r\n                if (importedData && importedData.projects) {\r\n                    const confirm = await vscode.window.showWarningMessage(\r\n                        'This will merge imported data with existing data. Continue?',\r\n                        { modal: true },\r\n                        'Yes, Import'\r\n                    );\r\n                    \r\n                    if (confirm === 'Yes, Import') {\r\n                        await storage.importData(importedData);\r\n                        vscode.window.showInformationMessage('Data imported successfully!');\r\n                    }\r\n                } else {\r\n                    vscode.window.showErrorMessage('Invalid data format. Expected a valid PUNCHCARD export file.');\r\n                }\r\n            } catch (error) {\r\n                vscode.window.showErrorMessage(`Failed to import data: ${error.message}`);\r\n            }\r\n        }\r\n    });\r\n\r\n    const checkSyncCommand = vscode.commands.registerCommand('workTimer.checkSync', async () => {\r\n        const data = storage.getAllData();\r\n        const projectCount = Object.keys(data.projects).length;\r\n        const totalTime = data.totalTimeAllProjects;\r\n        \r\n        const hours = Math.floor(totalTime / 3600000);\r\n        const minutes = Math.floor((totalTime % 3600000) / 60000);\r\n        \r\n        const message = [\r\n            '📊 PUNCHCARD Sync Status',\r\n            '',\r\n            `Projects tracked: ${projectCount}`,\r\n            `Total time: ${hours}h ${minutes}m`,\r\n            `Total keystrokes: ${data.totalKeystrokes}`,\r\n            '',\r\n            '⚙️ For sync to work:',\r\n            '1. Settings Sync must be ON (Ctrl+Shift+P → \"Settings Sync: Turn On\")',\r\n            '2. \"UI State\" must be checked in sync settings',\r\n            '3. Same Microsoft/GitHub account on both machines',\r\n            '4. Run \"Settings Sync: Sync Now\" to force sync',\r\n            '',\r\n            'Note: Sync may take a few minutes. Reload VS Code after syncing.'\r\n        ].join('\\n');\r\n        \r\n        vscode.window.showInformationMessage(message, { modal: true });\r\n    });\r\n\r\n    const clearSyncLogCommand = vscode.commands.registerCommand('workTimer.clearSyncLog', () => {\r\n        logger.clear();\r\n        if (webview && webview.panel) {\r\n            webview.update();\r\n        }\r\n        vscode.window.showInformationMessage('PUNCHCARD: Sync log cleared.');\r\n    });\r\n\r\n    const forceSyncCheckCommand = vscode.commands.registerCommand('workTimer.forceSyncCheck', async () => {\r\n        logger.info('sync', 'Manual sync check triggered by user');\r\n        await storage.checkForSyncedData();\r\n        if (webview && webview.panel) {\r\n            webview.update();\r\n        }\r\n        vscode.window.showInformationMessage('PUNCHCARD: Sync check completed. Open statistics to see results.');\r\n    });\r\n\r\n    const exportSyncLogCommand = vscode.commands.registerCommand('workTimer.exportSyncLog', async () => {\r\n        const logText = logger.exportLogs();\r\n        \r\n        // Also include sync info from storage\r\n        const syncInfo = storage.getSyncInfo ? storage.getSyncInfo() : {};\r\n        const fullExport = logText + '\\n\\n=== SYNC INFO ===\\n' + JSON.stringify(syncInfo, null, 2);\r\n        \r\n        const choice = await vscode.window.showInformationMessage(\r\n            'PUNCHCARD: Export sync logs for debugging?',\r\n            'Copy to Clipboard',\r\n            'Save to File'\r\n        );\r\n        \r\n        if (choice === 'Copy to Clipboard') {\r\n            await vscode.env.clipboard.writeText(fullExport);\r\n            vscode.window.showInformationMessage('PUNCHCARD: Sync log copied to clipboard!');\r\n        } else if (choice === 'Save to File') {\r\n            const uri = await vscode.window.showSaveDialog({\r\n                defaultUri: vscode.Uri.file('punchcard-sync-log.txt'),\r\n                filters: { 'Text Files': ['txt'], 'All Files': ['*'] }\r\n            });\r\n            if (uri) {\r\n                await vscode.workspace.fs.writeFile(uri, Buffer.from(fullExport, 'utf8'));\r\n                vscode.window.showInformationMessage(`PUNCHCARD: Sync log saved to ${uri.fsPath}`);\r\n            }\r\n        }\r\n    });\r\n\r\n    // Add commands to subscriptions\r\n    context.subscriptions.push(\r\n        showStatsCommand,\r\n        resetProjectCommand,\r\n        resetAllCommand,\r\n        exportDataCommand,\r\n        importDataCommand,\r\n        checkSyncCommand,\r\n        clearSyncLogCommand,\r\n        forceSyncCheckCommand,\r\n        exportSyncLogCommand\r\n    );\r\n\r\n    // Add disposables\r\n    context.subscriptions.push({\r\n        dispose: () => {\r\n            tracker.dispose();\r\n            statusBar.dispose();\r\n            storage.dispose();\r\n            webview.dispose();\r\n        }\r\n    });\r\n\r\n    logger.info('init', 'Extension activated successfully');\r\n}\r\n\r\n/**\r\n * Deactivate the extension\r\n */\r\nfunction deactivate() {\r\n    logger.info('init', 'Extension deactivating...');\r\n    if (storage) {\r\n        // Flush pending saves before deactivation\r\n        storage.flush();\r\n        storage.dispose();\r\n    }\r\n    if (tracker) {\r\n        tracker.dispose();\r\n    }\r\n    if (statusBar) {\r\n        statusBar.dispose();\r\n    }\r\n    if (webview) {\r\n        webview.dispose();\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    activate,\r\n    deactivate\r\n};\r\n","const vscode = require('vscode');\nconst { formatTime } = require('./utils');\n\n/**\n * Status bar item manager\n */\nclass StatusBar {\n    /**\n     * @param {import('./tracker').Tracker} tracker \n     */\n    constructor(tracker) {\n        this.tracker = tracker;\n        this.statusBarItem = vscode.window.createStatusBarItem(\n            vscode.StatusBarAlignment.Left,\n            100\n        );\n        this.statusBarItem.command = 'workTimer.showStats';\n        this.statusBarItem.tooltip = 'Click to view work time statistics';\n        this.updateInterval = null;\n    }\n\n    /**\n     * Initialize the status bar\n     */\n    initialize() {\n        this.statusBarItem.show();\n        this.update();\n\n        // Update every second\n        this.updateInterval = setInterval(() => this.update(), 1000);\n\n        // Listen for time updates from tracker\n        this.tracker.onTimeUpdate(() => this.update());\n        this.tracker.onAfkChange((isAfk) => this.updateAfkStatus(isAfk));\n    }\n\n    /**\n     * Update the status bar display\n     */\n    update() {\n        const sessionTime = this.tracker.getCurrentSessionTime();\n        const todayTime = this.tracker.getTodayTime();\n        const isTracking = this.tracker.isCurrentlyTracking();\n\n        const sessionStr = formatTime(sessionTime);\n        const todayStr = formatTime(todayTime);\n\n        const icon = isTracking ? '$(clock)' : '$(debug-pause)';\n        this.statusBarItem.text = `${icon} ${sessionStr} | Today: ${todayStr}`;\n        \n        if (!isTracking) {\n            this.statusBarItem.backgroundColor = new vscode.ThemeColor('statusBarItem.warningBackground');\n        } else {\n            this.statusBarItem.backgroundColor = undefined;\n        }\n    }\n\n    /**\n     * Update AFK status display\n     * @param {boolean} isAfk \n     */\n    updateAfkStatus(isAfk) {\n        if (isAfk) {\n            this.statusBarItem.text = `$(debug-pause) AFK - ${this.statusBarItem.text.split(' | ')[1] || ''}`;\n            this.statusBarItem.backgroundColor = new vscode.ThemeColor('statusBarItem.warningBackground');\n        } else {\n            this.statusBarItem.backgroundColor = undefined;\n            this.update();\n        }\n    }\n\n    /**\n     * Dispose the status bar\n     */\n    dispose() {\n        if (this.updateInterval) {\n            clearInterval(this.updateInterval);\n            this.updateInterval = null;\n        }\n        this.statusBarItem.dispose();\n    }\n}\n\nmodule.exports = { StatusBar };\n","const os = require('os');\r\nconst { createEmptyProjectStats, createEmptyStorageData, createEmptyDailyMetrics } = require('./types');\r\nconst { logger } = require('./syncLogger');\r\n\r\nconst STORAGE_KEY = 'punchcard-work-stats';\r\nconst MACHINE_ID_KEY = 'punchcard-machine-id';\r\nconst SYNC_KEYS = [STORAGE_KEY];\r\n// Machine ID key is deliberately NOT in SYNC_KEYS - must be unique per machine\r\n\r\n/**\r\n * Storage manager for work time statistics\r\n * Uses VS Code's globalState with sync enabled for cross-device synchronization\r\n */\r\nclass Storage {\r\n    /**\r\n     * @param {import('vscode').ExtensionContext} context \r\n     */\r\n    constructor(context) {\r\n        this.context = context;\r\n        this.data = createEmptyStorageData();\r\n        this.initialized = false;\r\n        this.syncCheckTimeout = null;\r\n        this.machineId = null;\r\n        this._lastSaveId = null;\r\n        this._saveTimer = null;\r\n        this._periodicSyncInterval = null;\r\n    }\r\n\r\n    /**\r\n     * Initialize storage and set up sync\r\n     */\r\n    async initialize() {\r\n        // Initialize machine ID first (before anything else)\r\n        this._initMachineId();\r\n        \r\n        logger.info('init', `Storage initializing on machine: ${this.machineId}`);\r\n        logger.info('init', `Platform: ${os.platform()}, Hostname: ${os.hostname()}, Node: ${process.version}`);\r\n        \r\n        // Enable sync for our storage key - this tells VS Code to sync this key\r\n        // when Settings Sync is enabled and \"UI State\" sync is turned on\r\n        this.context.globalState.setKeysForSync(SYNC_KEYS);\r\n        logger.info('sync', `setKeysForSync called with keys: [${SYNC_KEYS.join(', ')}]`);\r\n        \r\n        // Log raw globalState before load\r\n        const rawStored = this.context.globalState.get(STORAGE_KEY);\r\n        if (rawStored) {\r\n            const rawSize = JSON.stringify(rawStored).length;\r\n            logger.info('init', `Raw globalState data exists. Size: ${rawSize} bytes, _saveId: ${rawStored._saveId || 'none'}, _machineId: ${rawStored._machineId || 'none'}`);\r\n        } else {\r\n            logger.info('init', 'Raw globalState has NO data for our key - this is a fresh install or sync has not arrived yet');\r\n        }\r\n        \r\n        // Load existing data\r\n        await this.load();\r\n        this.initialized = true;\r\n        \r\n        logger.info('init', `Storage initialized. Projects: ${Object.keys(this.data.projects).length}, Machine: ${this.machineId}`);\r\n        \r\n        // Log detailed data summary\r\n        const projectIds = Object.keys(this.data.projects);\r\n        const totalSessions = Object.values(this.data.projects).reduce((sum, p) => sum + (p.sessions || []).length, 0);\r\n        logger.info('init', `Data summary: ${projectIds.length} projects, ${totalSessions} total sessions, totalTime: ${this.data.totalTimeAllProjects}ms`);\r\n        \r\n        // Log per-project summary\r\n        for (const pid of projectIds) {\r\n            const pStats = this.data.projects[pid];\r\n            const pSessions = (pStats.sessions || []);\r\n            const machines = [...new Set(pSessions.map(s => s.machineId || 'unknown'))];\r\n            logger.debug('init', `  Project \"${pid}\": ${pSessions.length} sessions, totalTime=${pStats.totalTime}ms, machines=[${machines.join(', ')}]`);\r\n        }\r\n        \r\n        // Check loaded data origin\r\n        if (this.data._machineId && this.data._machineId !== this.machineId) {\r\n            logger.warn('sync', `⚠️ Loaded data originated from DIFFERENT machine: ${this.data._machineId} (we are ${this.machineId}). This means Settings Sync HAS delivered data from another machine at some point.`);\r\n        } else if (this.data._machineId === this.machineId) {\r\n            logger.info('sync', 'Loaded data was last saved by THIS machine');\r\n        }\r\n        \r\n        // Schedule delayed sync checks + periodic checks\r\n        this.scheduleSyncCheck();\r\n        this._startPeriodicSyncCheck();\r\n    }\r\n\r\n    /**\r\n     * Schedule a check for synced data after a delay\r\n     * This helps catch data that syncs after the initial load\r\n     */\r\n    scheduleSyncCheck() {\r\n        // Check after 5 seconds, 15 seconds, and 30 seconds\r\n        const delays = [5000, 15000, 30000];\r\n        \r\n        delays.forEach(delay => {\r\n            setTimeout(async () => {\r\n                logger.debug('sync', `Running scheduled sync check (${delay}ms delay)`);\r\n                await this.checkForSyncedData();\r\n            }, delay);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Start periodic sync checks every 60 seconds\r\n     * This catches sync data that arrives during normal operation\r\n     */\r\n    _startPeriodicSyncCheck() {\r\n        this._periodicSyncInterval = setInterval(async () => {\r\n            logger.debug('sync', 'Running periodic sync check');\r\n            await this.checkForSyncedData();\r\n        }, 60000); // every 60 seconds\r\n    }\r\n\r\n    /**\r\n     * Initialize machine-specific ID (not synced between machines)\r\n     * Uses hostname + random suffix to uniquely identify this VS Code installation\r\n     */\r\n    _initMachineId() {\r\n        let stored = this.context.globalState.get(MACHINE_ID_KEY);\r\n        if (!stored) {\r\n            const hostname = os.hostname();\r\n            stored = `${hostname}-${Date.now().toString(36)}-${Math.random().toString(36).substring(2, 6)}`;\r\n            this.context.globalState.update(MACHINE_ID_KEY, stored);\r\n            logger.info('init', `Generated new machine ID: ${stored}`);\r\n        } else {\r\n            logger.info('init', `Using existing machine ID: ${stored}`);\r\n        }\r\n        this.machineId = stored;\r\n    }\r\n\r\n    /**\r\n     * Get today's date key in YYYY-MM-DD format\r\n     * @returns {string}\r\n     */\r\n    _getDateKey(timestamp) {\r\n        const d = new Date(timestamp || Date.now());\r\n        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;\r\n    }\r\n\r\n    /**\r\n     * Check if synced data has arrived and merge it with current data\r\n     */\r\n    async checkForSyncedData() {\r\n        const stored = this.context.globalState.get(STORAGE_KEY);\r\n        const dataSize = stored ? JSON.stringify(stored).length : 0;\r\n        \r\n        logger.info('sync', `Sync check started. globalState data size: ${dataSize} bytes`);\r\n        \r\n        if (!stored || !stored.projects) {\r\n            logger.warn('sync', 'No stored data found in globalState - sync may not be working. Check: 1) Settings Sync ON? 2) UI State checked? 3) Same account on both machines?');\r\n            logger.recordSyncCheckResult({ result: 'no-data', dataSize: 0 });\r\n            return;\r\n        }\r\n        \r\n        // Log detailed state comparison\r\n        const storedProjectCount = Object.keys(stored.projects).length;\r\n        const currentProjectCount = Object.keys(this.data.projects).length;\r\n        const storedTotalSessions = Object.values(stored.projects).reduce((sum, p) => sum + (p.sessions || []).length, 0);\r\n        const currentTotalSessions = Object.values(this.data.projects).reduce((sum, p) => sum + (p.sessions || []).length, 0);\r\n        \r\n        logger.info('sync', `Comparing: stored(${storedProjectCount} projects, ${storedTotalSessions} sessions, saveId=${stored._saveId || 'none'}, machine=${stored._machineId || 'none'}) vs current(${currentProjectCount} projects, ${currentTotalSessions} sessions, lastSaveId=${this._lastSaveId || 'none'}, machine=${this.machineId})`);\r\n        \r\n        // CRITICAL FIX: Detect if globalState was overwritten by Settings Sync\r\n        // by checking if the _saveId differs from what we last wrote\r\n        if (stored._saveId && stored._saveId !== this._lastSaveId) {\r\n            const isFromDifferentMachine = stored._machineId !== this.machineId;\r\n            logger.warn('sync', `🔄 SYNC DETECTED via _saveId mismatch! fromDifferentMachine=${isFromDifferentMachine}`, {\r\n                ourLastSaveId: this._lastSaveId,\r\n                storedSaveId: stored._saveId,\r\n                storedMachineId: stored._machineId,\r\n                ourMachineId: this.machineId,\r\n                storedProjectCount,\r\n                storedTotalSessions,\r\n                currentProjectCount,\r\n                currentTotalSessions\r\n            });\r\n            logger.recordSyncDetection();\r\n            logger.recordSyncCheckResult({ result: 'saveId-mismatch', storedSaveId: stored._saveId, isFromDifferentMachine });\r\n            this.mergeWithSyncedData(stored);\r\n            await this._saveImmediate();\r\n            return;\r\n        }\r\n        \r\n        // Also check for new projects/sessions we don't have\r\n        let needsMerge = false;\r\n        let mergeReason = '';\r\n        let newProjects = [];\r\n        let newSessions = [];\r\n        \r\n        for (const projectId in stored.projects) {\r\n            if (!this.data.projects[projectId]) {\r\n                needsMerge = true;\r\n                newProjects.push(projectId);\r\n                mergeReason = `New project(s) from sync: ${newProjects.join(', ')}`;\r\n                continue;\r\n            }\r\n            \r\n            const storedSessions = stored.projects[projectId].sessions || [];\r\n            const currentSessions = this.data.projects[projectId].sessions || [];\r\n            const currentStartTimes = new Set(currentSessions.map(s => s.startTime));\r\n            \r\n            for (const session of storedSessions) {\r\n                if (!currentStartTimes.has(session.startTime)) {\r\n                    needsMerge = true;\r\n                    newSessions.push({ projectId, startTime: session.startTime, machineId: session.machineId });\r\n                }\r\n                const currentSession = currentSessions.find(s => s.startTime === session.startTime);\r\n                if (currentSession && (session.duration || 0) > (currentSession.duration || 0)) {\r\n                    needsMerge = true;\r\n                    if (!mergeReason) mergeReason = `Updated session in ${projectId} (longer duration: ${session.duration} > ${currentSession.duration})`;\r\n                }\r\n            }\r\n        }\r\n        \r\n        if (newProjects.length > 0) {\r\n            mergeReason = `New project(s): [${newProjects.join(', ')}]`;\r\n        } else if (newSessions.length > 0) {\r\n            mergeReason = `${newSessions.length} new session(s) found in stored data`;\r\n        }\r\n        \r\n        if (needsMerge) {\r\n            logger.info('sync', `✅ Sync merge needed: ${mergeReason}`, {\r\n                newProjects,\r\n                newSessions: newSessions.slice(0, 10)\r\n            });\r\n            logger.recordSyncDetection();\r\n            logger.recordSyncCheckResult({ result: 'merge-needed', reason: mergeReason });\r\n            this.mergeWithSyncedData(stored);\r\n            await this._saveImmediate();\r\n        } else {\r\n            logger.debug('sync', `Sync check complete - no new data. saveIds match: ${stored._saveId === this._lastSaveId}`);\r\n            logger.recordSyncCheckResult({ result: 'no-change', saveIdsMatch: stored._saveId === this._lastSaveId });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Merge synced data with current data.\r\n     * Sessions are merged by startTime (source of truth for time).\r\n     * totalTime is derived from merged sessions to avoid data loss.\r\n     * Other metrics use Math.max as a safe heuristic.\r\n     * @param {import('./types').StorageData} syncedData\r\n     */\r\n    mergeWithSyncedData(syncedData) {\r\n        const syncedSize = JSON.stringify(syncedData).length;\r\n        const currentSize = JSON.stringify(this.data).length;\r\n        logger.info('merge', `📦 Starting merge. Synced data: ${syncedSize} bytes, Current data: ${currentSize} bytes`, {\r\n            syncedProjects: Object.keys(syncedData.projects || {}),\r\n            currentProjects: Object.keys(this.data.projects || {}),\r\n            syncedMachineId: syncedData._machineId,\r\n            syncedSaveId: syncedData._saveId,\r\n            syncedLastSaveTime: syncedData._lastSaveTime ? new Date(syncedData._lastSaveTime).toISOString() : 'none',\r\n            ourMachineId: this.machineId,\r\n            ourSaveId: this._lastSaveId\r\n        });\r\n        \r\n        let newProjectCount = 0;\r\n        let mergedProjectCount = 0;\r\n        let newSessionCount = 0;\r\n        \r\n        for (const projectId in syncedData.projects) {\r\n            const syncedStats = syncedData.projects[projectId];\r\n            \r\n            if (!this.data.projects[projectId]) {\r\n                // New project from sync\r\n                this.data.projects[projectId] = syncedStats;\r\n                newProjectCount++;\r\n                logger.info('merge', `New project from sync: ${projectId}`, {\r\n                    sessions: (syncedStats.sessions || []).length,\r\n                    totalTime: syncedStats.totalTime\r\n                });\r\n            } else {\r\n                // Merge sessions first (source of truth for time)\r\n                const currentStats = this.data.projects[projectId];\r\n                const currentSessionCount = (currentStats.sessions || []).length;\r\n                const syncedSessionCount = (syncedStats.sessions || []).length;\r\n                const mergedSessions = this.mergeSessions(currentStats.sessions || [], syncedStats.sessions || []);\r\n                const addedSessions = mergedSessions.length - currentSessionCount;\r\n                newSessionCount += Math.max(0, addedSessions);\r\n                \r\n                // Derive totalTime from merged sessions\r\n                const totalTimeFromSessions = mergedSessions.reduce((sum, s) => sum + (s.duration || 0), 0);\r\n                \r\n                this.data.projects[projectId] = {\r\n                    totalTime: totalTimeFromSessions,\r\n                    linesAdded: Math.max(currentStats.linesAdded || 0, syncedStats.linesAdded || 0),\r\n                    linesDeleted: Math.max(currentStats.linesDeleted || 0, syncedStats.linesDeleted || 0),\r\n                    linesAddedBulk: Math.max(currentStats.linesAddedBulk || 0, syncedStats.linesAddedBulk || 0),\r\n                    linesDeletedBulk: Math.max(currentStats.linesDeletedBulk || 0, syncedStats.linesDeletedBulk || 0),\r\n                    charactersAdded: Math.max(currentStats.charactersAdded || 0, syncedStats.charactersAdded || 0),\r\n                    charactersDeleted: Math.max(currentStats.charactersDeleted || 0, syncedStats.charactersDeleted || 0),\r\n                    keystrokes: Math.max(currentStats.keystrokes || 0, syncedStats.keystrokes || 0),\r\n                    sessions: mergedSessions,\r\n                    lastActive: Math.max(currentStats.lastActive || 0, syncedStats.lastActive || 0),\r\n                    dailyMetrics: this._mergeDailyMetrics(currentStats.dailyMetrics || {}, syncedStats.dailyMetrics || {})\r\n                };\r\n                \r\n                mergedProjectCount++;\r\n                if (addedSessions > 0) {\r\n                    logger.info('merge', `Merged project ${projectId}: +${addedSessions} sessions (${currentSessionCount} + ${syncedSessionCount} synced → ${mergedSessions.length} merged)`);\r\n                }\r\n            }\r\n        }\r\n        \r\n        // Recalculate totals from merged data\r\n        this.recalculateTotals();\r\n        logger.recordMerge();\r\n        \r\n        const mergedSize = JSON.stringify(this.data).length;\r\n        const mergedTotalSessions = Object.values(this.data.projects).reduce((sum, p) => sum + (p.sessions || []).length, 0);\r\n        logger.info('merge', `✅ Merge complete: ${newProjectCount} new projects, ${mergedProjectCount} merged projects, ${newSessionCount} new sessions. Final size: ${mergedSize} bytes, Total sessions: ${mergedTotalSessions}`);\r\n    }\r\n\r\n    /**\r\n     * Merge session arrays, avoiding duplicates based on startTime.\r\n     * When both have a session with the same startTime, keeps the one\r\n     * with the longer duration (more complete/up-to-date).\r\n     */\r\n    mergeSessions(currentSessions, syncedSessions) {\r\n        const sessionMap = new Map();\r\n        \r\n        // Add current sessions\r\n        for (const session of currentSessions) {\r\n            sessionMap.set(session.startTime, session);\r\n        }\r\n        \r\n        // Merge synced sessions — keep the one with longer duration\r\n        let replaced = 0;\r\n        let added = 0;\r\n        for (const session of syncedSessions) {\r\n            const existing = sessionMap.get(session.startTime);\r\n            if (!existing) {\r\n                sessionMap.set(session.startTime, session);\r\n                added++;\r\n            } else if ((session.duration || 0) > (existing.duration || 0)) {\r\n                // Synced version is more complete, use it\r\n                sessionMap.set(session.startTime, session);\r\n                replaced++;\r\n            }\r\n        }\r\n        \r\n        if (added > 0 || replaced > 0) {\r\n            logger.debug('merge', `Session merge: ${added} new, ${replaced} replaced (longer duration)`);\r\n        }\r\n        \r\n        // Return sorted by startTime\r\n        return Array.from(sessionMap.values()).sort((a, b) => a.startTime - b.startTime);\r\n    }\r\n\r\n    /**\r\n     * Merge dailyMetrics from two sources. For each day, takes Math.max per field,\r\n     * since each machine accumulates independently and we want the higher value.\r\n     */\r\n    _mergeDailyMetrics(current, synced) {\r\n        const merged = { ...current };\r\n        for (const dayKey in synced) {\r\n            if (!merged[dayKey]) {\r\n                merged[dayKey] = { ...synced[dayKey] };\r\n            } else {\r\n                const c = merged[dayKey];\r\n                const s = synced[dayKey];\r\n                merged[dayKey] = {\r\n                    time: Math.max(c.time || 0, s.time || 0),\r\n                    keystrokes: Math.max(c.keystrokes || 0, s.keystrokes || 0),\r\n                    linesAdded: Math.max(c.linesAdded || 0, s.linesAdded || 0),\r\n                    linesDeleted: Math.max(c.linesDeleted || 0, s.linesDeleted || 0),\r\n                    linesAddedBulk: Math.max(c.linesAddedBulk || 0, s.linesAddedBulk || 0),\r\n                    linesDeletedBulk: Math.max(c.linesDeletedBulk || 0, s.linesDeletedBulk || 0),\r\n                    charactersAdded: Math.max(c.charactersAdded || 0, s.charactersAdded || 0),\r\n                    charactersDeleted: Math.max(c.charactersDeleted || 0, s.charactersDeleted || 0)\r\n                };\r\n            }\r\n        }\r\n        return merged;\r\n    }\r\n\r\n    /**\r\n     * Recalculate total values from all projects.\r\n     * Derives totalTime from sessions (source of truth) to ensure\r\n     * accurate totals after cross-machine merges.\r\n     */\r\n    recalculateTotals() {\r\n        const oldTotal = this.data.totalTimeAllProjects;\r\n        this.data.totalTimeAllProjects = 0;\r\n        this.data.totalKeystrokes = 0;\r\n        \r\n        for (const projectId in this.data.projects) {\r\n            const stats = this.data.projects[projectId];\r\n            // Derive totalTime from sessions (source of truth)\r\n            const sessionTime = (stats.sessions || []).reduce((sum, s) => sum + (s.duration || 0), 0);\r\n            stats.totalTime = sessionTime;\r\n            this.data.totalTimeAllProjects += sessionTime;\r\n            this.data.totalKeystrokes += stats.keystrokes || 0;\r\n        }\r\n        \r\n        if (oldTotal !== this.data.totalTimeAllProjects) {\r\n            logger.debug('storage', `Totals recalculated: ${oldTotal}ms → ${this.data.totalTimeAllProjects}ms (delta: ${this.data.totalTimeAllProjects - oldTotal}ms)`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Load data from global state\r\n     */\r\n    async load() {\r\n        const stored = this.context.globalState.get(STORAGE_KEY);\r\n        \r\n        if (stored) {\r\n            const dataSize = JSON.stringify(stored).length;\r\n            this.data = {\r\n                projects: stored.projects || {},\r\n                totalTimeAllProjects: stored.totalTimeAllProjects || 0,\r\n                totalKeystrokes: stored.totalKeystrokes || 0,\r\n                _saveId: stored._saveId || null,\r\n                _machineId: stored._machineId || null,\r\n                _lastSaveTime: stored._lastSaveTime || null\r\n            };\r\n            // Track the save ID so we can detect when sync overwrites it\r\n            this._lastSaveId = stored._saveId || null;\r\n            \r\n            // Count sessions by machine for diagnostics\r\n            const sessionsByMachine = {};\r\n            for (const pid in this.data.projects) {\r\n                for (const s of (this.data.projects[pid].sessions || [])) {\r\n                    const mid = s.machineId || 'unknown';\r\n                    sessionsByMachine[mid] = (sessionsByMachine[mid] || 0) + 1;\r\n                }\r\n            }\r\n            \r\n            logger.info('storage', `Loaded data from globalState. Size: ${dataSize} bytes`, {\r\n                projects: Object.keys(this.data.projects).length,\r\n                totalTime: this.data.totalTimeAllProjects,\r\n                loadedSaveId: this._lastSaveId,\r\n                loadedMachineId: this.data._machineId,\r\n                lastSaveTime: this.data._lastSaveTime ? new Date(this.data._lastSaveTime).toISOString() : 'never',\r\n                sessionsByMachine\r\n            });\r\n            \r\n            // Log whether data was from this machine or another\r\n            if (this.data._machineId && this.data._machineId !== this.machineId) {\r\n                logger.warn('storage', `⚠️ Data was last saved by a DIFFERENT machine: ${this.data._machineId}. This is evidence that Settings Sync is working.`);\r\n            }\r\n        } else {\r\n            this.data = createEmptyStorageData();\r\n            this._lastSaveId = null;\r\n            logger.warn('storage', 'No existing data found in globalState - starting fresh. If you expected synced data, check Settings Sync settings.');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Save data to global state\r\n     */\r\n    /**\r\n     * Internal save with sync detection.\r\n     * Before writing, checks if globalState was overwritten by Settings Sync\r\n     * (detected via _saveId mismatch) and merges if needed.\r\n     */\r\n    async save() {\r\n        // CRITICAL SYNC FIX: Before saving, check if Settings Sync has\r\n        // overwritten our data with data from another machine.\r\n        // We detect this by comparing the _saveId in globalState with\r\n        // the _saveId we last wrote.\r\n        try {\r\n            const currentStored = this.context.globalState.get(STORAGE_KEY);\r\n            if (currentStored) {\r\n                const storedSize = JSON.stringify(currentStored).length;\r\n                if (currentStored._saveId && currentStored._saveId !== this._lastSaveId) {\r\n                    const isFromDifferentMachine = currentStored._machineId !== this.machineId;\r\n                    logger.warn('sync', `🔄 PRE-SAVE SYNC DETECTED! globalState was modified by ${isFromDifferentMachine ? 'ANOTHER machine' : 'unknown source'}. Merging before save.`, {\r\n                        ourLastSaveId: this._lastSaveId,\r\n                        storedSaveId: currentStored._saveId,\r\n                        storedMachineId: currentStored._machineId,\r\n                        ourMachineId: this.machineId,\r\n                        storedDataSize: storedSize,\r\n                        storedProjects: Object.keys(currentStored.projects || {}).length,\r\n                        storedSessions: Object.values(currentStored.projects || {}).reduce((sum, p) => sum + (p.sessions || []).length, 0)\r\n                    });\r\n                    logger.recordSyncDetection();\r\n                    this.mergeWithSyncedData(currentStored);\r\n                } else {\r\n                    logger.debug('storage', `Pre-save check: saveId matches (${this._lastSaveId}), no sync detected. Stored size: ${storedSize} bytes`);\r\n                }\r\n            } else {\r\n                logger.debug('storage', 'Pre-save check: no stored data in globalState');\r\n            }\r\n        } catch (e) {\r\n            logger.error('storage', `Error during pre-save sync check: ${e.message}`, { stack: e.stack });\r\n        }\r\n        \r\n        // Stamp our data with our save ID and machine ID\r\n        this._lastSaveId = `${this.machineId}-${Date.now()}`;\r\n        this.data._saveId = this._lastSaveId;\r\n        this.data._machineId = this.machineId;\r\n        this.data._lastSaveTime = Date.now();\r\n        \r\n        const dataToSave = this.data;\r\n        const saveSize = JSON.stringify(dataToSave).length;\r\n        const totalSessions = Object.values(dataToSave.projects || {}).reduce((sum, p) => sum + (p.sessions || []).length, 0);\r\n        \r\n        await this.context.globalState.update(STORAGE_KEY, dataToSave);\r\n        logger.recordSave();\r\n        logger.recordSaveId(this._lastSaveId);\r\n        logger.debug('storage', `Data saved. saveId=${this._lastSaveId}, size=${saveSize} bytes, projects=${Object.keys(dataToSave.projects || {}).length}, sessions=${totalSessions}`);\r\n    }\r\n\r\n    /**\r\n     * Schedule a debounced save. Used by high-frequency operations (addTime, updateLastSession)\r\n     * to reduce save frequency and give sync data a chance to survive.\r\n     * Data is saved at most every 10 seconds.\r\n     */\r\n    _scheduleSave() {\r\n        if (this._saveTimer) return; // already scheduled\r\n        this._saveTimer = setTimeout(async () => {\r\n            this._saveTimer = null;\r\n            await this.save();\r\n        }, 10000); // 10 second debounce\r\n    }\r\n\r\n    /**\r\n     * Force an immediate save, cancelling any pending debounced save.\r\n     * Used for important operations and cleanup.\r\n     */\r\n    async _saveImmediate() {\r\n        if (this._saveTimer) {\r\n            clearTimeout(this._saveTimer);\r\n            this._saveTimer = null;\r\n        }\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Flush any pending saves. Call this before extension deactivates.\r\n     */\r\n    async flush() {\r\n        if (this._saveTimer) {\r\n            clearTimeout(this._saveTimer);\r\n            this._saveTimer = null;\r\n            await this.save();\r\n            logger.info('storage', 'Flushed pending save on deactivation');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get stats for a specific project\r\n     * @param {string} projectId \r\n     * @returns {import('./types').ProjectStats}\r\n     */\r\n    getProjectStats(projectId) {\r\n        if (!this.data.projects[projectId]) {\r\n            this.data.projects[projectId] = createEmptyProjectStats();\r\n        }\r\n        const stats = this.data.projects[projectId];\r\n        // Ensure dailyMetrics exists (backward compat)\r\n        if (!stats.dailyMetrics) {\r\n            stats.dailyMetrics = {};\r\n        }\r\n        return stats;\r\n    }\r\n\r\n    /**\r\n     * Update stats for a project\r\n     * @param {string} projectId \r\n     * @param {Partial<import('./types').ProjectStats>} updates \r\n     */\r\n    async updateProjectStats(projectId, updates) {\r\n        const stats = this.getProjectStats(projectId);\r\n        Object.assign(stats, updates);\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Add time to a project\r\n     * @param {string} projectId \r\n     * @param {number} timeMs \r\n     */\r\n    async addTime(projectId, timeMs) {\r\n        const stats = this.getProjectStats(projectId);\r\n        stats.totalTime += timeMs;\r\n        stats.lastActive = Date.now();\r\n        this.data.totalTimeAllProjects += timeMs;\r\n        // Track daily time\r\n        const dayKey = this._getDateKey();\r\n        if (!stats.dailyMetrics[dayKey]) stats.dailyMetrics[dayKey] = createEmptyDailyMetrics();\r\n        stats.dailyMetrics[dayKey].time += timeMs;\r\n        // Use debounced save - this is called every second\r\n        this._scheduleSave();\r\n    }\r\n\r\n    /**\r\n     * Add a completed session\r\n     * @param {string} projectId \r\n     * @param {import('./types').Session} session \r\n     */\r\n    async addSession(projectId, session) {\r\n        const stats = this.getProjectStats(projectId);\r\n        // Tag session with machine ID for sync identification\r\n        session.machineId = this.machineId;\r\n        stats.sessions.push(session);\r\n        logger.info('session', `New session started for ${projectId}`, {\r\n            startTime: session.startTime,\r\n            machineId: this.machineId\r\n        });\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Update the last session end time\r\n     * @param {string} projectId \r\n     * @param {number} endTime \r\n     * @param {number} duration \r\n     */\r\n    /**\r\n     * Update a session's end time and duration.\r\n     * CRITICAL FIX: Finds session by startTime instead of using last index,\r\n     * because after a sync merge the last session may belong to another machine.\r\n     * @param {string} projectId \r\n     * @param {number} sessionStartTime - The startTime of the session to update\r\n     * @param {number} endTime \r\n     * @param {number} duration \r\n     */\r\n    async updateLastSession(projectId, sessionStartTime, endTime, duration) {\r\n        const stats = this.getProjectStats(projectId);\r\n        if (stats.sessions.length > 0) {\r\n            // CRITICAL FIX: Find session by startTime, not by index.\r\n            // After merge, the last session in the array may be from another machine.\r\n            const session = stats.sessions.find(s => s.startTime === sessionStartTime);\r\n            if (session) {\r\n                session.endTime = endTime;\r\n                session.duration = duration;\r\n                // Use debounced save - this is called every second\r\n                this._scheduleSave();\r\n            } else {\r\n                // Fallback: try last session from this machine\r\n                const machineSession = stats.sessions\r\n                    .filter(s => !s.machineId || s.machineId === this.machineId)\r\n                    .pop();\r\n                if (machineSession) {\r\n                    machineSession.endTime = endTime;\r\n                    machineSession.duration = duration;\r\n                    this._scheduleSave();\r\n                    logger.warn('session', `Session not found by startTime ${sessionStartTime}, used fallback (last session from this machine)`);\r\n                } else {\r\n                    logger.error('session', `Could not find session to update for ${projectId} (startTime: ${sessionStartTime})`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add metrics to a project\r\n     * @param {string} projectId \r\n     * @param {{ linesAdded?: number, linesDeleted?: number, linesAddedBulk?: number, linesDeletedBulk?: number, charactersAdded?: number, charactersDeleted?: number, keystrokes?: number }} metrics \r\n     */\r\n    async addMetrics(projectId, metrics) {\r\n        const stats = this.getProjectStats(projectId);\r\n        const dayKey = this._getDateKey();\r\n        if (!stats.dailyMetrics[dayKey]) stats.dailyMetrics[dayKey] = createEmptyDailyMetrics();\r\n        const day = stats.dailyMetrics[dayKey];\r\n        \r\n        if (metrics.linesAdded) {\r\n            stats.linesAdded += metrics.linesAdded;\r\n            day.linesAdded += metrics.linesAdded;\r\n        }\r\n        if (metrics.linesDeleted) {\r\n            stats.linesDeleted += metrics.linesDeleted;\r\n            day.linesDeleted += metrics.linesDeleted;\r\n        }\r\n        if (metrics.linesAddedBulk) {\r\n            if (typeof stats.linesAddedBulk !== 'number') stats.linesAddedBulk = 0;\r\n            stats.linesAddedBulk += metrics.linesAddedBulk;\r\n            day.linesAddedBulk += metrics.linesAddedBulk;\r\n        }\r\n        if (metrics.linesDeletedBulk) {\r\n            if (typeof stats.linesDeletedBulk !== 'number') stats.linesDeletedBulk = 0;\r\n            stats.linesDeletedBulk += metrics.linesDeletedBulk;\r\n            day.linesDeletedBulk += metrics.linesDeletedBulk;\r\n        }\r\n        if (metrics.charactersAdded) {\r\n            stats.charactersAdded += metrics.charactersAdded;\r\n            day.charactersAdded += metrics.charactersAdded;\r\n        }\r\n        if (metrics.charactersDeleted) {\r\n            stats.charactersDeleted += metrics.charactersDeleted;\r\n            day.charactersDeleted += metrics.charactersDeleted;\r\n        }\r\n        if (metrics.keystrokes) {\r\n            stats.keystrokes += metrics.keystrokes;\r\n            this.data.totalKeystrokes += metrics.keystrokes;\r\n            day.keystrokes += metrics.keystrokes;\r\n        }\r\n        \r\n        stats.lastActive = Date.now();\r\n        // Use debounced save - addMetrics can be called very frequently\r\n        this._scheduleSave();\r\n    }\r\n\r\n    /**\r\n     * Reset a specific stat for a project\r\n     * @param {string} projectId \r\n     * @param {string} statName - The stat to reset (keystrokes, linesAdded, linesDeleted, linesAddedBulk, linesDeletedBulk, charactersAdded, charactersDeleted, totalTime, sessions)\r\n     */\r\n    async resetProjectStat(projectId, statName) {\r\n        if (!this.data.projects[projectId]) {\r\n            return;\r\n        }\r\n        \r\n        const stats = this.data.projects[projectId];\r\n        \r\n        switch (statName) {\r\n            case 'keystrokes':\r\n                this.data.totalKeystrokes -= stats.keystrokes || 0;\r\n                stats.keystrokes = 0;\r\n                break;\r\n            case 'linesAdded':\r\n                stats.linesAdded = 0;\r\n                break;\r\n            case 'linesDeleted':\r\n                stats.linesDeleted = 0;\r\n                break;\r\n            case 'linesAddedBulk':\r\n                stats.linesAddedBulk = 0;\r\n                break;\r\n            case 'linesDeletedBulk':\r\n                stats.linesDeletedBulk = 0;\r\n                break;\r\n            case 'charactersAdded':\r\n                stats.charactersAdded = 0;\r\n                break;\r\n            case 'charactersDeleted':\r\n                stats.charactersDeleted = 0;\r\n                break;\r\n            case 'totalTime':\r\n                this.data.totalTimeAllProjects -= stats.totalTime || 0;\r\n                stats.totalTime = 0;\r\n                break;\r\n            case 'sessions':\r\n                stats.sessions = [];\r\n                break;\r\n            case 'allLines':\r\n                stats.linesAdded = 0;\r\n                stats.linesDeleted = 0;\r\n                stats.linesAddedBulk = 0;\r\n                stats.linesDeletedBulk = 0;\r\n                break;\r\n            case 'allChars':\r\n                stats.charactersAdded = 0;\r\n                stats.charactersDeleted = 0;\r\n                break;\r\n            case 'dailyMetrics':\r\n                stats.dailyMetrics = {};\r\n                break;\r\n        }\r\n        \r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Reset a specific stat across ALL projects (global reset)\r\n     * @param {string} statName - The stat to reset globally\r\n     */\r\n    async resetGlobalStat(statName) {\r\n        for (const projectId in this.data.projects) {\r\n            const stats = this.data.projects[projectId];\r\n            \r\n            switch (statName) {\r\n                case 'keystrokes':\r\n                    stats.keystrokes = 0;\r\n                    break;\r\n                case 'linesAdded':\r\n                    stats.linesAdded = 0;\r\n                    break;\r\n                case 'linesDeleted':\r\n                    stats.linesDeleted = 0;\r\n                    break;\r\n                case 'linesAddedBulk':\r\n                    stats.linesAddedBulk = 0;\r\n                    break;\r\n                case 'linesDeletedBulk':\r\n                    stats.linesDeletedBulk = 0;\r\n                    break;\r\n                case 'charactersAdded':\r\n                    stats.charactersAdded = 0;\r\n                    break;\r\n                case 'charactersDeleted':\r\n                    stats.charactersDeleted = 0;\r\n                    break;\r\n                case 'totalTime':\r\n                    stats.totalTime = 0;\r\n                    break;\r\n                case 'sessions':\r\n                    stats.sessions = [];\r\n                    break;\r\n            }\r\n        }\r\n        \r\n        // Update totals\r\n        if (statName === 'keystrokes') {\r\n            this.data.totalKeystrokes = 0;\r\n        }\r\n        if (statName === 'totalTime') {\r\n            this.data.totalTimeAllProjects = 0;\r\n        }\r\n        \r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Reset stats for a specific project\r\n     * @param {string} projectId \r\n     */\r\n    async resetProject(projectId) {\r\n        if (this.data.projects[projectId]) {\r\n            const oldStats = this.data.projects[projectId];\r\n            this.data.totalTimeAllProjects -= oldStats.totalTime;\r\n            this.data.totalKeystrokes -= oldStats.keystrokes;\r\n            delete this.data.projects[projectId];\r\n            await this.save();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reset all statistics\r\n     */\r\n    async resetAll() {\r\n        this.data = createEmptyStorageData();\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Import data from an exported JSON file (merges with existing data)\r\n     * @param {import('./types').StorageData} importedData \r\n     */\r\n    async importData(importedData) {\r\n        if (!importedData || !importedData.projects) {\r\n            throw new Error('Invalid data format');\r\n        }\r\n\r\n        logger.info('storage', 'Importing data', {\r\n            projectCount: Object.keys(importedData.projects).length\r\n        });\r\n\r\n        // Merge imported data with existing data\r\n        for (const projectId in importedData.projects) {\r\n            const importedStats = importedData.projects[projectId];\r\n            \r\n            if (!this.data.projects[projectId]) {\r\n                // New project, add it directly\r\n                this.data.projects[projectId] = importedStats;\r\n            } else {\r\n                // Existing project, merge sessions and derive totalTime\r\n                const existingStats = this.data.projects[projectId];\r\n                const mergedSessions = this.mergeSessions(existingStats.sessions || [], importedStats.sessions || []);\r\n                const totalTimeFromSessions = mergedSessions.reduce((sum, s) => sum + (s.duration || 0), 0);\r\n                \r\n                this.data.projects[projectId] = {\r\n                    totalTime: totalTimeFromSessions,\r\n                    linesAdded: Math.max(existingStats.linesAdded || 0, importedStats.linesAdded || 0),\r\n                    linesDeleted: Math.max(existingStats.linesDeleted || 0, importedStats.linesDeleted || 0),\r\n                    linesAddedBulk: Math.max(existingStats.linesAddedBulk || 0, importedStats.linesAddedBulk || 0),\r\n                    linesDeletedBulk: Math.max(existingStats.linesDeletedBulk || 0, importedStats.linesDeletedBulk || 0),\r\n                    charactersAdded: Math.max(existingStats.charactersAdded || 0, importedStats.charactersAdded || 0),\r\n                    charactersDeleted: Math.max(existingStats.charactersDeleted || 0, importedStats.charactersDeleted || 0),\r\n                    keystrokes: Math.max(existingStats.keystrokes || 0, importedStats.keystrokes || 0),\r\n                    sessions: mergedSessions,\r\n                    lastActive: Math.max(existingStats.lastActive || 0, importedStats.lastActive || 0),\r\n                    dailyMetrics: this._mergeDailyMetrics(existingStats.dailyMetrics || {}, importedStats.dailyMetrics || {})\r\n                };\r\n            }\r\n        }\r\n\r\n        // Recalculate totals\r\n        this.data.totalTimeAllProjects = 0;\r\n        this.data.totalKeystrokes = 0;\r\n        for (const projectId in this.data.projects) {\r\n            this.data.totalTimeAllProjects += this.data.projects[projectId].totalTime || 0;\r\n            this.data.totalKeystrokes += this.data.projects[projectId].keystrokes || 0;\r\n        }\r\n\r\n        await this.save();\r\n    }\r\n\r\n    /**\r\n     * Get all data for export (strips internal sync metadata)\r\n     * @returns {import('./types').StorageData}\r\n     */\r\n    getAllData() {\r\n        const { _saveId, _machineId, _lastSaveTime, ...cleanData } = this.data;\r\n        return { ...cleanData };\r\n    }\r\n\r\n    /**\r\n     * Get sync diagnostic information for the webview log panel\r\n     * @returns {Object}\r\n     */\r\n    getSyncInfo() {\r\n        const counters = logger.getCounters();\r\n        const totalSessions = Object.values(this.data.projects).reduce(\r\n            (sum, p) => sum + (p.sessions || []).length, 0\r\n        );\r\n        \r\n        // Count sessions per machine\r\n        const sessionsByMachine = {};\r\n        for (const projectId in this.data.projects) {\r\n            for (const session of (this.data.projects[projectId].sessions || [])) {\r\n                const mid = session.machineId || 'unknown';\r\n                sessionsByMachine[mid] = (sessionsByMachine[mid] || 0) + 1;\r\n            }\r\n        }\r\n        \r\n        return {\r\n            machineId: this.machineId,\r\n            lastSaveId: this._lastSaveId,\r\n            lastSaveTime: this.data._lastSaveTime,\r\n            savedMachineId: this.data._machineId,\r\n            syncDetections: counters.syncDetections,\r\n            totalSaves: counters.saves,\r\n            totalMerges: counters.merges,\r\n            projectCount: Object.keys(this.data.projects).length,\r\n            totalSessions,\r\n            sessionsByMachine\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Dispose storage resources\r\n     */\r\n    dispose() {\r\n        if (this._saveTimer) {\r\n            clearTimeout(this._saveTimer);\r\n            this._saveTimer = null;\r\n        }\r\n        if (this._periodicSyncInterval) {\r\n            clearInterval(this._periodicSyncInterval);\r\n            this._periodicSyncInterval = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Get summary statistics\r\n     */\r\n    getSummary() {\r\n        const projectCount = Object.keys(this.data.projects).length;\r\n        let totalSessions = 0;\r\n        let totalLinesAdded = 0;\r\n        let totalLinesDeleted = 0;\r\n        let totalLinesAddedBulk = 0;\r\n        let totalLinesDeletedBulk = 0;\r\n        let totalCharsAdded = 0;\r\n        let totalCharsDeleted = 0;\r\n\r\n        for (const projectId in this.data.projects) {\r\n            const stats = this.data.projects[projectId];\r\n            totalSessions += stats.sessions.length;\r\n            totalLinesAdded += stats.linesAdded || 0;\r\n            totalLinesDeleted += stats.linesDeleted || 0;\r\n            totalLinesAddedBulk += stats.linesAddedBulk || 0;\r\n            totalLinesDeletedBulk += stats.linesDeletedBulk || 0;\r\n            totalCharsAdded += stats.charactersAdded || 0;\r\n            totalCharsDeleted += stats.charactersDeleted || 0;\r\n        }\r\n\r\n        return {\r\n            projectCount,\r\n            totalTime: this.data.totalTimeAllProjects,\r\n            totalKeystrokes: this.data.totalKeystrokes,\r\n            totalSessions,\r\n            totalLinesAdded,\r\n            totalLinesDeleted,\r\n            totalLinesAddedBulk,\r\n            totalLinesDeletedBulk,\r\n            totalCharsAdded,\r\n            totalCharsDeleted\r\n        };\r\n    }\r\n}\r\n\r\nmodule.exports = { Storage, STORAGE_KEY };\r\n","module.exports = require(\"os\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(497);\n"],"names":["vscode","formatTime","formatTimeHuman","getDailyBreakdown","getWeeklyBreakdown","getMonthlyBreakdown","getTimeInRange","getStartOfDay","getStartOfWeek","getStartOfMonth","getEndOfDay","getEndOfWeek","getEndOfMonth","aggregateDailyMetrics","logger","module","exports","StatsWebView","constructor","context","storage","this","panel","show","reveal","ViewColumn","One","update","window","createWebviewPanel","enableScripts","retainContextWhenHidden","webview","html","getWebviewContent","onDidReceiveMessage","async","message","command","showWarningMessage","projectId","modal","resetProject","showInformationMessage","statLabel","resetProjectStat","statName","resetGlobalStat","clear","checkForSyncedData","logText","exportLogs","syncInfo","getSyncInfo","fullExport","JSON","stringify","env","clipboard","writeText","undefined","subscriptions","onDidDispose","projects","getAllData","allSessions","push","sessions","dailyData","weeklyData","monthlyData","periods","today","start","end","label","week","month","all","Date","now","periodData","periodKey","range","Object","entries","gTime","gKeystrokes","gLinesAdded","gLinesDeleted","gLinesAddedBulk","gLinesDeletedBulk","gCharsAdded","gCharsDeleted","gSessions","projectPeriodData","stats","sessionsInRange","filter","s","startTime","endTime","timeInRange","metrics","time","totalTime","keystrokes","linesAdded","linesDeleted","linesAddedBulk","linesDeletedBulk","charactersAdded","charactersDeleted","dailyMetrics","length","lastActive","summary","totalKeystrokes","totalSessions","totalLinesAdded","totalLinesDeleted","totalLinesAddedBulk","totalLinesDeletedBulk","totalCharsAdded","totalCharsDeleted","projectCount","keys","syncLogs","getLogs","projectList","map","id","sort","a","b","machineId","lastSaveTime","toLocaleString","totalSaves","syncDetections","totalMerges","sessionsByMachine","mid","count","substring","join","slice","reverse","entry","timestamp","toLocaleTimeString","hasData","data","category","level","toUpperCase","escapeHtml","name","formatNumber","num","text","div","replace","m","dispose","getProjectId","createEmptyProjectStats","Tracker","isTracking","lastActivity","sessionStartTime","currentSessionTime","isAfk","afkThreshold","checkInterval","disposables","onTimeUpdateCallback","onAfkChangeCallback","initialize","loadConfig","workspace","onDidChangeConfiguration","e","affectsConfiguration","getConfiguration","get","config","registerActivityListeners","setInterval","tick","addSession","duration","info","stop","clearInterval","disposeActivityListeners","updateLastSession","_saveImmediate","onDidChangeTextDocument","onActivity","trackDocumentChanges","onDidChangeTextEditorSelection","onDidChangeTextEditorVisibleRanges","onDidChangeActiveTextEditor","disposable","wasAfk","event","contentChanges","charsAdded","charsDeleted","change","textLength","deletedLength","rangeLength","newLines","match","deletedLines","line","addMetrics","timeSinceActivity","addTime","onTimeUpdate","callback","onAfkChange","getCurrentSessionTime","getTodayTime","getProjectStats","startOfDay","setHours","startTimestamp","getTime","todayTime","session","isCurrentlyTracking","createEmptyStorageData","totalTimeAllProjects","createEmptyDailyMetrics","require","getFullYear","getMonth","getDate","day","getDay","diff","isSessionInRange","startRange","endRange","total","overlapStart","Math","max","min","dateKeyToTimestamp","dateKey","year","split","Number","ms","totalSeconds","floor","hours","minutes","seconds","toString","padStart","parts","workspaceFolders","uri","fsPath","getDateKey","d","String","days","result","i","date","endOfDay","toLocaleDateString","weekday","weeks","currentDay","weekStart","weekEnd","months","monthStart","monthEnd","endTimestamp","dayKey","dayTs","SyncLogger","logs","maxLogs","_syncDetectionCount","_saveCount","_mergeCount","_activationTime","_lastSaveIds","_lastSyncCheckResults","log","_safeStringify","prefix","console","error","warn","debug","recordSyncDetection","recordSave","recordMerge","getCounters","saves","merges","getLogsByCategory","l","getLogsByLevel","recordSaveId","saveId","recordSyncCheckResult","lines","toISOString","round","counters","r","key","value","Array","isArray","Storage","StatusBar","tracker","statusBar","activate","showStatsCommand","commands","registerCommand","resetProjectCommand","resetAllCommand","resetAll","exportDataCommand","jsonContent","showSaveDialog","defaultUri","Uri","file","filters","fs","writeFile","Buffer","from","importDataCommand","showOpenDialog","canSelectFiles","canSelectFolders","canSelectMany","fileContent","readFile","importedData","parse","importData","showErrorMessage","checkSyncCommand","clearSyncLogCommand","forceSyncCheckCommand","exportSyncLogCommand","choice","deactivate","flush","statusBarItem","createStatusBarItem","StatusBarAlignment","Left","tooltip","updateInterval","updateAfkStatus","sessionTime","sessionStr","todayStr","icon","backgroundColor","ThemeColor","os","STORAGE_KEY","MACHINE_ID_KEY","SYNC_KEYS","initialized","syncCheckTimeout","_lastSaveId","_saveTimer","_periodicSyncInterval","_initMachineId","platform","hostname","process","version","globalState","setKeysForSync","rawStored","rawSize","_saveId","_machineId","load","projectIds","values","reduce","sum","p","pid","pStats","pSessions","machines","Set","scheduleSyncCheck","_startPeriodicSyncCheck","forEach","delay","setTimeout","stored","random","_getDateKey","dataSize","storedProjectCount","currentProjectCount","storedTotalSessions","currentTotalSessions","isFromDifferentMachine","ourLastSaveId","storedSaveId","storedMachineId","ourMachineId","mergeWithSyncedData","needsMerge","mergeReason","newProjects","newSessions","storedSessions","currentSessions","currentStartTimes","has","currentSession","find","reason","saveIdsMatch","syncedData","syncedSize","currentSize","syncedProjects","currentProjects","syncedMachineId","syncedSaveId","syncedLastSaveTime","_lastSaveTime","ourSaveId","newProjectCount","mergedProjectCount","newSessionCount","syncedStats","currentStats","currentSessionCount","syncedSessionCount","mergedSessions","mergeSessions","addedSessions","totalTimeFromSessions","_mergeDailyMetrics","recalculateTotals","mergedSize","mergedTotalSessions","syncedSessions","sessionMap","Map","set","replaced","added","existing","current","synced","merged","c","oldTotal","loadedSaveId","loadedMachineId","save","currentStored","storedSize","storedDataSize","storedProjects","stack","dataToSave","saveSize","_scheduleSave","clearTimeout","updateProjectStats","updates","assign","timeMs","machineSession","pop","oldStats","Error","importedStats","existingStats","cleanData","lastSaveId","savedMachineId","getSummary","__webpack_module_cache__","__webpack_exports__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"ignoreList":[],"sourceRoot":""}